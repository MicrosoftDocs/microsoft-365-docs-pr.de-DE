---
title: Erstellen und Verwalten von benutzerdefinierten Erkennungsregeln in Microsoft Threat Protection
description: Hier erfahren Sie, wie Sie benutzerdefinierte Erkennungsregeln basierend auf erweiterten Jagd Abfragen erstellen und verwalten können.
keywords: Erweiterte Suche, Bedrohungs Suche, Cyber-Bedrohungs Suche, Microsoft Threat Protection, Microsoft 365, MTP, m365, Suche, Abfrage, Telemetrie, benutzerdefinierte Erkennungen, Regeln, Schema, Kusto, Microsoft 365, Microsoft Threat Protection, RBAC, Permissions, Microsoft Defender ATP
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: microsoft-365-enterprise
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: lomayor
author: lomayor
ms.localizationpriority: medium
manager: dansimp
audience: ITPro
ms.collection: M365-security-compliance
ms.topic: article
ms.openlocfilehash: f6c00ef68b59f900882f662e33f8e9cf3e08e170
ms.sourcegitcommit: 41fd71ec7175ea3b94f5d3ea1ae2c8fb8dc84227
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/09/2020
ms.locfileid: "47419156"
---
# <a name="create-and-manage-custom-detections-rules"></a><span data-ttu-id="656d5-104">Erstellen und Verwalten von benutzerdefinierten Erkennungsregeln</span><span class="sxs-lookup"><span data-stu-id="656d5-104">Create and manage custom detections rules</span></span>

<span data-ttu-id="656d5-105">**Gilt für:**</span><span class="sxs-lookup"><span data-stu-id="656d5-105">**Applies to:**</span></span>
- <span data-ttu-id="656d5-106">Microsoft Threat Protection</span><span class="sxs-lookup"><span data-stu-id="656d5-106">Microsoft Threat Protection</span></span>

<span data-ttu-id="656d5-107">Benutzerdefinierte Erkennungsregeln sind Regeln, die Sie mit [erweiterten Jagd](advanced-hunting-overview.md) Abfragen entwerfen und optimieren können.</span><span class="sxs-lookup"><span data-stu-id="656d5-107">Custom detection rules are rules you can design and tweak using [advanced hunting](advanced-hunting-overview.md) queries.</span></span> <span data-ttu-id="656d5-108">Mit diesen Regeln können Sie verschiedene Ereignisse und Systemzustände proaktiv überwachen, einschließlich mutmaßlicher Sicherheitsverletzungen und falsch konfigurierter Endpunkte.</span><span class="sxs-lookup"><span data-stu-id="656d5-108">These rules let you proactively monitor various events and system states, including suspected breach activity and misconfigured endpoints.</span></span> <span data-ttu-id="656d5-109">Sie können festlegen, dass Sie in regelmäßigen Intervallen ausgeführt werden, indem Sie Warnungen generieren und Reaktions Aktionen ausführen, wenn Übereinstimmungen vorliegen.</span><span class="sxs-lookup"><span data-stu-id="656d5-109">You can set them to run at regular intervals, generating alerts and taking response actions whenever there are matches.</span></span>

## <a name="required-permissions-for-managing-custom-detections"></a><span data-ttu-id="656d5-110">Erforderliche Berechtigungen zum Verwalten benutzerdefinierter Erkennungen</span><span class="sxs-lookup"><span data-stu-id="656d5-110">Required permissions for managing custom detections</span></span>

<span data-ttu-id="656d5-111">Um benutzerdefinierte Erkennungen zu verwalten, müssen Sie eine der folgenden Rollen zugewiesen werden:</span><span class="sxs-lookup"><span data-stu-id="656d5-111">To manage custom detections, you need to be assigned one of these roles:</span></span>

- <span data-ttu-id="656d5-112">**Sicherheitsadministrator**– Benutzer mit dieser [Azure Active Directory Rolle](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) können Sicherheitseinstellungen im Microsoft 365 Security Center und anderen Portalen und Diensten verwalten.</span><span class="sxs-lookup"><span data-stu-id="656d5-112">**Security administrator**—Users with this [Azure Active Directory role](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) can manage security settings in Microsoft 365 security center and other portals and services.</span></span>

- <span data-ttu-id="656d5-113">**Sicherheits Operator**– Benutzer mit dieser [Azure Active Directory-Rolle](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) können Warnungen verwalten und über einen globalen schreibgeschützten Zugriff auf sicherheitsbezogene Features verfügen, einschließlich aller Informationen im Microsoft 365 Security Center.</span><span class="sxs-lookup"><span data-stu-id="656d5-113">**Security operator**—Users with this [Azure Active Directory role](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) can manage alerts and have global read-only access to security-related features, including all information in Microsoft 365 security center.</span></span> <span data-ttu-id="656d5-114">Diese Rolle reicht aus, um benutzerdefinierte Erkennungen nur dann zu verwalten, wenn die rollenbasierte Zugriffssteuerung (Role-Based Access Control, RBAC) in Microsoft Defender ATP deaktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="656d5-114">This role is sufficient for managing custom detections only if role-based access control (RBAC) is turned off in Microsoft Defender ATP.</span></span> <span data-ttu-id="656d5-115">Wenn Sie RBAC konfiguriert haben, benötigen Sie auch die Berechtigung **Sicherheitseinstellungen verwalten** für Microsoft Defender ATP.</span><span class="sxs-lookup"><span data-stu-id="656d5-115">If you have RBAC configured, you also need the **manage security settings** permission for Microsoft Defender ATP.</span></span>

<span data-ttu-id="656d5-116">Zum Verwalten der erforderlichen Berechtigungen kann ein **globaler Administrator** folgende Schritte durchführen:</span><span class="sxs-lookup"><span data-stu-id="656d5-116">To manage required permissions, a **global administrator** can:</span></span>

- <span data-ttu-id="656d5-117">Weisen Sie die Rolle " **Sicherheitsadministrator** " oder " **Sicherheits Operator** " im [Microsoft 365 Admin Center](https://admin.microsoft.com/) unter **roles**  >  **Security Admin**zu.</span><span class="sxs-lookup"><span data-stu-id="656d5-117">Assign the **security administrator** or **security operator** role in [Microsoft 365 admin center](https://admin.microsoft.com/) under **Roles** > **Security admin**.</span></span>
- <span data-ttu-id="656d5-118">Überprüfen Sie die RBAC-Einstellungen für Microsoft Defender ATP im [Microsoft Defender Security Center](https://securitycenter.windows.com/) unter **Einstellungen**  >  **Berechtigungs**  >  **Rollen**.</span><span class="sxs-lookup"><span data-stu-id="656d5-118">Check RBAC settings for Microsoft Defender ATP in [Microsoft Defender Security Center](https://securitycenter.windows.com/) under **Settings** > **Permissions** > **Roles**.</span></span> <span data-ttu-id="656d5-119">Wählen Sie die entsprechende Rolle aus, um die Berechtigung **Sicherheitseinstellungen verwalten** zuzuweisen.</span><span class="sxs-lookup"><span data-stu-id="656d5-119">Select the corresponding role to assign the **manage security settings** permission.</span></span>

> [!NOTE]
> <span data-ttu-id="656d5-120">Zum Verwalten von benutzerdefinierten Erkennungen benötigen **Sicherheits Operatoren** die Berechtigung **Sicherheitseinstellungen verwalten** in Microsoft Defender ATP, wenn RBAC aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="656d5-120">To manage custom detections, **security operators** will need the **manage security settings** permission in Microsoft Defender ATP if RBAC is turned on.</span></span>

## <a name="create-a-custom-detection-rule"></a><span data-ttu-id="656d5-121">Erstellen einer benutzerdefinierten Erkennungsregel</span><span class="sxs-lookup"><span data-stu-id="656d5-121">Create a custom detection rule</span></span>
### <a name="1-prepare-the-query"></a><span data-ttu-id="656d5-122">1. bereiten Sie die Abfrage vor.</span><span class="sxs-lookup"><span data-stu-id="656d5-122">1. Prepare the query.</span></span>

<span data-ttu-id="656d5-123">Wechseln Sie im Microsoft 365 Security Center zu **Advanced Hunting** , und wählen Sie eine vorhandene Abfrage aus, oder erstellen Sie eine neue Abfrage.</span><span class="sxs-lookup"><span data-stu-id="656d5-123">In Microsoft 365 security center, go to **Advanced hunting** and select an existing query or create a new query.</span></span> <span data-ttu-id="656d5-124">Wenn Sie eine neue Abfrage verwenden, führen Sie die Abfrage aus, um Fehler zu identifizieren und mögliche Ergebnisse zu verstehen.</span><span class="sxs-lookup"><span data-stu-id="656d5-124">When using a new query, run the query to identify errors and understand possible results.</span></span>

>[!IMPORTANT]
><span data-ttu-id="656d5-125">Um zu verhindern, dass der Dienst zu viele Warnungen zurückgibt, ist jede Regel darauf beschränkt, bei der Ausführung nur 100 Warnungen zu generieren.</span><span class="sxs-lookup"><span data-stu-id="656d5-125">To prevent the service from returning too many alerts, each rule is limited to generating only 100 alerts whenever it runs.</span></span> <span data-ttu-id="656d5-126">Vor dem Erstellen einer Regel sollten Sie die Abfrage optimieren, um Warnungen für normale tägliche Aktivitäten zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="656d5-126">Before creating a rule, tweak your query to avoid alerting for normal, day-to-day activity.</span></span>


#### <a name="required-columns-in-the-query-results"></a><span data-ttu-id="656d5-127">Erforderliche Spalten in den Abfrageergebnissen</span><span class="sxs-lookup"><span data-stu-id="656d5-127">Required columns in the query results</span></span>
<span data-ttu-id="656d5-128">Um eine benutzerdefinierte Erkennungsregel zu erstellen, muss die Abfrage die folgenden Spalten zurückgeben:</span><span class="sxs-lookup"><span data-stu-id="656d5-128">To create a custom detection rule, the query must return the following columns:</span></span>

- <span data-ttu-id="656d5-129">`Timestamp`– wird zum Festlegen des Zeitstempels für generierte Warnungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="656d5-129">`Timestamp`—used to set the timestamp for generated alerts</span></span>
- <span data-ttu-id="656d5-130">`ReportId`– aktiviert Nachschlagevorgänge für die ursprünglichen Datensätze</span><span class="sxs-lookup"><span data-stu-id="656d5-130">`ReportId`—enables lookups for the original records</span></span>
- <span data-ttu-id="656d5-131">Eine der folgenden Spalten, die bestimmte Geräte, Benutzer oder Postfächer identifizieren:</span><span class="sxs-lookup"><span data-stu-id="656d5-131">One of the following columns that identify specific devices, users, or mailboxes:</span></span>
    - `DeviceId`
    - `DeviceName`
    - `RemoteDeviceName`
    - `RecipientEmailAddress`
    - <span data-ttu-id="656d5-132">`SenderFromAddress` (Absender der Umschlags-oder Rückgabepfad Adresse)</span><span class="sxs-lookup"><span data-stu-id="656d5-132">`SenderFromAddress` (envelope sender or Return-Path address)</span></span>
    - <span data-ttu-id="656d5-133">`SenderMailFromAddress` (Absenderadresse wird vom e-Mail-Client angezeigt)</span><span class="sxs-lookup"><span data-stu-id="656d5-133">`SenderMailFromAddress` (sender address displayed by email client)</span></span>
    - `RecipientObjectId`
    - `AccountObjectId`
    - `AccountSid`
    - `AccountUpn`
    - `InitiatingProcessAccountSid`
    - `InitiatingProcessAccountUpn`
    - `InitiatingProcessAccountObjectId`

>[!NOTE]
><span data-ttu-id="656d5-134">Die Unterstützung zusätzlicher Entitäten wird hinzugefügt, wenn dem [erweiterten Jagd Schema](advanced-hunting-schema-tables.md)neue Tabellen hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="656d5-134">Support for additional entities will be added as new tables are added to the [advanced hunting schema](advanced-hunting-schema-tables.md).</span></span>

<span data-ttu-id="656d5-135">Einfache Abfragen, beispielsweise solche, die den `project` or `summarize` -Operator nicht zum Anpassen oder Aggregieren von Ergebnissen verwenden, geben normalerweise diese allgemeinen Spalten zurück.</span><span class="sxs-lookup"><span data-stu-id="656d5-135">Simple queries, such as those that don't use the `project` or `summarize` operator to customize or aggregate results, typically return these common columns.</span></span>

<span data-ttu-id="656d5-136">Es gibt verschiedene Möglichkeiten, um sicherzustellen, dass komplexere Abfragen diese Spalten zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="656d5-136">There are various ways to ensure more complex queries return these columns.</span></span> <span data-ttu-id="656d5-137">Wenn Sie beispielsweise eine Aggregation und eine Zählung nach Entität in einer Spalte wie, möchten `DeviceId` , können Sie immer noch zurückkehren `Timestamp` und `ReportId` diese von dem letzten Ereignis abrufen, das die einzelnen Eindeutigkeiten beinhaltet `DeviceId` .</span><span class="sxs-lookup"><span data-stu-id="656d5-137">For example, if you prefer to aggregate and count by entity under a column such as `DeviceId`, you can still return `Timestamp` and `ReportId` by getting it from the most recent event involving each unique `DeviceId`.</span></span>

<span data-ttu-id="656d5-138">Die folgende Beispielabfrage zählt die Anzahl der eindeutigen Geräte ( `DeviceId` ) mit Antivirus-Erkennungen und verwendet diese Anzahl, um nur die Geräte mit mehr als fünf Erkennungen zu finden.</span><span class="sxs-lookup"><span data-stu-id="656d5-138">The sample query below counts the number of unique devices (`DeviceId`) with antivirus detections and uses this count to find only the devices with more than five detections.</span></span> <span data-ttu-id="656d5-139">Um den neuesten `Timestamp` und den entsprechenden zurückzugeben `ReportId` , wird der `summarize` Operator mit der- `arg_max` Funktion verwendet.</span><span class="sxs-lookup"><span data-stu-id="656d5-139">To return the latest `Timestamp` and the corresponding `ReportId`, it uses the `summarize` operator with the `arg_max` function.</span></span>

```kusto
DeviceEvents
| where Timestamp > ago(1d)
| where ActionType == "AntivirusDetection"
| summarize (Timestamp, ReportId)=arg_max(Timestamp, ReportId), count() by DeviceId
| where count_ > 5
```

> [!TIP]
> <span data-ttu-id="656d5-140">Für eine bessere Abfrageleistung legen Sie einen Zeitfilter fest, der mit der beabsichtigten Ausführungshäufigkeit für die Regel übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="656d5-140">For better query performance, set a time filter that matches your intended run frequency for the rule.</span></span> <span data-ttu-id="656d5-141">Da die am wenigsten häufige Ausführung alle _24 Stunden_erfolgt, werden die Filter für den letzten Tag alle neuen Daten umfassen.</span><span class="sxs-lookup"><span data-stu-id="656d5-141">Since the least frequent run is _every 24 hours_, filtering for the past day will cover all new data.</span></span>

### <a name="2-create-new-rule-and-provide-alert-details"></a><span data-ttu-id="656d5-142">2. Erstellen Sie eine neue Regel, und geben Sie Warnungsdetails an.</span><span class="sxs-lookup"><span data-stu-id="656d5-142">2. Create new rule and provide alert details.</span></span>

<span data-ttu-id="656d5-143">Wählen Sie mit der Abfrage im Abfrage-Editor **Erkennungsregel erstellen** aus, und geben Sie die folgenden Warnungsdetails an:</span><span class="sxs-lookup"><span data-stu-id="656d5-143">With the query in the query editor, select **Create detection rule** and specify the following alert details:</span></span>

- <span data-ttu-id="656d5-144">**Erkennungsname**– Name der Erkennungsregel</span><span class="sxs-lookup"><span data-stu-id="656d5-144">**Detection name**—name of the detection rule</span></span>
- <span data-ttu-id="656d5-145">**Häufigkeit**– Intervall zum Ausführen der Abfrage und ergreifen von Aktionen.</span><span class="sxs-lookup"><span data-stu-id="656d5-145">**Frequency**—interval for running the query and taking action.</span></span> [<span data-ttu-id="656d5-146">Weitere Anleitungen finden Sie weiter unten.</span><span class="sxs-lookup"><span data-stu-id="656d5-146">See additional guidance below</span></span>](#rule-frequency)
- <span data-ttu-id="656d5-147">**Warnungs Titel**– Titel mit Warnungen, die von der Regel ausgelöst werden</span><span class="sxs-lookup"><span data-stu-id="656d5-147">**Alert title**—title displayed with alerts triggered by the rule</span></span>
- <span data-ttu-id="656d5-148">**Schweregrad**– potenzielles Risiko der von der Regel identifizierten Komponente oder Aktivität</span><span class="sxs-lookup"><span data-stu-id="656d5-148">**Severity**—potential risk of the component or activity identified by the rule</span></span>
- <span data-ttu-id="656d5-149">**Category**– Bedrohungs Komponente oder Aktivität, die von der Regel identifiziert wird</span><span class="sxs-lookup"><span data-stu-id="656d5-149">**Category**—threat component or activity identified by the rule</span></span>
- <span data-ttu-id="656d5-150">**Mitra ATT&ck Techniques**– eine oder mehrere von der Regel identifizierte Angriffstechniken, wie im [Mitra ATT&ck-Framework](https://attack.mitre.org/)dokumentiert.</span><span class="sxs-lookup"><span data-stu-id="656d5-150">**MITRE ATT&CK techniques**—one or more attack techniques identified by the rule as documented in the [MITRE ATT&CK framework](https://attack.mitre.org/).</span></span> <span data-ttu-id="656d5-151">Dieser Abschnitt ist für bestimmte Warnungs Kategorien verborgen, einschließlich Schadsoftware, Ransomware, verdächtiger Aktivitäten und unerwünschter Software.</span><span class="sxs-lookup"><span data-stu-id="656d5-151">This section is hidden for certain alert categories, including malware, ransomware, suspicious activity, and unwanted software</span></span>
- <span data-ttu-id="656d5-152">**Description**– Weitere Informationen zur von der Regel identifizierten Komponente oder Aktivität</span><span class="sxs-lookup"><span data-stu-id="656d5-152">**Description**—more information about the component or activity identified by the rule</span></span> 
- <span data-ttu-id="656d5-153">**Empfohlene Aktionen**– zusätzliche Aktionen, die Responder als Reaktion auf eine Warnung ausführen können</span><span class="sxs-lookup"><span data-stu-id="656d5-153">**Recommended actions**—additional actions that responders might take in response to an alert</span></span>

#### <a name="rule-frequency"></a><span data-ttu-id="656d5-154">Regel Häufigkeit</span><span class="sxs-lookup"><span data-stu-id="656d5-154">Rule frequency</span></span>
<span data-ttu-id="656d5-155">Wenn Sie eine neue Regel speichern oder bearbeiten, wird Sie ausgeführt und überprüft, ob die Daten in den letzten 30 Tagen übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="656d5-155">When you save or edit a new rule, it runs and checks for matches from the past 30 days of data.</span></span> <span data-ttu-id="656d5-156">Die Regel wird dann in festen Intervallen erneut ausgeführt, wobei eine Lookback Dauer basierend auf der von Ihnen gewählten Häufigkeit angewendet wird:</span><span class="sxs-lookup"><span data-stu-id="656d5-156">The rule then runs again at fixed intervals, applying a lookback duration based on the frequency you choose:</span></span>

- <span data-ttu-id="656d5-157">**Alle 24 Stunden**: wird alle 24 Stunden ausgeführt, und die Daten der letzten 30 Tage werden überprüft.</span><span class="sxs-lookup"><span data-stu-id="656d5-157">**Every 24 hours**—runs every 24 hours, checking data from the past 30 days</span></span>
- <span data-ttu-id="656d5-158">**Alle 12 Stunden**-wird alle 12 Stunden ausgeführt, und die Daten der letzten 24 Stunden werden überprüft.</span><span class="sxs-lookup"><span data-stu-id="656d5-158">**Every 12 hours**—runs every 12 hours, checking data from the past 24 hours</span></span>
- <span data-ttu-id="656d5-159">**Alle 3 Stunden**: wird alle 3 Stunden ausgeführt, und die Daten aus den letzten 6 Stunden werden überprüft.</span><span class="sxs-lookup"><span data-stu-id="656d5-159">**Every 3 hours**—runs every 3 hours, checking data from the past 6 hours</span></span>
- <span data-ttu-id="656d5-160">**Stündlich – stündlich**ausgeführt, Daten aus den letzten 2 Stunden werden überprüft</span><span class="sxs-lookup"><span data-stu-id="656d5-160">**Every hour**—runs hourly, checking data from the past 2 hours</span></span>

>[!TIP]
> <span data-ttu-id="656d5-161">Passen Sie die Zeitfilter in Ihrer Abfrage mit der Lookback-Dauer an.</span><span class="sxs-lookup"><span data-stu-id="656d5-161">Match the time filters in your query with the lookback duration.</span></span> <span data-ttu-id="656d5-162">Ergebnisse außerhalb der Lookback-Dauer werden ignoriert.</span><span class="sxs-lookup"><span data-stu-id="656d5-162">Results outside of the lookback duration are ignored.</span></span>  

<span data-ttu-id="656d5-163">Wählen Sie die Häufigkeit aus, mit der die genaue Überwachung der Erkennungen übereinstimmen soll.</span><span class="sxs-lookup"><span data-stu-id="656d5-163">Select the frequency that matches how closely you want to monitor detections.</span></span> <span data-ttu-id="656d5-164">Überprüfen Sie die Kapazität Ihrer Organisation, auf die Warnungen zu reagieren.</span><span class="sxs-lookup"><span data-stu-id="656d5-164">Consider your organization's capacity to respond to the alerts.</span></span>

### <a name="3-choose-the-impacted-entities"></a><span data-ttu-id="656d5-165">3. Wählen Sie die betroffenen Entitäten aus.</span><span class="sxs-lookup"><span data-stu-id="656d5-165">3. Choose the impacted entities.</span></span>
<span data-ttu-id="656d5-166">Identifizieren Sie die Spalten in den Abfrageergebnissen, bei denen Sie davon ausgehen, dass Sie die Hauptbetroffene oder betroffene Entität finden.</span><span class="sxs-lookup"><span data-stu-id="656d5-166">Identify the columns in your query results where you expect to find the main affected or impacted entity.</span></span> <span data-ttu-id="656d5-167">Beispielsweise kann eine Abfrage Absender ( `SenderFromAddress` oder `SenderMailFromAddress` )-und Empfängeradressen ( `RecipientEmailAddress` ) zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="656d5-167">For example, a query might return sender (`SenderFromAddress` or `SenderMailFromAddress`) and recipient (`RecipientEmailAddress`) addresses.</span></span> <span data-ttu-id="656d5-168">Das Identifizieren der Spalten, die die Hauptbetroffene Entität darstellen, hilft dem Dienst, relevante Warnungen zu aggregieren, Vorfälle und Ziel Antwort Aktionen zu korrelieren.</span><span class="sxs-lookup"><span data-stu-id="656d5-168">Identifying which of these columns represent the main impacted entity helps the service aggregate relevant alerts, correlate incidents, and target response actions.</span></span>

<span data-ttu-id="656d5-169">Sie können für jeden Entitätstyp (Postfach, Benutzer oder Gerät) nur eine Spalte auswählen.</span><span class="sxs-lookup"><span data-stu-id="656d5-169">You can select only one column for each entity type (mailbox, user, or device).</span></span> <span data-ttu-id="656d5-170">Spalten, die nicht von der Abfrage zurückgegeben werden, können nicht ausgewählt werden.</span><span class="sxs-lookup"><span data-stu-id="656d5-170">Columns that are not returned by your query can't be selected.</span></span>

### <a name="4-specify-actions"></a><span data-ttu-id="656d5-171">4. Geben Sie Aktionen an.</span><span class="sxs-lookup"><span data-stu-id="656d5-171">4. Specify actions.</span></span>
<span data-ttu-id="656d5-172">Ihre benutzerdefinierte Erkennungsregel kann automatisch Aktionen für Geräte, Dateien oder Benutzer durchführen, die von der Abfrage zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="656d5-172">Your custom detection rule can automatically take actions on devices, files, or users that are returned by the query.</span></span>

#### <a name="actions-on-devices"></a><span data-ttu-id="656d5-173">Aktionen auf Geräten</span><span class="sxs-lookup"><span data-stu-id="656d5-173">Actions on devices</span></span>
<span data-ttu-id="656d5-174">Diese Aktionen werden auf Geräte in der `DeviceId` Spalte der Abfrageergebnisse angewendet:</span><span class="sxs-lookup"><span data-stu-id="656d5-174">These actions are applied to devices in the `DeviceId` column of the query results:</span></span>
- <span data-ttu-id="656d5-175">**Isolier Gerät**– mit Microsoft Defender ATP wird die vollständige Netzwerkisolation angewendet, sodass das Gerät nicht mit einer Anwendung oder einem Dienst verbunden werden kann.</span><span class="sxs-lookup"><span data-stu-id="656d5-175">**Isolate device**—uses Microsoft Defender ATP to apply full network isolation, preventing the device from connecting to any application or service.</span></span> [<span data-ttu-id="656d5-176">Weitere Informationen zur Isolierung von Microsoft Defender ATP-Computern</span><span class="sxs-lookup"><span data-stu-id="656d5-176">Learn more about Microsoft Defender ATP machine isolation</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#isolate-devices-from-the-network)
- <span data-ttu-id="656d5-177">**Ermittlungs Paket sammeln**– sammelt Geräteinformationen in einer ZIP-Datei.</span><span class="sxs-lookup"><span data-stu-id="656d5-177">**Collect investigation package**—collects device information in a ZIP file.</span></span> [<span data-ttu-id="656d5-178">Weitere Informationen zum Microsoft Defender ATP-Ermittlungs Paket</span><span class="sxs-lookup"><span data-stu-id="656d5-178">Learn more about the Microsoft Defender ATP investigation package</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#collect-investigation-package-from-devices)
- <span data-ttu-id="656d5-179">**Ausführen eines Antivirus-Scans**– führt eine vollständige Windows Defender-Antivirus-Überprüfung auf dem Gerät aus.</span><span class="sxs-lookup"><span data-stu-id="656d5-179">**Run antivirus scan**—performs a full Windows Defender Antivirus scan on the device</span></span>
- <span data-ttu-id="656d5-180">**Einleitung einer Untersuchung**– initiiert eine [automatisierte Untersuchung](mtp-autoir.md) auf dem Gerät</span><span class="sxs-lookup"><span data-stu-id="656d5-180">**Initiate investigation**—initiates an [automated investigation](mtp-autoir.md) on the device</span></span>
- <span data-ttu-id="656d5-181">**App-Ausführung einschränken**– legt Einschränkungen für das Gerät fest, damit nur Dateien ausgeführt werden können, die mit einem von Microsoft ausgestellten Zertifikat signiert sind.</span><span class="sxs-lookup"><span data-stu-id="656d5-181">**Restrict app execution**—sets restrictions on device to allow only files that are signed with a Microsoft-issued certificate to run.</span></span> [<span data-ttu-id="656d5-182">Weitere Informationen zu app-Einschränkungen mit Microsoft Defender ATP</span><span class="sxs-lookup"><span data-stu-id="656d5-182">Learn more about app restrictions with Microsoft Defender ATP</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#restrict-app-execution)

#### <a name="actions-on-files"></a><span data-ttu-id="656d5-183">Aktionen für Dateien</span><span class="sxs-lookup"><span data-stu-id="656d5-183">Actions on files</span></span>
<span data-ttu-id="656d5-184">Wenn diese Option ausgewählt ist, können Sie die Aktion " **Quarantänedatei** " auf Dateien in der `SHA1` , `InitiatingProcessSHA1` , `SHA256` oder `InitiatingProcessSHA256` Spalte der Abfrageergebnisse anwenden.</span><span class="sxs-lookup"><span data-stu-id="656d5-184">When selected, you can choose to apply the **Quarantine file** action on files in the `SHA1`, `InitiatingProcessSHA1`, `SHA256`, or `InitiatingProcessSHA256` column of the query results.</span></span> <span data-ttu-id="656d5-185">Mit dieser Aktion wird die Datei von Ihrem aktuellen Speicherort gelöscht und eine Kopie in Quarantäne platziert.</span><span class="sxs-lookup"><span data-stu-id="656d5-185">This action deletes the file from its current location and places a copy in quarantine.</span></span>

#### <a name="actions-on-users"></a><span data-ttu-id="656d5-186">Aktionen für Benutzer</span><span class="sxs-lookup"><span data-stu-id="656d5-186">Actions on users</span></span>
<span data-ttu-id="656d5-187">Wenn diese Option ausgewählt ist, wird die Aktion **Benutzer als kompromittiert markieren** für Benutzer in `AccountObjectId` der `InitiatingProcessAccountObjectId` Spalte, oder der `RecipientObjectId` Abfrageergebnisse verwendet.</span><span class="sxs-lookup"><span data-stu-id="656d5-187">When selected, the **Mark user as compromised** action is taken on users in the `AccountObjectId`, `InitiatingProcessAccountObjectId`, or `RecipientObjectId` column of the query results.</span></span> <span data-ttu-id="656d5-188">Mit dieser Aktion wird die Benutzer Risikostufe in Azure Active Directory auf "hoch" festgelegt, sodass entsprechende [Identitätsschutz Richtlinien](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection)ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="656d5-188">This action sets the users risk level to "high" in Azure Active Directory, triggering corresponding [identity protection policies](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection).</span></span>

> [!NOTE]
> <span data-ttu-id="656d5-189">Die Aktion zulassen oder blockieren für benutzerdefinierte Erkennungsregeln wird derzeit von Microsoft Threat Protection nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="656d5-189">The allow or block action for custom detection rules is currently not supported on Microsoft Threat Protection.</span></span>

### <a name="5-set-the-rule-scope"></a><span data-ttu-id="656d5-190">5. Legen Sie den Regelbereich fest.</span><span class="sxs-lookup"><span data-stu-id="656d5-190">5. Set the rule scope.</span></span>
<span data-ttu-id="656d5-191">Legen Sie den Bereich fest, um anzugeben, welche Geräte von der Regel abgedeckt werden.</span><span class="sxs-lookup"><span data-stu-id="656d5-191">Set the scope to specify which devices are covered by the rule.</span></span> <span data-ttu-id="656d5-192">Der Bereich beeinflusst Regeln, die Geräte überprüfen, und wirkt sich nicht auf Regeln aus, die nur Postfächer und Benutzerkonten oder Identitäten überprüfen.</span><span class="sxs-lookup"><span data-stu-id="656d5-192">The scope influences rules that check devices and doesn't affect rules that check only mailboxes and user accounts or identities.</span></span>

<span data-ttu-id="656d5-193">Beim Festlegen des Bereichs können Sie Folgendes auswählen:</span><span class="sxs-lookup"><span data-stu-id="656d5-193">When setting the scope, you can select:</span></span>

- <span data-ttu-id="656d5-194">Alle Geräte</span><span class="sxs-lookup"><span data-stu-id="656d5-194">All devices</span></span>
- <span data-ttu-id="656d5-195">Bestimmte Gerätegruppen</span><span class="sxs-lookup"><span data-stu-id="656d5-195">Specific device groups</span></span>

<span data-ttu-id="656d5-196">Es werden nur Daten von Geräten im Bereich abgefragt.</span><span class="sxs-lookup"><span data-stu-id="656d5-196">Only data from devices in scope will be queried.</span></span> <span data-ttu-id="656d5-197">Außerdem werden Aktionen nur auf diesen Geräten ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="656d5-197">Also, actions will be taken only on those devices.</span></span>

### <a name="6-review-and-turn-on-the-rule"></a><span data-ttu-id="656d5-198">6. überprüfen und aktivieren Sie die Regel.</span><span class="sxs-lookup"><span data-stu-id="656d5-198">6. Review and turn on the rule.</span></span>
<span data-ttu-id="656d5-199">Wählen Sie nach der Überprüfung der Regel **Create** aus, um Sie zu speichern.</span><span class="sxs-lookup"><span data-stu-id="656d5-199">After reviewing the rule, select **Create** to save it.</span></span> <span data-ttu-id="656d5-200">Die benutzerdefinierte Erkennungsregel wird sofort ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="656d5-200">The custom detection rule immediately runs.</span></span> <span data-ttu-id="656d5-201">Er wird basierend auf der konfigurierten Häufigkeit erneut ausgeführt, um nach Übereinstimmungen zu suchen, Warnungen zu generieren und Reaktions Aktionen durchführen zu können.</span><span class="sxs-lookup"><span data-stu-id="656d5-201">It runs again based on configured frequency to check for matches, generate alerts, and take response actions.</span></span>

## <a name="manage-existing-custom-detection-rules"></a><span data-ttu-id="656d5-202">Verwalten vorhandener benutzerdefinierter Erkennungsregeln</span><span class="sxs-lookup"><span data-stu-id="656d5-202">Manage existing custom detection rules</span></span>
<span data-ttu-id="656d5-203">Sie können die Liste der vorhandenen benutzerdefinierten Erkennungsregeln anzeigen, Ihre vorherigen Ausführungen überprüfen und die von Ihnen ausgelösten Warnungen überprüfen.</span><span class="sxs-lookup"><span data-stu-id="656d5-203">You can view the list of existing custom detection rules, check their previous runs, and review the alerts they have triggered.</span></span> <span data-ttu-id="656d5-204">Sie können auch eine Regel bei Bedarf ausführen und diese ändern.</span><span class="sxs-lookup"><span data-stu-id="656d5-204">You can also run a rule on demand and modify it.</span></span>

### <a name="view-existing-rules"></a><span data-ttu-id="656d5-205">Anzeigen vorhandener Regeln</span><span class="sxs-lookup"><span data-stu-id="656d5-205">View existing rules</span></span>

<span data-ttu-id="656d5-206">Um alle vorhandenen benutzerdefinierten Erkennungsregeln anzuzeigen, navigieren **Hunting**Sie zu  >  **benutzerdefinierten**Erkennungen für die Suche.</span><span class="sxs-lookup"><span data-stu-id="656d5-206">To view all existing custom detection rules, navigate to **Hunting** > **Custom detections**.</span></span> <span data-ttu-id="656d5-207">Auf der Seite werden alle Regeln mit den folgenden Ausführungsinformationen aufgelistet:</span><span class="sxs-lookup"><span data-stu-id="656d5-207">The page lists all the rules with the following run information:</span></span>

- <span data-ttu-id="656d5-208">**Letzte Ausführung**: beim letzten Ausführen einer Regel, um nach Abfrage Übereinstimmungen zu suchen und Warnungen zu generieren</span><span class="sxs-lookup"><span data-stu-id="656d5-208">**Last run**—when a rule was last run to check for query matches and generate alerts</span></span>
- <span data-ttu-id="656d5-209">**Status der letzten Ausführung**– gibt an, ob eine Regel erfolgreich ausgeführt wurde</span><span class="sxs-lookup"><span data-stu-id="656d5-209">**Last run status**—whether a rule ran successfully</span></span>
- <span data-ttu-id="656d5-210">**Nächster Durchlauf**– die nächste geplante Ausführung</span><span class="sxs-lookup"><span data-stu-id="656d5-210">**Next run**—the next scheduled run</span></span>
- <span data-ttu-id="656d5-211">**Status**– gibt an, ob eine Regel aktiviert oder deaktiviert wurde</span><span class="sxs-lookup"><span data-stu-id="656d5-211">**Status**—whether a rule has been turned on or off</span></span>

### <a name="view-rule-details-modify-rule-and-run-rule"></a><span data-ttu-id="656d5-212">Anzeigen von Regeldetails, Regel ändern und Ausführen einer Regel</span><span class="sxs-lookup"><span data-stu-id="656d5-212">View rule details, modify rule, and run rule</span></span>

<span data-ttu-id="656d5-213">Wenn Sie umfassende Informationen zu einer benutzerdefinierten Erkennungsregel **anzeigen möchten,** navigieren Sie zu benutzerdefinierten Erkennungs Erkennungen,  >  **Custom detections** und wählen Sie dann den Namen der Regel aus.</span><span class="sxs-lookup"><span data-stu-id="656d5-213">To view comprehensive information about a custom detection rule, go to **Hunting** > **Custom detections** and then select the name of rule.</span></span> <span data-ttu-id="656d5-214">Sie können dann allgemeine Informationen zur Regel anzeigen, einschließlich der Informationen über den Ausführungsstatus und den Bereich.</span><span class="sxs-lookup"><span data-stu-id="656d5-214">You can then view general information about the rule, including information its run status and scope.</span></span> <span data-ttu-id="656d5-215">Die Seite enthält auch die Liste der ausgelösten Warnungen und Aktionen.</span><span class="sxs-lookup"><span data-stu-id="656d5-215">The page also provides the list of triggered alerts and actions.</span></span>

<span data-ttu-id="656d5-216">![Seite "Details zur benutzerdefinierten Erkennungsregel"](../../media/custom-detection-details.png)</span><span class="sxs-lookup"><span data-stu-id="656d5-216">![Custom detection rule details page](../../media/custom-detection-details.png)</span></span><br>
<span data-ttu-id="656d5-217">*Details der benutzerdefinierten Erkennungsregel*</span><span class="sxs-lookup"><span data-stu-id="656d5-217">*Custom detection rule details*</span></span>

<span data-ttu-id="656d5-218">Auf dieser Seite können Sie auch die folgenden Aktionen für die Regel ausführen:</span><span class="sxs-lookup"><span data-stu-id="656d5-218">You can also take the following actions on the rule from this page:</span></span>

- <span data-ttu-id="656d5-219">**Ausführen**– die Regel wird sofort ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="656d5-219">**Run**—run the rule immediately.</span></span> <span data-ttu-id="656d5-220">Dadurch wird auch das Intervall für die nächste Ausführung zurückgesetzt.</span><span class="sxs-lookup"><span data-stu-id="656d5-220">This also resets the interval for the next run.</span></span>
- <span data-ttu-id="656d5-221">**Bearbeiten**– Ändern der Regel, ohne die Abfrage zu ändern</span><span class="sxs-lookup"><span data-stu-id="656d5-221">**Edit**—modify the rule without changing the query</span></span>
- <span data-ttu-id="656d5-222">**Abfrage ändern**– Bearbeiten der Abfrage in erweiterter Suche</span><span class="sxs-lookup"><span data-stu-id="656d5-222">**Modify query**—edit the query in advanced hunting</span></span>
- <span data-ttu-id="656d5-223">**Einschalten**  /  **Deaktivieren**– Aktivieren der Regel oder Beenden der Ausführung</span><span class="sxs-lookup"><span data-stu-id="656d5-223">**Turn on** / **Turn off**—enable the rule or stop it from running</span></span>
- <span data-ttu-id="656d5-224">**Delete**– deaktivieren Sie die Regel, und entfernen Sie Sie.</span><span class="sxs-lookup"><span data-stu-id="656d5-224">**Delete**—turn off the rule and remove it</span></span>

### <a name="view-and-manage-triggered-alerts"></a><span data-ttu-id="656d5-225">Anzeigen und Verwalten von ausgelösten Warnungen</span><span class="sxs-lookup"><span data-stu-id="656d5-225">View and manage triggered alerts</span></span>

<span data-ttu-id="656d5-226">Wechseln Sie auf dem Bildschirm Regel**Details (**  >  **benutzerdefinierte Erkennungs Erkennungen**  >  **[Regelname]**) zu **ausgelöste Warnungen**, die die Warnungen auflisten, die von Übereinstimmungen mit der Regel generiert werden.</span><span class="sxs-lookup"><span data-stu-id="656d5-226">In the rule details screen (**Hunting** > **Custom detections** > **[Rule name]**), go to  **Triggered alerts**, which lists the alerts generated by matches to the rule.</span></span> <span data-ttu-id="656d5-227">Wählen Sie eine Warnung aus, um detaillierte Informationen dazu anzuzeigen, und führen Sie die folgenden Aktionen aus:</span><span class="sxs-lookup"><span data-stu-id="656d5-227">Select an alert to view detailed information about it and take the following actions:</span></span>

- <span data-ttu-id="656d5-228">Verwalten der Warnung durch Festlegen des Status und der Klassifizierung (true oder false Alert)</span><span class="sxs-lookup"><span data-stu-id="656d5-228">Manage the alert by setting its status and classification (true or false alert)</span></span>
- <span data-ttu-id="656d5-229">Verknüpfen der Warnung mit einem Vorfall</span><span class="sxs-lookup"><span data-stu-id="656d5-229">Link the alert to an incident</span></span>
- <span data-ttu-id="656d5-230">Ausführen der Abfrage, die die Warnung bei Advanced Hunting ausgelöst hat</span><span class="sxs-lookup"><span data-stu-id="656d5-230">Run the query that triggered the alert on advanced hunting</span></span>

### <a name="review-actions"></a><span data-ttu-id="656d5-231">Überprüfen von Aktionen</span><span class="sxs-lookup"><span data-stu-id="656d5-231">Review actions</span></span>
<span data-ttu-id="656d5-232">Wechseln Sie im Bildschirm Regeldetails (**Jagd**  >  **benutzerdefinierte Erkennungen**  >  **[Regelname]**) zu **ausgelöste Aktionen**, die die auf Übereinstimmungen mit der Regel ausgeführten Aktionen auflisten.</span><span class="sxs-lookup"><span data-stu-id="656d5-232">In the rule details screen (**Hunting** > **Custom detections** > **[Rule name]**), go to **Triggered actions**, which lists the actions taken based on matches to the rule.</span></span>

>[!TIP]
><span data-ttu-id="656d5-233">Um Informationen schnell anzuzeigen und Aktionen für ein Element in einer Tabelle durchführen zu können, verwenden Sie die Auswahlspalte [&#10003;] Links in der Tabelle.</span><span class="sxs-lookup"><span data-stu-id="656d5-233">To quickly view information and take action on an item in a table, use the selection column [&#10003;] at the left of the table.</span></span>

## <a name="related-topic"></a><span data-ttu-id="656d5-234">Verwandtes Thema</span><span class="sxs-lookup"><span data-stu-id="656d5-234">Related topic</span></span>
- [<span data-ttu-id="656d5-235">Benutzerdefinierte Erkennungen – Übersicht</span><span class="sxs-lookup"><span data-stu-id="656d5-235">Custom detections overview</span></span>](custom-detections-overview.md)
- [<span data-ttu-id="656d5-236">Übersicht über die erweiterte Suche</span><span class="sxs-lookup"><span data-stu-id="656d5-236">Advanced hunting overview</span></span>](advanced-hunting-overview.md)
- [<span data-ttu-id="656d5-237">Erlernen der Abfragesprache für die erweiterte Suche</span><span class="sxs-lookup"><span data-stu-id="656d5-237">Learn the advanced hunting query language</span></span>](advanced-hunting-query-language.md)