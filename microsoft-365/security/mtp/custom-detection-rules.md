---
title: Erstellen und Verwalten von benutzerdefinierten Erkennungsregeln in Microsoft 365 Defender
description: Hier erfahren Sie, wie Sie benutzerdefinierte Erkennungsregeln basierend auf erweiterten Suchabfragen erstellen und verwalten.
keywords: Erweiterte Suche, Bedrohungssuche, Cyberbedrohungssuche, Microsoft Threat Protection, Microsoft 365, MTP, m365, Suche, Abfrage, Telemetrie, benutzerdefinierte Erkennungen, Regeln, Schema, Kusto, Microsoft 365, Microsoft Threat Protection, RBAC, Berechtigungen, Microsoft Defender ATP
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: lomayor
author: lomayor
ms.localizationpriority: medium
manager: dansimp
audience: ITPro
ms.collection:
- M365-security-compliance
- m365initiative-m365-defender
ms.topic: article
ms.technology: m365d
ms.openlocfilehash: d58292f658446259bfab5b1b55c8b462d081421c
ms.sourcegitcommit: d354727303d9574991b5a0fd298d2c9414e19f6c
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/02/2021
ms.locfileid: "50080623"
---
# <a name="create-and-manage-custom-detections-rules"></a><span data-ttu-id="9f9bb-104">Erstellen und Verwalten von benutzerdefinierten Erkennungsregeln</span><span class="sxs-lookup"><span data-stu-id="9f9bb-104">Create and manage custom detections rules</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender.md)]


<span data-ttu-id="9f9bb-105">**Gilt für:**</span><span class="sxs-lookup"><span data-stu-id="9f9bb-105">**Applies to:**</span></span>
- <span data-ttu-id="9f9bb-106">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="9f9bb-106">Microsoft 365 Defender</span></span>

<span data-ttu-id="9f9bb-107">Benutzerdefinierte Erkennungsregeln sind Regeln, die Sie mithilfe erweiterter [Suchabfragen entwerfen und](advanced-hunting-overview.md) optimieren können.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-107">Custom detection rules are rules you can design and tweak using [advanced hunting](advanced-hunting-overview.md) queries.</span></span> <span data-ttu-id="9f9bb-108">Mit diesen Regeln können Sie proaktiv verschiedene Ereignisse und Systemzustände überwachen, einschließlich mutmaßlicher Sicherheitsverletzungen und falsch konfigurierter Endpunkte.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-108">These rules let you proactively monitor various events and system states, including suspected breach activity and misconfigured endpoints.</span></span> <span data-ttu-id="9f9bb-109">Sie können festlegen, dass sie in regelmäßigen Intervallen ausgeführt werden, Warnungen generieren und bei Übereinstimmungen Reaktionsaktionen ausführen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-109">You can set them to run at regular intervals, generating alerts and taking response actions whenever there are matches.</span></span>

## <a name="required-permissions-for-managing-custom-detections"></a><span data-ttu-id="9f9bb-110">Erforderliche Berechtigungen für die Verwaltung von benutzerdefinierten Erkennungen</span><span class="sxs-lookup"><span data-stu-id="9f9bb-110">Required permissions for managing custom detections</span></span>

<span data-ttu-id="9f9bb-111">Zum Verwalten von benutzerdefinierten Erkennungen muss Ihnen eine der folgenden Rollen zugewiesen sein:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-111">To manage custom detections, you need to be assigned one of these roles:</span></span>

- <span data-ttu-id="9f9bb-112">**Sicherheitsadministrator**– Benutzer mit dieser [Azure Active](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) Directory-Rolle können Sicherheitseinstellungen im Microsoft 365 Security Center und anderen Portalen und Diensten verwalten.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-112">**Security administrator**—Users with this [Azure Active Directory role](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) can manage security settings in Microsoft 365 security center and other portals and services.</span></span>

- <span data-ttu-id="9f9bb-113">**Sicherheitsoperator**– Benutzer mit dieser [Azure Active](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) Directory-Rolle können Warnungen verwalten und haben globalen schreibgeschützten Zugriff auf sicherheitsbezogene Features, einschließlich aller Informationen im Microsoft 365 Security Center.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-113">**Security operator**—Users with this [Azure Active Directory role](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) can manage alerts and have global read-only access to security-related features, including all information in Microsoft 365 security center.</span></span> <span data-ttu-id="9f9bb-114">Diese Rolle ist nur dann für die Verwaltung von benutzerdefinierten Erkennungen ausreichend, wenn die rollenbasierte Zugriffssteuerung (Role-Based Access Control, RBAC) in Microsoft Defender for Endpoint deaktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-114">This role is sufficient for managing custom detections only if role-based access control (RBAC) is turned off in Microsoft Defender for Endpoint.</span></span> <span data-ttu-id="9f9bb-115">Wenn Sie rbAC konfiguriert haben,  benötigen Sie auch die Berechtigung zum Verwalten von Sicherheitseinstellungen für Defender for Endpoint.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-115">If you have RBAC configured, you also need the **manage security settings** permission for Defender for Endpoint.</span></span>

<span data-ttu-id="9f9bb-116">Um die erforderlichen Berechtigungen zu verwalten, kann **ein globaler Administrator:**</span><span class="sxs-lookup"><span data-stu-id="9f9bb-116">To manage required permissions, a **global administrator** can:</span></span>

- <span data-ttu-id="9f9bb-117">Weisen Sie **die Rolle des Sicherheitsadministrators** oder der Sicherheitsoperatorrolle im Microsoft [365 Admin Center](https://admin.microsoft.com/) unter  **"Rollensicherheitsadministrator"**  >  **zu.**</span><span class="sxs-lookup"><span data-stu-id="9f9bb-117">Assign the **security administrator** or **security operator** role in [Microsoft 365 admin center](https://admin.microsoft.com/) under **Roles** > **Security admin**.</span></span>
- <span data-ttu-id="9f9bb-118">Überprüfen Sie die Einstellungen für die rollen rechte Zugriffsberechtigung für Microsoft Defender for Endpoint im [Microsoft Defender Security Center](https://securitycenter.windows.com/) unter **"Einstellungsberechtigungsrollen".**  >    >  </span><span class="sxs-lookup"><span data-stu-id="9f9bb-118">Check RBAC settings for Microsoft Defender for Endpoint in [Microsoft Defender Security Center](https://securitycenter.windows.com/) under **Settings** > **Permissions** > **Roles**.</span></span> <span data-ttu-id="9f9bb-119">Wählen Sie die entsprechende Rolle aus, um die Berechtigung zum Verwalten **von Sicherheitseinstellungen zu** erteilen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-119">Select the corresponding role to assign the **manage security settings** permission.</span></span>

> [!NOTE]
> <span data-ttu-id="9f9bb-120">Zum Verwalten von benutzerdefinierten Erkennungen benötigen Sicherheitsoperatoren die Berechtigung zum Verwalten von Sicherheitseinstellungen in Microsoft Defender for Endpoint, wenn rbAC aktiviert ist.  </span><span class="sxs-lookup"><span data-stu-id="9f9bb-120">To manage custom detections, **security operators** will need the **manage security settings** permission in Microsoft Defender for Endpoint if RBAC is turned on.</span></span>

## <a name="create-a-custom-detection-rule"></a><span data-ttu-id="9f9bb-121">Erstellen einer benutzerdefinierten Erkennungsregel</span><span class="sxs-lookup"><span data-stu-id="9f9bb-121">Create a custom detection rule</span></span>
### <a name="1-prepare-the-query"></a><span data-ttu-id="9f9bb-122">1. Bereiten Sie die Abfrage vor.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-122">1. Prepare the query.</span></span>

<span data-ttu-id="9f9bb-123">Wechseln Sie im Microsoft 365 Security Center zur erweiterten Suche, und wählen Sie eine vorhandene Abfrage aus, oder erstellen Sie eine neue Abfrage. </span><span class="sxs-lookup"><span data-stu-id="9f9bb-123">In Microsoft 365 security center, go to **Advanced hunting** and select an existing query or create a new query.</span></span> <span data-ttu-id="9f9bb-124">Wenn Sie eine neue Abfrage verwenden, führen Sie die Abfrage aus, um Fehler zu identifizieren und mögliche Ergebnisse zu verstehen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-124">When using a new query, run the query to identify errors and understand possible results.</span></span>

>[!IMPORTANT]
><span data-ttu-id="9f9bb-125">Um zu verhindern, dass der Dienst zu viele Warnungen zurück gibt, ist jede Regel auf die Generierung von nur 100 Warnungen beschränkt, wenn sie ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-125">To prevent the service from returning too many alerts, each rule is limited to generating only 100 alerts whenever it runs.</span></span> <span data-ttu-id="9f9bb-126">Optimieren Sie vor dem Erstellen einer Regel Ihre Abfrage, um Warnungen für normale, täglich ausgeführte Aktivitäten zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-126">Before creating a rule, tweak your query to avoid alerting for normal, day-to-day activity.</span></span>


#### <a name="required-columns-in-the-query-results"></a><span data-ttu-id="9f9bb-127">Erforderliche Spalten in den Abfrageergebnissen</span><span class="sxs-lookup"><span data-stu-id="9f9bb-127">Required columns in the query results</span></span>
<span data-ttu-id="9f9bb-128">Zum Erstellen einer benutzerdefinierten Erkennungsregel muss die Abfrage die folgenden Spalten zurückgeben:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-128">To create a custom detection rule, the query must return the following columns:</span></span>

- <span data-ttu-id="9f9bb-129">`Timestamp`– wird verwendet, um den Zeitstempel für generierte Warnungen festlegen</span><span class="sxs-lookup"><span data-stu-id="9f9bb-129">`Timestamp`—used to set the timestamp for generated alerts</span></span>
- <span data-ttu-id="9f9bb-130">`ReportId`– ermöglicht Nachschlagearbeiten für die ursprünglichen Datensätze</span><span class="sxs-lookup"><span data-stu-id="9f9bb-130">`ReportId`—enables lookups for the original records</span></span>
- <span data-ttu-id="9f9bb-131">Eine der folgenden Spalten, die bestimmte Geräte, Benutzer oder Postfächer identifizieren:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-131">One of the following columns that identify specific devices, users, or mailboxes:</span></span>
    - `DeviceId`
    - `DeviceName`
    - `RemoteDeviceName`
    - `RecipientEmailAddress`
    - <span data-ttu-id="9f9bb-132">`SenderFromAddress` (Umschlagsender oder Return-Path Adresse)</span><span class="sxs-lookup"><span data-stu-id="9f9bb-132">`SenderFromAddress` (envelope sender or Return-Path address)</span></span>
    - <span data-ttu-id="9f9bb-133">`SenderMailFromAddress` (Vom E-Mail-Client angezeigte Absenderadresse)</span><span class="sxs-lookup"><span data-stu-id="9f9bb-133">`SenderMailFromAddress` (sender address displayed by email client)</span></span>
    - `RecipientObjectId`
    - `AccountObjectId`
    - `AccountSid`
    - `AccountUpn`
    - `InitiatingProcessAccountSid`
    - `InitiatingProcessAccountUpn`
    - `InitiatingProcessAccountObjectId`

>[!NOTE]
><span data-ttu-id="9f9bb-134">Unterstützung für zusätzliche Entitäten wird hinzugefügt, wenn dem Schema für die erweiterte Suche neue Tabellen [hinzugefügt werden.](advanced-hunting-schema-tables.md)</span><span class="sxs-lookup"><span data-stu-id="9f9bb-134">Support for additional entities will be added as new tables are added to the [advanced hunting schema](advanced-hunting-schema-tables.md).</span></span>

<span data-ttu-id="9f9bb-135">Einfache Abfragen, z. B. solche, die den Oder-Operator nicht zum Anpassen oder Aggregieren von Ergebnissen verwenden, geben in der Regel `project` `summarize` diese allgemeinen Spalten zurück.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-135">Simple queries, such as those that don't use the `project` or `summarize` operator to customize or aggregate results, typically return these common columns.</span></span>

<span data-ttu-id="9f9bb-136">Es gibt verschiedene Möglichkeiten, um sicherzustellen, dass komplexere Abfragen diese Spalten zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-136">There are various ways to ensure more complex queries return these columns.</span></span> <span data-ttu-id="9f9bb-137">Wenn Sie es z. B. vorziehen, nach Entitäten unter einer Spalte wie zu aggregieren und zu zählen, können Sie sie trotzdem zurückgeben und aus dem neuesten Ereignis abrufen, das jedes eindeutige `DeviceId` `Timestamp` Ereignis `ReportId` `DeviceId` enthält.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-137">For example, if you prefer to aggregate and count by entity under a column such as `DeviceId`, you can still return `Timestamp` and `ReportId` by getting it from the most recent event involving each unique `DeviceId`.</span></span>

<span data-ttu-id="9f9bb-138">Die folgende Beispielabfrage zählt die Anzahl der eindeutigen Geräte ( ) mit Antivirenerkennungen und verwendet diese Anzahl, um nur die Geräte mit mehr als `DeviceId` fünf Erkennungen zu finden.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-138">The sample query below counts the number of unique devices (`DeviceId`) with antivirus detections and uses this count to find only the devices with more than five detections.</span></span> <span data-ttu-id="9f9bb-139">Um den neuesten und den entsprechenden Wert zurück zu geben, wird `Timestamp` der Operator mit der Funktion `ReportId` `summarize` `arg_max` verwendet.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-139">To return the latest `Timestamp` and the corresponding `ReportId`, it uses the `summarize` operator with the `arg_max` function.</span></span>

```kusto
DeviceEvents
| where Timestamp > ago(1d)
| where ActionType == "AntivirusDetection"
| summarize (Timestamp, ReportId)=arg_max(Timestamp, ReportId), count() by DeviceId
| where count_ > 5
```

> [!TIP]
> <span data-ttu-id="9f9bb-140">Um eine bessere Abfrageleistung zu erzielen, legen Sie einen Zeitfilter fest, der der beabsichtigten Ausführungshäufigkeit für die Regel entspricht.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-140">For better query performance, set a time filter that matches your intended run frequency for the rule.</span></span> <span data-ttu-id="9f9bb-141">Da die am wenigsten häufige Ausführung _alle 24 Stunden_ ausgeführt wird, werden alle neuen Daten nach dem letzten Tag gefiltert.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-141">Since the least frequent run is _every 24 hours_, filtering for the past day will cover all new data.</span></span>

### <a name="2-create-new-rule-and-provide-alert-details"></a><span data-ttu-id="9f9bb-142">2. Erstellen Sie eine neue Regel, und geben Sie Warnungsdetails an.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-142">2. Create new rule and provide alert details.</span></span>

<span data-ttu-id="9f9bb-143">Wählen Sie mit der Abfrage im Abfrage-Editor die Option "Erkennungsregel **erstellen"** aus, und geben Sie die folgenden Warnungsdetails an:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-143">With the query in the query editor, select **Create detection rule** and specify the following alert details:</span></span>

- <span data-ttu-id="9f9bb-144">**Erkennungsname**– Name der Erkennungsregel</span><span class="sxs-lookup"><span data-stu-id="9f9bb-144">**Detection name**—name of the detection rule</span></span>
- <span data-ttu-id="9f9bb-145">**Häufigkeit**– Intervall für die Ausführung der Abfrage und das Ausführen von Aktionen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-145">**Frequency**—interval for running the query and taking action.</span></span> [<span data-ttu-id="9f9bb-146">Weitere Anleitungen finden Sie weiter unten</span><span class="sxs-lookup"><span data-stu-id="9f9bb-146">See additional guidance below</span></span>](#rule-frequency)
- <span data-ttu-id="9f9bb-147">**Warnungstitel**– Titel mit von der Regel ausgelösten Warnungen</span><span class="sxs-lookup"><span data-stu-id="9f9bb-147">**Alert title**—title displayed with alerts triggered by the rule</span></span>
- <span data-ttu-id="9f9bb-148">**Schweregrad**– potenzielles Risiko der durch die Regel identifizierten Komponente oder Aktivität</span><span class="sxs-lookup"><span data-stu-id="9f9bb-148">**Severity**—potential risk of the component or activity identified by the rule</span></span>
- <span data-ttu-id="9f9bb-149">**Kategorie**– Bedrohungskomponente oder Aktivität, die durch die Regel identifiziert wird</span><span class="sxs-lookup"><span data-stu-id="9f9bb-149">**Category**—threat component or activity identified by the rule</span></span>
- <span data-ttu-id="9f9bb-150">**MITRE ATT&-CK-Techniken**– eine oder mehrere Angriffstechniken, die von der Regel identifiziert werden, wie im [MITRE ATT&CK Framework dokumentiert.](https://attack.mitre.org/)</span><span class="sxs-lookup"><span data-stu-id="9f9bb-150">**MITRE ATT&CK techniques**—one or more attack techniques identified by the rule as documented in the [MITRE ATT&CK framework](https://attack.mitre.org/).</span></span> <span data-ttu-id="9f9bb-151">Dieser Abschnitt ist für bestimmte Warnungskategorien ausgeblendet, z. B. Schadsoftware, Ransomware, verdächtige Aktivitäten und unerwünschte Software.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-151">This section is hidden for certain alert categories, including malware, ransomware, suspicious activity, and unwanted software</span></span>
- <span data-ttu-id="9f9bb-152">**Beschreibung**– weitere Informationen zur Komponente oder Aktivität, die von der Regel identifiziert wird</span><span class="sxs-lookup"><span data-stu-id="9f9bb-152">**Description**—more information about the component or activity identified by the rule</span></span> 
- <span data-ttu-id="9f9bb-153">**Empfohlene Aktionen**– zusätzliche Aktionen, die Responder als Reaktion auf eine Warnung ausführen können</span><span class="sxs-lookup"><span data-stu-id="9f9bb-153">**Recommended actions**—additional actions that responders might take in response to an alert</span></span>

#### <a name="rule-frequency"></a><span data-ttu-id="9f9bb-154">Regelhäufigkeit</span><span class="sxs-lookup"><span data-stu-id="9f9bb-154">Rule frequency</span></span>
<span data-ttu-id="9f9bb-155">Wenn Sie eine neue Regel speichern oder bearbeiten, wird sie ausgeführt und sucht nach Übereinstimmungen aus den daten der letzten 30 Tage.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-155">When you save or edit a new rule, it runs and checks for matches from the past 30 days of data.</span></span> <span data-ttu-id="9f9bb-156">Die Regel wird dann in festen Intervallen erneut ausgeführt, und es wird eine Lookbackdauer basierend auf der von Ihnen festgelegten Häufigkeit angewendet:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-156">The rule then runs again at fixed intervals, applying a lookback duration based on the frequency you choose:</span></span>

- <span data-ttu-id="9f9bb-157">**Alle 24 Stunden**– wird alle 24 Stunden ausgeführt und überprüft Daten aus den letzten 30 Tagen</span><span class="sxs-lookup"><span data-stu-id="9f9bb-157">**Every 24 hours**—runs every 24 hours, checking data from the past 30 days</span></span>
- <span data-ttu-id="9f9bb-158">**Alle 12 Stunden**– wird alle 12 Stunden ausgeführt und überprüft Dabei werden Daten aus den letzten 24 Stunden überprüft.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-158">**Every 12 hours**—runs every 12 hours, checking data from the past 24 hours</span></span>
- <span data-ttu-id="9f9bb-159">**Alle 3 Stunden –** wird alle 3 Stunden ausgeführt und überprüft Dabei werden Daten aus den letzten 6 Stunden überprüft.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-159">**Every 3 hours**—runs every 3 hours, checking data from the past 6 hours</span></span>
- <span data-ttu-id="9f9bb-160">**Jede Stunde**– wird stündlich ausgeführt und überprüft Daten aus den letzten 2 Stunden</span><span class="sxs-lookup"><span data-stu-id="9f9bb-160">**Every hour**—runs hourly, checking data from the past 2 hours</span></span>

>[!TIP]
> <span data-ttu-id="9f9bb-161">Match the time filters in your query with the lookback duration.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-161">Match the time filters in your query with the lookback duration.</span></span> <span data-ttu-id="9f9bb-162">Ergebnisse außerhalb der Lookbackdauer werden ignoriert.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-162">Results outside of the lookback duration are ignored.</span></span>  

<span data-ttu-id="9f9bb-163">Wählen Sie die Häufigkeit aus, mit der die Erkennungen überwacht werden.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-163">Select the frequency that matches how closely you want to monitor detections.</span></span> <span data-ttu-id="9f9bb-164">Berücksichtigen Sie die Kapazität Ihrer Organisation, auf die Warnungen zu reagieren.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-164">Consider your organization's capacity to respond to the alerts.</span></span>

### <a name="3-choose-the-impacted-entities"></a><span data-ttu-id="9f9bb-165">3. Wählen Sie die betroffenen Entitäten aus.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-165">3. Choose the impacted entities.</span></span>
<span data-ttu-id="9f9bb-166">Identifizieren Sie die Spalten in den Abfrageergebnissen, in denen Sie erwarten, die am stärksten betroffene oder betroffene Entität zu finden.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-166">Identify the columns in your query results where you expect to find the main affected or impacted entity.</span></span> <span data-ttu-id="9f9bb-167">Beispielsweise kann eine Abfrage Absender- ( oder ) und `SenderFromAddress` `SenderMailFromAddress` Empfängeradressen ( `RecipientEmailAddress` ) zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-167">For example, a query might return sender (`SenderFromAddress` or `SenderMailFromAddress`) and recipient (`RecipientEmailAddress`) addresses.</span></span> <span data-ttu-id="9f9bb-168">Die Identifizierung, welche dieser Spalten die am wichtigsten betroffenen Entitäten darstellen, hilft dem Dienst, relevante Warnungen zu aggregieren, Vorfälle zu korrelieren und Reaktionsaktionen zu erreichen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-168">Identifying which of these columns represent the main impacted entity helps the service aggregate relevant alerts, correlate incidents, and target response actions.</span></span>

<span data-ttu-id="9f9bb-169">Sie können für jeden Entitätstyp (Postfach, Benutzer oder Gerät) nur eine Spalte auswählen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-169">You can select only one column for each entity type (mailbox, user, or device).</span></span> <span data-ttu-id="9f9bb-170">Spalten, die nicht von der Abfrage zurückgegeben werden, können nicht ausgewählt werden.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-170">Columns that are not returned by your query can't be selected.</span></span>

### <a name="4-specify-actions"></a><span data-ttu-id="9f9bb-171">4. Angeben von Aktionen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-171">4. Specify actions.</span></span>
<span data-ttu-id="9f9bb-172">Ihre benutzerdefinierte Erkennungsregel kann automatisch Aktionen auf Geräten, Dateien oder Benutzern ausführen, die von der Abfrage zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-172">Your custom detection rule can automatically take actions on devices, files, or users that are returned by the query.</span></span>

#### <a name="actions-on-devices"></a><span data-ttu-id="9f9bb-173">Aktionen auf Geräten</span><span class="sxs-lookup"><span data-stu-id="9f9bb-173">Actions on devices</span></span>
<span data-ttu-id="9f9bb-174">Diese Aktionen werden auf Geräte in der `DeviceId` Spalte der Abfrageergebnisse angewendet:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-174">These actions are applied to devices in the `DeviceId` column of the query results:</span></span>
- <span data-ttu-id="9f9bb-175">**Gerät isolieren**– verwendet Microsoft Defender für Endpunkt, um eine vollständige Netzwerkisolation anzuwenden, was verhindert, dass das Gerät eine Verbindung mit einer Anwendung oder einem Dienst herstellen kann.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-175">**Isolate device**—uses Microsoft Defender for Endpoint to apply full network isolation, preventing the device from connecting to any application or service.</span></span> [<span data-ttu-id="9f9bb-176">Weitere Informationen zur Computerisolation von Microsoft Defender für Endpunkte</span><span class="sxs-lookup"><span data-stu-id="9f9bb-176">Learn more about Microsoft Defender for Endpoint machine isolation</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#isolate-devices-from-the-network)
- <span data-ttu-id="9f9bb-177">**Untersuchungspaket sammeln**– Sammelt Geräteinformationen in einer ZIP-Datei.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-177">**Collect investigation package**—collects device information in a ZIP file.</span></span> [<span data-ttu-id="9f9bb-178">Weitere Informationen zum Microsoft Defender for Endpoint-Untersuchungspaket</span><span class="sxs-lookup"><span data-stu-id="9f9bb-178">Learn more about the Microsoft Defender for Endpoint investigation package</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#collect-investigation-package-from-devices)
- <span data-ttu-id="9f9bb-179">**Ausführen eines Antivirenscans**– führt einen vollständigen Windows Defender Antivirusscan auf dem Gerät aus.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-179">**Run antivirus scan**—performs a full Windows Defender Antivirus scan on the device</span></span>
- <span data-ttu-id="9f9bb-180">**Untersuchung initiieren**– initiiert eine [automatisierte Untersuchung](mtp-autoir.md) auf dem Gerät</span><span class="sxs-lookup"><span data-stu-id="9f9bb-180">**Initiate investigation**—initiates an [automated investigation](mtp-autoir.md) on the device</span></span>
- <span data-ttu-id="9f9bb-181">**Einschränken der Ausführung von** Apps – legt Einschränkungen auf dem Gerät fest, damit nur Dateien ausgeführt werden können, die mit einem von Microsoft ausgestellten Zertifikat signiert sind.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-181">**Restrict app execution**—sets restrictions on device to allow only files that are signed with a Microsoft-issued certificate to run.</span></span> [<span data-ttu-id="9f9bb-182">Weitere Informationen zu Einschränkungen für Apps mit Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="9f9bb-182">Learn more about app restrictions with Microsoft Defender for Endpoint</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#restrict-app-execution)

#### <a name="actions-on-files"></a><span data-ttu-id="9f9bb-183">Aktionen für Dateien</span><span class="sxs-lookup"><span data-stu-id="9f9bb-183">Actions on files</span></span>
<span data-ttu-id="9f9bb-184">Wenn diese Option ausgewählt ist, können Sie die Aktion "Quarantänedatei" auf Dateien in der , oder Spalte der  `SHA1` `InitiatingProcessSHA1` `SHA256` `InitiatingProcessSHA256` Abfrageergebnisse anwenden.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-184">When selected, you can choose to apply the **Quarantine file** action on files in the `SHA1`, `InitiatingProcessSHA1`, `SHA256`, or `InitiatingProcessSHA256` column of the query results.</span></span> <span data-ttu-id="9f9bb-185">Diese Aktion löscht die Datei vom aktuellen Speicherort und platziert eine Kopie in Quarantäne.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-185">This action deletes the file from its current location and places a copy in quarantine.</span></span>

#### <a name="actions-on-users"></a><span data-ttu-id="9f9bb-186">Aktionen für Benutzer</span><span class="sxs-lookup"><span data-stu-id="9f9bb-186">Actions on users</span></span>
<span data-ttu-id="9f9bb-187">Wenn diese Option **ausgewählt** ist, wird der Benutzer als gefährdete Aktion für Benutzer in der , oder Spalte der `AccountObjectId` `InitiatingProcessAccountObjectId` `RecipientObjectId` Abfrageergebnisse markiert.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-187">When selected, the **Mark user as compromised** action is taken on users in the `AccountObjectId`, `InitiatingProcessAccountObjectId`, or `RecipientObjectId` column of the query results.</span></span> <span data-ttu-id="9f9bb-188">Diese Aktion legt die Risikostufe für Benutzer in Azure Active Directory auf "hoch" fest und löst entsprechende [Identitätsschutzrichtlinien aus.](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection)</span><span class="sxs-lookup"><span data-stu-id="9f9bb-188">This action sets the users risk level to "high" in Azure Active Directory, triggering corresponding [identity protection policies](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection).</span></span>

> [!NOTE]
> <span data-ttu-id="9f9bb-189">Die Aktion "Zulassen" oder "Blockieren" für benutzerdefinierte Erkennungsregeln wird derzeit in Microsoft 365 Defender nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-189">The allow or block action for custom detection rules is currently not supported on Microsoft 365 Defender.</span></span>

### <a name="5-set-the-rule-scope"></a><span data-ttu-id="9f9bb-190">5. Festlegen des Regelbereichs.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-190">5. Set the rule scope.</span></span>
<span data-ttu-id="9f9bb-191">Legen Sie den Bereich fest, um anzugeben, welche Geräte von der Regel abgedeckt werden.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-191">Set the scope to specify which devices are covered by the rule.</span></span> <span data-ttu-id="9f9bb-192">Der Bereich wirkt sich auf Regeln aus, die Geräte überprüfen, und wirkt sich nicht auf Regeln aus, die nur Postfächer und Benutzerkonten oder Identitäten überprüfen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-192">The scope influences rules that check devices and doesn't affect rules that check only mailboxes and user accounts or identities.</span></span>

<span data-ttu-id="9f9bb-193">Beim Festlegen des Bereichs können Sie Dies auswählen:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-193">When setting the scope, you can select:</span></span>

- <span data-ttu-id="9f9bb-194">Alle Geräte</span><span class="sxs-lookup"><span data-stu-id="9f9bb-194">All devices</span></span>
- <span data-ttu-id="9f9bb-195">Bestimmte Gerätegruppen</span><span class="sxs-lookup"><span data-stu-id="9f9bb-195">Specific device groups</span></span>

<span data-ttu-id="9f9bb-196">Nur Daten von Geräten im Gültigkeitsbereich werden abgefragt.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-196">Only data from devices in scope will be queried.</span></span> <span data-ttu-id="9f9bb-197">Außerdem werden Aktionen nur auf diesen Geräten ergriffen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-197">Also, actions will be taken only on those devices.</span></span>

### <a name="6-review-and-turn-on-the-rule"></a><span data-ttu-id="9f9bb-198">6. Überprüfen und aktivieren Sie die Regel.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-198">6. Review and turn on the rule.</span></span>
<span data-ttu-id="9f9bb-199">Nachdem Sie die Regel überprüft haben, wählen **Sie "Erstellen"** aus, um sie zu speichern.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-199">After reviewing the rule, select **Create** to save it.</span></span> <span data-ttu-id="9f9bb-200">Die benutzerdefinierte Erkennungsregel wird sofort ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-200">The custom detection rule immediately runs.</span></span> <span data-ttu-id="9f9bb-201">Sie wird basierend auf der konfigurierten Häufigkeit erneut ausgeführt, um nach Übereinstimmungen zu suchen, Warnungen zu generieren und Gegenmaßnahmen zu ergreifen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-201">It runs again based on configured frequency to check for matches, generate alerts, and take response actions.</span></span>

## <a name="manage-existing-custom-detection-rules"></a><span data-ttu-id="9f9bb-202">Verwalten vorhandener benutzerdefinierter Erkennungsregeln</span><span class="sxs-lookup"><span data-stu-id="9f9bb-202">Manage existing custom detection rules</span></span>
<span data-ttu-id="9f9bb-203">Sie können die Liste der vorhandenen benutzerdefinierten Erkennungsregeln anzeigen, ihre vorherigen Läufe überprüfen und die ausgelösten Warnungen überprüfen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-203">You can view the list of existing custom detection rules, check their previous runs, and review the alerts they have triggered.</span></span> <span data-ttu-id="9f9bb-204">Sie können eine Regel auch bei Bedarf ausführen und ändern.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-204">You can also run a rule on demand and modify it.</span></span>

### <a name="view-existing-rules"></a><span data-ttu-id="9f9bb-205">Anzeigen vorhandener Regeln</span><span class="sxs-lookup"><span data-stu-id="9f9bb-205">View existing rules</span></span>

<span data-ttu-id="9f9bb-206">Navigieren Sie zum Anzeigen aller vorhandenen benutzerdefinierten Erkennungsregeln zu **"Benutzerdefinierte**  >  **Erkennungen"**.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-206">To view all existing custom detection rules, navigate to **Hunting** > **Custom detections**.</span></span> <span data-ttu-id="9f9bb-207">Auf der Seite werden alle Regeln mit den folgenden Ausführungsinformationen aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-207">The page lists all the rules with the following run information:</span></span>

- <span data-ttu-id="9f9bb-208">**Letzte Ausführung –** wann eine Regel zuletzt ausgeführt wurde, um nach Abfrage übereinstimmungen zu suchen und Warnungen zu generieren</span><span class="sxs-lookup"><span data-stu-id="9f9bb-208">**Last run**—when a rule was last run to check for query matches and generate alerts</span></span>
- <span data-ttu-id="9f9bb-209">**Status der letzten Ausführung**– unabhängig davon, ob eine Regel erfolgreich ausgeführt wurde</span><span class="sxs-lookup"><span data-stu-id="9f9bb-209">**Last run status**—whether a rule ran successfully</span></span>
- <span data-ttu-id="9f9bb-210">**Nächste Ausführung –** nächste geplante Ausführung</span><span class="sxs-lookup"><span data-stu-id="9f9bb-210">**Next run**—the next scheduled run</span></span>
- <span data-ttu-id="9f9bb-211">**Status –** unabhängig davon, ob eine Regel aktiviert oder deaktiviert wurde</span><span class="sxs-lookup"><span data-stu-id="9f9bb-211">**Status**—whether a rule has been turned on or off</span></span>

### <a name="view-rule-details-modify-rule-and-run-rule"></a><span data-ttu-id="9f9bb-212">Anzeigen von Regeldetails, Ändern der Regel und Ausführen der Regel</span><span class="sxs-lookup"><span data-stu-id="9f9bb-212">View rule details, modify rule, and run rule</span></span>

<span data-ttu-id="9f9bb-213">Wenn Sie umfassende Informationen zu einer   >  benutzerdefinierten **Erkennungsregel** anzeigen wollen, wechseln Sie zu "Benutzerdefinierte Erkennungen" und wählen dann den Namen der Regel aus.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-213">To view comprehensive information about a custom detection rule, go to **Hunting** > **Custom detections** and then select the name of rule.</span></span> <span data-ttu-id="9f9bb-214">Anschließend können Sie allgemeine Informationen zur Regel anzeigen, einschließlich des Ausführungsstatus und des Gültigkeitsbereichs.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-214">You can then view general information about the rule, including information its run status and scope.</span></span> <span data-ttu-id="9f9bb-215">Die Seite enthält auch die Liste der ausgelösten Warnungen und Aktionen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-215">The page also provides the list of triggered alerts and actions.</span></span>

<span data-ttu-id="9f9bb-216">![Detailseite für benutzerdefinierte Erkennungsregel](../../media/custom-detection-details.png)</span><span class="sxs-lookup"><span data-stu-id="9f9bb-216">![Custom detection rule details page](../../media/custom-detection-details.png)</span></span><br>
<span data-ttu-id="9f9bb-217">*Details zu benutzerdefinierten Erkennungsregel*</span><span class="sxs-lookup"><span data-stu-id="9f9bb-217">*Custom detection rule details*</span></span>

<span data-ttu-id="9f9bb-218">Auf dieser Seite können Sie auch die folgenden Aktionen für die Regel ausführen:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-218">You can also take the following actions on the rule from this page:</span></span>

- <span data-ttu-id="9f9bb-219">**Ausführen**– Führen Sie die Regel sofort aus.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-219">**Run**—run the rule immediately.</span></span> <span data-ttu-id="9f9bb-220">Dadurch wird auch das Intervall für die nächste Ausführung zurückgesetzt.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-220">This also resets the interval for the next run.</span></span>
- <span data-ttu-id="9f9bb-221">**Bearbeiten**– Ändern der Regel ohne Ändern der Abfrage</span><span class="sxs-lookup"><span data-stu-id="9f9bb-221">**Edit**—modify the rule without changing the query</span></span>
- <span data-ttu-id="9f9bb-222">**Abfrage ändern –** Bearbeiten der Abfrage bei der erweiterten Suche</span><span class="sxs-lookup"><span data-stu-id="9f9bb-222">**Modify query**—edit the query in advanced hunting</span></span>
- <span data-ttu-id="9f9bb-223">**Aktivieren**  /  **Deaktivieren –** Aktivieren der Regel oder Beenden der Ausführung</span><span class="sxs-lookup"><span data-stu-id="9f9bb-223">**Turn on** / **Turn off**—enable the rule or stop it from running</span></span>
- <span data-ttu-id="9f9bb-224">**Löschen**– Deaktivieren der Regel und Entfernen</span><span class="sxs-lookup"><span data-stu-id="9f9bb-224">**Delete**—turn off the rule and remove it</span></span>

### <a name="view-and-manage-triggered-alerts"></a><span data-ttu-id="9f9bb-225">Anzeigen und Verwalten ausgelöster Warnungen</span><span class="sxs-lookup"><span data-stu-id="9f9bb-225">View and manage triggered alerts</span></span>

<span data-ttu-id="9f9bb-226">Wechseln Sie auf dem Bildschirm mit den Regeldetails **(** Suche nach benutzerdefinierten Erkennungen  >    >  **[Regelname]**) zu "Ausgelöste Warnungen", in dem die durch Übereinstimmungen mit der Regel generierten Warnungen aufgeführt sind.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-226">In the rule details screen (**Hunting** > **Custom detections** > **[Rule name]**), go to  **Triggered alerts**, which lists the alerts generated by matches to the rule.</span></span> <span data-ttu-id="9f9bb-227">Wählen Sie eine Warnung aus, um detaillierte Informationen zu dieser Warnung ein, und ergreifen Sie die folgenden Aktionen:</span><span class="sxs-lookup"><span data-stu-id="9f9bb-227">Select an alert to view detailed information about it and take the following actions:</span></span>

- <span data-ttu-id="9f9bb-228">Verwalten der Warnung durch Festlegen des Status und der Klassifizierung (wahr oder falsch)</span><span class="sxs-lookup"><span data-stu-id="9f9bb-228">Manage the alert by setting its status and classification (true or false alert)</span></span>
- <span data-ttu-id="9f9bb-229">Verknüpfen der Warnung mit einem Vorfall</span><span class="sxs-lookup"><span data-stu-id="9f9bb-229">Link the alert to an incident</span></span>
- <span data-ttu-id="9f9bb-230">Ausführen der Abfrage, die die Warnung bei der erweiterten Suche ausgelöst hat</span><span class="sxs-lookup"><span data-stu-id="9f9bb-230">Run the query that triggered the alert on advanced hunting</span></span>

### <a name="review-actions"></a><span data-ttu-id="9f9bb-231">Überprüfen von Aktionen</span><span class="sxs-lookup"><span data-stu-id="9f9bb-231">Review actions</span></span>
<span data-ttu-id="9f9bb-232">Wechseln Sie auf dem Bildschirm mit den Regeldetails **(** Suche nach benutzerdefinierten Erkennungen  >    >  **[Regelname]**) zu "Ausgelöste Aktionen", in dem die auf Übereinstimmungen mit der Regel basierenden Aktionen aufgeführt sind.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-232">In the rule details screen (**Hunting** > **Custom detections** > **[Rule name]**), go to **Triggered actions**, which lists the actions taken based on matches to the rule.</span></span>

>[!TIP]
><span data-ttu-id="9f9bb-233">Verwenden Sie die Auswahlspalte [&#10003;] am linken Ende der Tabelle, um schnell Informationen anzeigen und Aktionen für ein Element in einer Tabelle zu ergreifen.</span><span class="sxs-lookup"><span data-stu-id="9f9bb-233">To quickly view information and take action on an item in a table, use the selection column [&#10003;] at the left of the table.</span></span>

## <a name="see-also"></a><span data-ttu-id="9f9bb-234">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="9f9bb-234">See also</span></span>
- [<span data-ttu-id="9f9bb-235">Benutzerdefinierte Erkennungen – Übersicht</span><span class="sxs-lookup"><span data-stu-id="9f9bb-235">Custom detections overview</span></span>](custom-detections-overview.md)
- [<span data-ttu-id="9f9bb-236">Übersicht über die erweiterte Suche</span><span class="sxs-lookup"><span data-stu-id="9f9bb-236">Advanced hunting overview</span></span>](advanced-hunting-overview.md)
- [<span data-ttu-id="9f9bb-237">Erlernen der Abfragesprache für die erweiterte Suche</span><span class="sxs-lookup"><span data-stu-id="9f9bb-237">Learn the advanced hunting query language</span></span>](advanced-hunting-query-language.md)
- [<span data-ttu-id="9f9bb-238">Migrieren erweiterter Suchabfragen von Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="9f9bb-238">Migrate advanced hunting queries from Microsoft Defender for Endpoint</span></span>](advanced-hunting-migrate-from-mdatp.md)
