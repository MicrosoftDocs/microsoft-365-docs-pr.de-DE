---
title: Erkennen und Behebung von unerlaubten Zustimmungsermings
f1.keywords:
- NOCSH
ms.author: tracyp
author: MSFTTracyp
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: article
ms.collection:
- o365_security_incident_response
- M365-security-compliance
localization_priority: Normal
search.appverid:
- MET150
description: Erfahren Sie, wie Sie den angriffswilligen Zustimmungsermungsangriff in Microsoft Office 365 erkennen und besennen.
ms.custom: seo-marvel-apr2020
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 2a50ce58d91d2ff7b2e31e57830289c870364d9b
ms.sourcegitcommit: 786f90a163d34c02b8451d09aa1efb1e1d5f543c
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/18/2021
ms.locfileid: "50288287"
---
# <a name="detect-and-remediate-illicit-consent-grants"></a><span data-ttu-id="b3f86-103">Erkennen und Behebung von unerlaubten Zustimmungsermings</span><span class="sxs-lookup"><span data-stu-id="b3f86-103">Detect and Remediate Illicit Consent Grants</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

<span data-ttu-id="b3f86-104">**Gilt für**</span><span class="sxs-lookup"><span data-stu-id="b3f86-104">**Applies to**</span></span>
- [<span data-ttu-id="b3f86-105">Microsoft Defender für Office 365 Plan 1 und Plan 2</span><span class="sxs-lookup"><span data-stu-id="b3f86-105">Microsoft Defender for Office 365 plan 1 and plan 2</span></span>](office-365-atp.md)
- [<span data-ttu-id="b3f86-106">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="b3f86-106">Microsoft 365 Defender</span></span>](../mtp/microsoft-threat-protection.md)

<span data-ttu-id="b3f86-107">**Zusammenfassung**  Erfahren Sie, wie Sie den Angriff in Office 365 erkennen und die unrechtmäßige Zustimmungsermungsermung erkennen und besennen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-107">**Summary**  Learn how to recognize and remediate the illicit consent grants attack in Office 365.</span></span>

## <a name="what-is-the-illicit-consent-grant-attack-in-office-365"></a><span data-ttu-id="b3f86-108">Was ist der Angriff auf die erteilungswillige Zustimmung in Office 365?</span><span class="sxs-lookup"><span data-stu-id="b3f86-108">What is the illicit consent grant attack in Office 365?</span></span>

<span data-ttu-id="b3f86-109">Bei einem Angriff auf eine unrechtmäßige Genehmigung erstellt der Angreifer eine in Azure registrierte Anwendung, die Zugriff auf Daten wie Kontaktinformationen, E-Mails oder Dokumente anfordert.</span><span class="sxs-lookup"><span data-stu-id="b3f86-109">In an illicit consent grant attack, the attacker creates an Azure-registered application that requests access to data such as contact information, email, or documents.</span></span> <span data-ttu-id="b3f86-110">Der Angreifer trickst dann einen Endbenutzer dazu, dieser Anwendung die Zustimmung zu erteilen, entweder über einen Phishingangriff auf ihre Daten zugreift, oder indem er unzulässigen Code in eine vertrauenswürdige Website einfing.</span><span class="sxs-lookup"><span data-stu-id="b3f86-110">The attacker then tricks an end user into granting that application consent to access their data either through a phishing attack, or by injecting illicit code into a trusted website.</span></span> <span data-ttu-id="b3f86-111">Nachdem der unrechtmäßigen Anwendung die Zustimmung erteilt wurde, hat sie Zugriff auf Daten auf Kontoebene, ohne dass ein Organisationskonto benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="b3f86-111">After the illicit application has been granted consent, it has account-level access to data without the need for an organizational account.</span></span> <span data-ttu-id="b3f86-112">Normale Korrekturschritte, z. B. das Zurücksetzen von Kennwörtern für gesperrte Konten oder das Erfordern der mehrstufigen Authentifizierung (Multi-Factor Authentication, MFA) für Konten, sind bei dieser Art von Angriffen nicht effektiv, da es sich um Anwendungen von Drittanbietern handelt und außerhalb der Organisation liegen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-112">Normal remediation steps, like resetting passwords for breached accounts or requiring Multi-Factor Authentication (MFA) on accounts, are not effective against this type of attack, since these are third-party applications and are external to the organization.</span></span>

<span data-ttu-id="b3f86-113">Diese Angriffe nutzen ein Interaktionsmodell, bei dem davon ausgegangen wird, dass es sich bei der Entität, die die Informationen aufruft, um Automatisierung und nicht um einen Menschen handelt.</span><span class="sxs-lookup"><span data-stu-id="b3f86-113">These attacks leverage an interaction model which presumes the entity that is calling the information is automation and not a human.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b3f86-114">Verdächtigen Sie, dass Sie derzeit Probleme mit unrechtmäßigen Zustimmungsermächtigungsermächtigen von einer App haben?</span><span class="sxs-lookup"><span data-stu-id="b3f86-114">Do you suspect you're experiencing problems with illicit consent-grants from an app, right now?</span></span> <span data-ttu-id="b3f86-115">Microsoft Cloud App Security (MCAS) verfügt über Tools zum Erkennen, Untersuchen und Beheern Ihrer OAuth-Apps.</span><span class="sxs-lookup"><span data-stu-id="b3f86-115">Microsoft Cloud App Security (MCAS) has tools to detect, investigate, and remediate your OAuth apps.</span></span> <span data-ttu-id="b3f86-116">Dieser MCAS-Artikel enthält ein Lernprogramm, in dem die Untersuchung [riskanter OAuth-Apps erläutert wird.](https://docs.microsoft.com/cloud-app-security/investigate-risky-oauth)</span><span class="sxs-lookup"><span data-stu-id="b3f86-116">This MCAS article has a tutorial that outlines how to go about [investigating risky OAuth apps](https://docs.microsoft.com/cloud-app-security/investigate-risky-oauth).</span></span> <span data-ttu-id="b3f86-117">Sie können auch [OAuth-App-Richtlinien](https://docs.microsoft.com/cloud-app-security/app-permission-policy) festlegen, um von der App angeforderte Berechtigungen zu untersuchen, welche Benutzer diese Apps autorisieren, und diese Berechtigungsanforderungen allgemein genehmigen oder verbieten.</span><span class="sxs-lookup"><span data-stu-id="b3f86-117">You can also set [OAuth app policies](https://docs.microsoft.com/cloud-app-security/app-permission-policy) to investigate app-requested permissions, which users are authorizing these apps, and widely approve or ban these permissions requests.</span></span>

## <a name="what-does-an-illicit-consent-grant-attack-look-like-in-office-365"></a><span data-ttu-id="b3f86-118">Wie sieht ein angriffswilliger Zustimmungserteilungsangriff in Office 365 aus?</span><span class="sxs-lookup"><span data-stu-id="b3f86-118">What does an illicit consent grant attack look like in Office 365?</span></span>

<span data-ttu-id="b3f86-119">Sie müssen das **Überwachungsprotokoll** durchsuchen, um Nachzeichen zu finden, die auch als Indicators of Compromise (IOC) für diesen Angriff bezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="b3f86-119">You need to search the **audit log** to find signs, also called Indicators of Compromise (IOC) of this attack.</span></span> <span data-ttu-id="b3f86-120">Für Organisationen mit vielen in Azure registrierten Anwendungen und einer großen Benutzerbasis besteht die bewährte Methode in der wöchentlichen Überprüfung der Zustimmungsermung Ihrer Organisation.</span><span class="sxs-lookup"><span data-stu-id="b3f86-120">For organizations with many Azure-registered applications and a large user base, the best practice is to review your organizations consent grants on a weekly basis.</span></span>

### <a name="steps-for-finding-signs-of-this-attack"></a><span data-ttu-id="b3f86-121">Schritte zum Suchen nach Anzeichen für diesen Angriff</span><span class="sxs-lookup"><span data-stu-id="b3f86-121">Steps for finding signs of this attack</span></span>

1. <span data-ttu-id="b3f86-122">Öffnen Sie **das Security & Compliance Center unter** <https://protection.office.com> .</span><span class="sxs-lookup"><span data-stu-id="b3f86-122">Open the **Security & Compliance Center** at <https://protection.office.com>.</span></span>

2. <span data-ttu-id="b3f86-123">Navigieren Sie zu **"Suchen",** und wählen **Sie "Überwachungsprotokollsuche" aus.**</span><span class="sxs-lookup"><span data-stu-id="b3f86-123">Navigate to **Search** and select **Audit log search**.</span></span>

3. <span data-ttu-id="b3f86-124">Suchen Sie (alle Aktivitäten und alle Benutzer), geben Sie bei Bedarf das Start- und Enddatum ein, und klicken Sie dann auf **"Suchen".**</span><span class="sxs-lookup"><span data-stu-id="b3f86-124">Search (all activities and all users) and enter the start date and end date if required and then click **Search**.</span></span>

4. <span data-ttu-id="b3f86-125">Klicken **Sie auf "Ergebnisse filtern",** und geben Sie "Zustimmung zur Anwendung" in das Feld **"Aktivität"** ein.</span><span class="sxs-lookup"><span data-stu-id="b3f86-125">Click **Filter results** and enter Consent to application in the **Activity** field.</span></span>

5. <span data-ttu-id="b3f86-126">Klicken Sie auf das Ergebnis, um die Details der Aktivität anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-126">Click on the result to see the details of the activity.</span></span> <span data-ttu-id="b3f86-127">Klicken **Sie auf "Weitere Informationen",** um Details zu der Aktivität zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="b3f86-127">Click **More Information** to get details of the activity.</span></span> <span data-ttu-id="b3f86-128">Überprüfen Sie, ob IsAdminContent auf "True" festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="b3f86-128">Check to see if IsAdminContent is set to True.</span></span>

> [!NOTE]
>
> <span data-ttu-id="b3f86-129">Es kann zwischen 30 Minuten und 24 Stunden dauern, bis der entsprechende Überwachungsprotokolleintrag in den Suchergebnissen angezeigt wird, nachdem ein Ereignis eintritt.</span><span class="sxs-lookup"><span data-stu-id="b3f86-129">It can take from 30 minutes up to 24 hours for the corresponding audit log entry to be displayed in the search results after an event occurs.</span></span>
>
> <span data-ttu-id="b3f86-130">Die Dauer, für die ein Überwachungsdatensatz aufbewahrt und im Überwachungsprotokoll durchsuchbar ist, hängt von Ihrem Microsoft 365-Abonnement und insbesondere vom Lizenztyp ab, der einem bestimmten Benutzer zugewiesen ist.</span><span class="sxs-lookup"><span data-stu-id="b3f86-130">The length of time that an audit record is retained and searchable in the audit log depends on your Microsoft 365 subscription, and specifically the type of the license that is assigned to a specific user.</span></span> <span data-ttu-id="b3f86-131">Weitere Informationen finden Sie im [Überwachungsprotokoll.](../../compliance/search-the-audit-log-in-security-and-compliance.md)</span><span class="sxs-lookup"><span data-stu-id="b3f86-131">For more information, see [Audit log](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span></span>
>
> <span data-ttu-id="b3f86-132">Wenn dieser Wert "true" ist, weist dies darauf hin, dass eine Person mit zugriff auf globaler Administrator möglicherweise einen umfassenden Zugriff auf Daten gewährt hat.</span><span class="sxs-lookup"><span data-stu-id="b3f86-132">If this value is true, it indicates that someone with Global Administrator access may have granted broad access to data.</span></span> <span data-ttu-id="b3f86-133">Wenn dies unerwartet ist, führen Sie Schritte aus, um [einen Angriff zu bestätigen.](#how-to-confirm-an-attack)</span><span class="sxs-lookup"><span data-stu-id="b3f86-133">If this is unexpected, take steps to [confirm an attack](#how-to-confirm-an-attack).</span></span>

## <a name="how-to-confirm-an-attack"></a><span data-ttu-id="b3f86-134">So bestätigen Sie einen Angriff</span><span class="sxs-lookup"><span data-stu-id="b3f86-134">How to confirm an attack</span></span>

<span data-ttu-id="b3f86-135">Wenn Sie eine oder mehrere Instanzen der oben aufgeführten IOCs haben, müssen Sie weitere Untersuchungen unternehmen, um zu bestätigen, dass der Angriff aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="b3f86-135">If you have one or more instances of the IOCs listed above, you need to do further investigation to positively confirm that the attack occurred.</span></span> <span data-ttu-id="b3f86-136">Sie können eine dieser drei Methoden verwenden, um den Angriff zu bestätigen:</span><span class="sxs-lookup"><span data-stu-id="b3f86-136">You can use any of these three methods to confirm the attack:</span></span>

- <span data-ttu-id="b3f86-137">Inventarisierung von Anwendungen und deren Berechtigungen mithilfe des Azure Active Directory-Portals.</span><span class="sxs-lookup"><span data-stu-id="b3f86-137">Inventory applications and their permissions using the Azure Active Directory portal.</span></span> <span data-ttu-id="b3f86-138">Diese Methode ist sorgfältig, Aber Sie können nur einen Benutzer gleichzeitig überprüfen, was sehr zeitaufwändig sein kann, wenn Sie viele Benutzer zu überprüfen haben.</span><span class="sxs-lookup"><span data-stu-id="b3f86-138">This method is thorough, but you can only check one user at a time which can be very time consuming if you have many users to check.</span></span>

- <span data-ttu-id="b3f86-139">Inventarisierung von Anwendungen und deren Berechtigungen mithilfe von PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b3f86-139">Inventory applications and their permissions using PowerShell.</span></span> <span data-ttu-id="b3f86-140">Dies ist die schnellste und gründlichste Methode mit dem geringsten Aufwand.</span><span class="sxs-lookup"><span data-stu-id="b3f86-140">This is the fastest and most thorough method, with the least amount of overhead.</span></span>

- <span data-ttu-id="b3f86-141">Lassen Sie Ihre Benutzer ihre Apps und Berechtigungen einzeln überprüfen und die Ergebnisse zur Problembehebung an die Administratoren zurücksenennen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-141">Have your users individually check their apps and permissions and report the results back to the administrators for remediation.</span></span>

## <a name="inventory-apps-with-access-in-your-organization"></a><span data-ttu-id="b3f86-142">Inventarisierung von Apps mit Zugriff in Ihrer Organisation</span><span class="sxs-lookup"><span data-stu-id="b3f86-142">Inventory apps with access in your organization</span></span>

<span data-ttu-id="b3f86-143">Sie können dies für Ihre Benutzer entweder über das Azure Active Directory-Portal oder PowerShell oder ihre Benutzer einzeln aufzählen lassen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-143">You can do this for your users with either the Azure Active Directory Portal, or PowerShell or have your users individually enumerate their application access.</span></span>

### <a name="steps-for-using-the-azure-active-directory-portal"></a><span data-ttu-id="b3f86-144">Schritte für die Verwendung des Azure Active Directory-Portals</span><span class="sxs-lookup"><span data-stu-id="b3f86-144">Steps for using the Azure Active Directory Portal</span></span>

<span data-ttu-id="b3f86-145">Sie können die Anwendungen nachschauen, für die jeder einzelne Benutzer Berechtigungen erteilt hat, indem Sie das [Azure Active Directory Portal verwenden.](https://portal.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="b3f86-145">You can look up the applications to which any individual user has granted permissions by using the [Azure Active Directory Portal](https://portal.azure.com/).</span></span>

1. <span data-ttu-id="b3f86-146">Melden Sie sich beim Azure Portal mit Administratorrechten an.</span><span class="sxs-lookup"><span data-stu-id="b3f86-146">Sign in to the Azure Portal with administrative rights.</span></span>

2. <span data-ttu-id="b3f86-147">Wählen Sie das Blatt Azure Active Directory aus.</span><span class="sxs-lookup"><span data-stu-id="b3f86-147">Select the Azure Active Directory blade.</span></span>

3. <span data-ttu-id="b3f86-148">Wählen Sie **Benutzer** aus.</span><span class="sxs-lookup"><span data-stu-id="b3f86-148">Select **Users**.</span></span>

4. <span data-ttu-id="b3f86-149">Wählen Sie den Benutzer aus, den Sie überprüfen möchten.</span><span class="sxs-lookup"><span data-stu-id="b3f86-149">Select the user that you want to review.</span></span>

5. <span data-ttu-id="b3f86-150">Wählen Sie **Anwendungen aus.**</span><span class="sxs-lookup"><span data-stu-id="b3f86-150">Select **Applications**.</span></span>

<span data-ttu-id="b3f86-151">Dadurch werden die Apps angezeigt, die dem Benutzer zugewiesen sind, und welche Berechtigungen die Anwendungen besitzen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-151">This will show you the apps that are assigned to the user and what permissions the applications have.</span></span>

### <a name="steps-for-having-your-users-enumerate-their-application-access"></a><span data-ttu-id="b3f86-152">Schritte zum Aufzählen des Anwendungszugriffs durch die Benutzer</span><span class="sxs-lookup"><span data-stu-id="b3f86-152">Steps for having your users enumerate their application access</span></span>

<span data-ttu-id="b3f86-153">Lassen Sie Ihre Benutzer dort https://myapps.microsoft.com ihre eigenen Anwendungszugriffe überprüfen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-153">Have your users go to https://myapps.microsoft.com and review their own application access there.</span></span> <span data-ttu-id="b3f86-154">Sie sollten in der Lage sein, alle Apps mit Zugriff anzuzeigen, Details zu ihnen anzuzeigen (einschließlich des Zugriffsumfangs), und in der Lage sein, Berechtigungen für verdächtige oder unzulässige Apps zu widerrufen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-154">They should be able to see all the apps with access, view details about them (including the scope of access), and be able to revoke privileges to suspicious or illicit apps.</span></span>

### <a name="steps-for-doing-this-with-powershell"></a><span data-ttu-id="b3f86-155">Schritte dazu mit PowerShell</span><span class="sxs-lookup"><span data-stu-id="b3f86-155">Steps for doing this with PowerShell</span></span>

<span data-ttu-id="b3f86-156">Die einfachste Möglichkeit zum Überprüfen des Angriffs auf die gewährungswillige Zustimmung besteht in der Ausführung von [Get-AzureADPSPermissions.ps1, ](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09)wodurch alle OAuth-Zustimmungserteilungen und -OAuth-Apps für alle Benutzer in Ihrem Mandanz in einer CSV-Datei gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="b3f86-156">The simplest way to verify the Illicit Consent Grant attack is to run [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), which will dump all the OAuth consent grants and OAuth apps for all users in your tenancy into one .csv file.</span></span>

#### <a name="pre-requisites"></a><span data-ttu-id="b3f86-157">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="b3f86-157">Pre-requisites</span></span>

- <span data-ttu-id="b3f86-158">Die installierte Azure AD PowerShell-Bibliothek.</span><span class="sxs-lookup"><span data-stu-id="b3f86-158">The Azure AD PowerShell library installed.</span></span>

- <span data-ttu-id="b3f86-159">Globale Administratorrechte für den Mandanten, für den das Skript ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="b3f86-159">Global administrator rights on the tenant that the script will be run against.</span></span>

- <span data-ttu-id="b3f86-160">Lokaler Administrator auf dem Computer, auf dem die Skripts ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="b3f86-160">Local Administrator on the computer from which will run the scripts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b3f86-161">Es ***wird dringend empfohlen,*** dass Sie die mehrstufige Authentifizierung für Ihr Administratorkonto benötigen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-161">We ***highly recommend*** that you require multi-factor authentication on your administrative account.</span></span> <span data-ttu-id="b3f86-162">Dieses Skript unterstützt die MFA-Authentifizierung.</span><span class="sxs-lookup"><span data-stu-id="b3f86-162">This script supports MFA authentication.</span></span>

1. <span data-ttu-id="b3f86-163">Melden Sie sich bei dem Computer an, auf dem Sie das Skript ausführen, mit lokalen Administratorrechten.</span><span class="sxs-lookup"><span data-stu-id="b3f86-163">Sign in to the computer that you will run the script from with local administrator rights.</span></span>

2. <span data-ttu-id="b3f86-164">Laden Sie das Skript [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) GitHub herunter, oder kopieren Sie es in einen Ordner, aus dem Sie das Skript ausführen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-164">Download or copy the [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) script from GitHub to a folder from which you will run the script.</span></span> <span data-ttu-id="b3f86-165">Dies ist derselbe Ordner, in den die Ausgabedatei "permissions.csv" geschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="b3f86-165">This will be the same folder to which the output "permissions.csv" file will be written.</span></span>

3. <span data-ttu-id="b3f86-166">Öffnen Sie eine PowerShell-Instanz als Administrator, und öffnen Sie den Ordner, in dem Sie das Skript gespeichert haben.</span><span class="sxs-lookup"><span data-stu-id="b3f86-166">Open a PowerShell instance as an administrator and open to the folder you saved the script to.</span></span>

4. <span data-ttu-id="b3f86-167">Stellen Sie mithilfe des [Connect-AzureAD-Cmdlets](https://docs.microsoft.com/powershell/module/azuread/connect-azuread) eine Verbindung mit Ihrem Verzeichnis herzustellen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-167">Connect to your directory using the [Connect-AzureAD](https://docs.microsoft.com/powershell/module/azuread/connect-azuread) cmdlet.</span></span>

5. <span data-ttu-id="b3f86-168">Führen Sie diesen PowerShell-Befehl aus:</span><span class="sxs-lookup"><span data-stu-id="b3f86-168">Run this PowerShell command:</span></span>

   ```powershell
   Get-AzureADPSPermissions.ps1 | Export-csv -Path "Permissions.csv" -NoTypeInformation
   ```

<span data-ttu-id="b3f86-169">Das Skript erzeugt eine Datei namens Permissions.csv.</span><span class="sxs-lookup"><span data-stu-id="b3f86-169">The script produces one file named Permissions.csv.</span></span> <span data-ttu-id="b3f86-170">Führen Sie die folgenden Schritte aus, um nach unzulässigen Anwendungsberechtigungen zu suchen:</span><span class="sxs-lookup"><span data-stu-id="b3f86-170">Follow these steps to look for illicit application permission grants:</span></span>

1. <span data-ttu-id="b3f86-171">Suchen Sie in der Spalte "ConsentType" (Spalte G) nach dem Wert "AllPrinciples".</span><span class="sxs-lookup"><span data-stu-id="b3f86-171">In the ConsentType column (column G) search for the value "AllPrinciples".</span></span> <span data-ttu-id="b3f86-172">Mit der Berechtigung "AllPrincipals" kann die Clientanwendung auf alle Inhalte im Mandanten zugreifen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-172">The AllPrincipals permission allows the client application to access everyone's content in the tenancy.</span></span> <span data-ttu-id="b3f86-173">Systemeigene Microsoft 365-Anwendungen benötigen diese Berechtigung, um ordnungsgemäß zu funktionieren.</span><span class="sxs-lookup"><span data-stu-id="b3f86-173">Native Microsoft 365 applications need this permission to work correctly.</span></span> <span data-ttu-id="b3f86-174">Jede Nicht-Microsoft-Anwendung mit dieser Berechtigung sollte sorgfältig überprüft werden.</span><span class="sxs-lookup"><span data-stu-id="b3f86-174">Every non-Microsoft application with this permission should be reviewed carefully.</span></span>

2. <span data-ttu-id="b3f86-175">Überprüfen Sie in der Spalte "Berechtigung" (Spalte F) die Berechtigungen, die jede delegierte Anwendung für Inhalte hat.</span><span class="sxs-lookup"><span data-stu-id="b3f86-175">In the Permission column (column F) review the permissions that each delegated application has to content.</span></span> <span data-ttu-id="b3f86-176">Suchen Sie nach der Berechtigung "Lesen" und "Schreiben" oder "\*". Alle"-Berechtigungen, und überprüfen Sie diese sorgfältig, da sie möglicherweise nicht geeignet sind.</span><span class="sxs-lookup"><span data-stu-id="b3f86-176">Look for "Read" and "Write" permission or "\*.All" permission, and review these carefully because they may not be appropriate.</span></span>

3. <span data-ttu-id="b3f86-177">Überprüfen Sie die spezifischen Benutzer, deren Zustimmung erteilt wurde.</span><span class="sxs-lookup"><span data-stu-id="b3f86-177">Review the specific users that have consents granted.</span></span> <span data-ttu-id="b3f86-178">Wenn Benutzern mit hoher Profil- oder hoher Auswirkung unangemessene Zustimmungen erteilt wurden, sollten Sie dies weiter untersuchen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-178">If high profile or high impact users have inappropriate consents granted, you should investigate further.</span></span>

4. <span data-ttu-id="b3f86-179">Suchen Sie in der Spalte "ClientDisplayName" (Spalte C) nach Apps, die verdächtig erscheinen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-179">In the ClientDisplayName column (column C) look for apps that seem suspicious.</span></span> <span data-ttu-id="b3f86-180">Apps mit falsch geschriebenen Namen, Super-BLAND-Namen oder Hackernamen sollten sorgfältig überprüft werden.</span><span class="sxs-lookup"><span data-stu-id="b3f86-180">Apps with misspelled names, super bland names, or hacker-sounding names should be reviewed carefully.</span></span>

## <a name="determine-the-scope-of-the-attack"></a><span data-ttu-id="b3f86-181">Bestimmen des Umfangs des Angriffs</span><span class="sxs-lookup"><span data-stu-id="b3f86-181">Determine the scope of the attack</span></span>

<span data-ttu-id="b3f86-182">Nachdem Sie die Bestandsaufnahme des Anwendungszugriffs abgeschlossen haben, überprüfen Sie das **Überwachungsprotokoll,** um den vollständigen Umfang der Verletzung zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="b3f86-182">After you have finished inventorying application access, review the **audit log** to determine the full scope of the breach.</span></span> <span data-ttu-id="b3f86-183">Suchen Sie nach den betroffenen Benutzern, den Zeitrahmen, auf die die verbotene Anwendung Zugriff auf Ihre Organisation hatte, und den Berechtigungen, die die App hatte.</span><span class="sxs-lookup"><span data-stu-id="b3f86-183">Search on the affected users, the time frames that the illicit application had access to your organization, and the permissions the app had.</span></span> <span data-ttu-id="b3f86-184">Sie können das **Überwachungsprotokoll im** [Microsoft 365 Security and Compliance Center durchsuchen.](../../compliance/search-the-audit-log-in-security-and-compliance.md)</span><span class="sxs-lookup"><span data-stu-id="b3f86-184">You can search the **audit log** in the [Microsoft 365 Security and Compliance Center](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b3f86-185">[Postfachüberwachung](../../compliance/enable-mailbox-auditing.md) und [Aktivitätsüberwachung für](../../compliance/turn-audit-log-search-on-or-off.md) Administratoren und Benutzer müssen vor dem Angriff aktiviert worden sein, damit Sie diese Informationen erhalten können.</span><span class="sxs-lookup"><span data-stu-id="b3f86-185">[Mailbox auditing](../../compliance/enable-mailbox-auditing.md) and [Activity auditing for admins and users](../../compliance/turn-audit-log-search-on-or-off.md) must have been enabled prior to the attack for you to get this information.</span></span>

## <a name="how-to-stop-and-remediate-an-illicit-consent-grant-attack"></a><span data-ttu-id="b3f86-186">Beenden und Behebung eines Angriffs auf eine unrechtmäßige Zustimmungserteilung</span><span class="sxs-lookup"><span data-stu-id="b3f86-186">How to stop and remediate an illicit consent grant attack</span></span>

<span data-ttu-id="b3f86-187">Nachdem Sie eine Anwendung mit unzulässigen Berechtigungen identifiziert haben, haben Sie mehrere Möglichkeiten, diesen Zugriff zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-187">After you have identified an application with illicit permissions, you have several ways to remove that access.</span></span>

- <span data-ttu-id="b3f86-188">Sie können die Berechtigung der Anwendung im Azure Active Directory Portal widerrufen, indem Sie:</span><span class="sxs-lookup"><span data-stu-id="b3f86-188">You can revoke the application's permission in the Azure Active Directory Portal by:</span></span>

  - <span data-ttu-id="b3f86-189">Navigieren Sie im Blatt **"Azure Active Directory-Benutzer"** zu dem betroffenen Benutzer.</span><span class="sxs-lookup"><span data-stu-id="b3f86-189">Navigate to the affected user in the **Azure Active Directory User** blade.</span></span>

  - <span data-ttu-id="b3f86-190">Wählen Sie **Anwendungen aus.**</span><span class="sxs-lookup"><span data-stu-id="b3f86-190">Select **Applications**.</span></span>

  - <span data-ttu-id="b3f86-191">Wählen Sie die unzulässige Anwendung aus.</span><span class="sxs-lookup"><span data-stu-id="b3f86-191">Select the illicit application.</span></span>

  - <span data-ttu-id="b3f86-192">Klicken **Sie im** Drilldown auf "Entfernen".</span><span class="sxs-lookup"><span data-stu-id="b3f86-192">Click **Remove** in the drill down.</span></span>

- <span data-ttu-id="b3f86-193">Sie können die OAuth-Zustimmungserteilung mit PowerShell widerrufen, indem Sie die Schritte in ["Remove-AzureADOAuth2PermissionGrant" ausführen.](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant)</span><span class="sxs-lookup"><span data-stu-id="b3f86-193">You can revoke the OAuth consent grant with PowerShell by following the steps in [Remove-AzureADOAuth2PermissionGrant](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant).</span></span>

- <span data-ttu-id="b3f86-194">Sie können die Dienst-App-Rollenzuweisung mit PowerShell widerrufen, indem Sie die Schritte in ["Remove-AzureADServiceAppRoleAssignment" ausführen.](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment)</span><span class="sxs-lookup"><span data-stu-id="b3f86-194">You can revoke the Service App Role Assignment with PowerShell by following the steps in [Remove-AzureADServiceAppRoleAssignment](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment).</span></span>

- <span data-ttu-id="b3f86-195">Sie können die Anmeldung für das betroffene Konto auch vollständig deaktivieren, wodurch wiederum der Zugriff der App auf Daten in diesem Konto deaktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="b3f86-195">You can also disable sign-in for the affected account altogether, which will in turn disable app access to data in that account.</span></span> <span data-ttu-id="b3f86-196">Dies ist natürlich nicht ideal für die Produktivität des Endbenutzers, aber wenn Sie daran arbeiten, die Auswirkungen schnell zu begrenzen, kann dies eine kurzfristige Korrektur sein.</span><span class="sxs-lookup"><span data-stu-id="b3f86-196">This isn't ideal for the end user's productivity, of course, but if you are working to limit impact quickly, it can be a viable short-term remediation.</span></span>

- <span data-ttu-id="b3f86-197">Sie können integrierte Anwendungen für Ihren Mandanz deaktivieren.</span><span class="sxs-lookup"><span data-stu-id="b3f86-197">You can turn integrated applications off for your tenancy.</span></span> <span data-ttu-id="b3f86-198">Dies ist ein weiterer Schritt, der die Möglichkeit für Endbenutzer deaktiviert, die Zustimmung auf mandantenweitem Basis zu erteilen.</span><span class="sxs-lookup"><span data-stu-id="b3f86-198">This is a drastic step that disables the ability for end users to grant consent on a tenant-wide basis.</span></span> <span data-ttu-id="b3f86-199">Dadurch wird verhindert, dass Ihre Benutzer versehentlich Zugriff auf eine schädliche Anwendung gewähren.</span><span class="sxs-lookup"><span data-stu-id="b3f86-199">This prevents your users from inadvertently granting access to a malicious application.</span></span> <span data-ttu-id="b3f86-200">Dies wird nicht dringend empfohlen, da die Fähigkeit ihrer Benutzer, mit Anwendungen von Drittanbietern produktiv zu sein, stark beeinträchtigt wird.</span><span class="sxs-lookup"><span data-stu-id="b3f86-200">This isn't strongly recommended as it severely impairs your users' ability to be productive with third party applications.</span></span> <span data-ttu-id="b3f86-201">Dazu können Sie die Schritte unter "Aktivieren oder Deaktivieren von [integrierten Apps" ausführen.](../../admin/misc/user-consent.md)</span><span class="sxs-lookup"><span data-stu-id="b3f86-201">You can do this by following the steps in [Turning Integrated Apps on or off](../../admin/misc/user-consent.md).</span></span>

## <a name="secure-microsoft-365-like-a-cybersecurity-pro"></a><span data-ttu-id="b3f86-202">Sichern von Microsoft 365 wie ein Profi für Internetsicherheit</span><span class="sxs-lookup"><span data-stu-id="b3f86-202">Secure Microsoft 365 like a cybersecurity pro</span></span>

<span data-ttu-id="b3f86-203">Ihr Microsoft 365-Abonnement bietet eine Reihe von leistungsfähigen Funktionen für Sicherheit, die Sie zum Schutz Ihrer Daten und Ihrer Benutzer verwenden können.</span><span class="sxs-lookup"><span data-stu-id="b3f86-203">Your Microsoft 365 subscription comes with a powerful set of security capabilities that you can use to protect your data and your users.</span></span> <span data-ttu-id="b3f86-204">Verwenden Sie die [Microsoft 365-Sicherheits-Roadmap: Top-Prioritäten für die ersten 30 Tage, 90 Tage und darüber hinaus](security-roadmap.md) zum Implementieren von empfohlenen Microsoft-Best-Practices für den Schutz Ihres Microsoft 365-Mandanten.</span><span class="sxs-lookup"><span data-stu-id="b3f86-204">Use the [Microsoft 365 security roadmap - Top priorities for the first 30 days, 90 days, and beyond](security-roadmap.md) to implement Microsoft recommended best practices for securing your Microsoft 365 tenant.</span></span>

- <span data-ttu-id="b3f86-205">Aufgaben, die in den ersten 30 Tagen ausgeführt werden sollten.</span><span class="sxs-lookup"><span data-stu-id="b3f86-205">Tasks to accomplish in the first 30 days.</span></span> <span data-ttu-id="b3f86-206">Diese sind unmittelbar gültig und haben nur geringe Auswirkungen für die Benutzer.</span><span class="sxs-lookup"><span data-stu-id="b3f86-206">These have immediate affect and are low-impact to your users.</span></span>

- <span data-ttu-id="b3f86-207">Aufgaben, die innerhalb von 90 Tagen ausgeführt werden sollten.</span><span class="sxs-lookup"><span data-stu-id="b3f86-207">Tasks to accomplish in 90 days.</span></span> <span data-ttu-id="b3f86-208">Diese erfordern etwas mehr Zeit für Planung und Implementierung, stärken die Sicherheit Ihres Unternehmens jedoch erheblich.</span><span class="sxs-lookup"><span data-stu-id="b3f86-208">These take a bit more time to plan and implement but greatly improve your security posture.</span></span>

- <span data-ttu-id="b3f86-209">Über 90 Tage hinaus.</span><span class="sxs-lookup"><span data-stu-id="b3f86-209">Beyond 90 days.</span></span> <span data-ttu-id="b3f86-210">Diese Verbesserungen werden in den ersten 90 Tagen Ihrer Arbeit umgesetzt.</span><span class="sxs-lookup"><span data-stu-id="b3f86-210">These enhancements build in your first 90 days work.</span></span>

## <a name="see-also"></a><span data-ttu-id="b3f86-211">Siehe auch:</span><span class="sxs-lookup"><span data-stu-id="b3f86-211">See also:</span></span>

- <span data-ttu-id="b3f86-212">[Eine unerwartete Anwendung in meiner Anwendungsliste](https://docs.microsoft.com/azure/active-directory/application-access-unexpected-application) führt Administratoren durch verschiedene Aktionen, die sie möglicherweise ausführen möchten, nachdem sie sich über unerwartete Anwendungen mit Zugriff auf Daten geärärt haben.</span><span class="sxs-lookup"><span data-stu-id="b3f86-212">[Unexpected application in my applications list](https://docs.microsoft.com/azure/active-directory/application-access-unexpected-application) walks administrators through various actions they may want to take after realizing there are unexpected applications with access to data.</span></span>

- <span data-ttu-id="b3f86-213">[Das Integrieren von Anwendungen in Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-apps-permissions-consent) ist eine übersicht über Zustimmung und Berechtigungen auf hoher Ebene.</span><span class="sxs-lookup"><span data-stu-id="b3f86-213">[Integrating applications with Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-apps-permissions-consent) is a high-level overview of consent and permissions.</span></span>

- <span data-ttu-id="b3f86-214">[Probleme bei der Entwicklung meiner Anwendung](https://docs.microsoft.com/azure/active-directory/active-directory-application-dev-development-content-map) bieten Links zu verschiedenen Artikeln im Zusammenhang mit der Zustimmung.</span><span class="sxs-lookup"><span data-stu-id="b3f86-214">[Problems developing my application](https://docs.microsoft.com/azure/active-directory/active-directory-application-dev-development-content-map) provides links to various consent related articles.</span></span>

- <span data-ttu-id="b3f86-215">[Anwendungs- und Dienstprinzipalobjekte in Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-objects) bieten eine Übersicht über die Anwendungs- und Dienstprinzipalobjekte, die kern des Anwendungsmodells sind.</span><span class="sxs-lookup"><span data-stu-id="b3f86-215">[Application and service principal objects in Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-objects) provides an overview of the Application and Service principal objects that are core to the application model.</span></span>

- <span data-ttu-id="b3f86-216">[Die Verwaltung des Zugriffs auf Apps](https://docs.microsoft.com/azure/active-directory/active-directory-managing-access-to-apps) ist eine Übersicht über die Funktionen, die Administratoren zum Verwalten des Benutzerzugriffs auf Apps haben.</span><span class="sxs-lookup"><span data-stu-id="b3f86-216">[Manage access to apps](https://docs.microsoft.com/azure/active-directory/active-directory-managing-access-to-apps) is an overview of the capabilities that administrators have to manage user access to apps.</span></span>
