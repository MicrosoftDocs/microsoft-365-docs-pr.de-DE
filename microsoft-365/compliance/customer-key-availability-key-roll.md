---
title: Rollen oder Drehen eines Kundenschlüssels oder eines Verfügbarkeitsschlüssels
ms.author: krowley
author: kccross
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- M365-security-compliance
description: Erfahren Sie, wie Sie die in Azure Key Vault gespeicherten Kundenstammschlüssel rollen, die mit dem Kundenschlüssel verwendet werden. Zu den Diensten gehören Exchange Online, Skype for Business, SharePoint Online, OneDrive for Business und Teams Dateien.
ms.openlocfilehash: 892d77959bec1fb33b0ea6bcfaa8c530dd9b8911
ms.sourcegitcommit: 94e64afaf12f3d8813099d8ffa46baba65772763
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 05/12/2021
ms.locfileid: "52345118"
---
# <a name="roll-or-rotate-a-customer-key-or-an-availability-key"></a><span data-ttu-id="dde17-104">Rollen oder Drehen eines Kundenschlüssels oder eines Verfügbarkeitsschlüssels</span><span class="sxs-lookup"><span data-stu-id="dde17-104">Roll or rotate a Customer Key or an availability key</span></span>

> [!CAUTION]
> <span data-ttu-id="dde17-105">Rollen Sie nur einen Verschlüsselungsschlüssel, den Sie mit dem Kundenschlüssel verwenden, wenn Ihre Sicherheits- oder Complianceanforderungen es vorschreiben, dass Sie den Schlüssel rollen müssen.</span><span class="sxs-lookup"><span data-stu-id="dde17-105">Only roll an encryption key that you use with Customer Key when your security or compliance requirements dictate that you must roll the key.</span></span> <span data-ttu-id="dde17-106">Löschen Sie darüber hinaus keine Schlüssel, die Richtlinien zugeordnet sind oder waren.</span><span class="sxs-lookup"><span data-stu-id="dde17-106">In addition, do not delete any keys that are or were associated with policies.</span></span> <span data-ttu-id="dde17-107">Wenn Sie Rolling-Codes für Ihre Schlüssel generieren, wird Inhalt mit den vorhergehenden Schlüsseln verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="dde17-107">When you roll your keys, there will be content encrypted with the previous keys.</span></span> <span data-ttu-id="dde17-108">Werden beispielsweise aktive Postfächer häufig neu verschlüsselt, so werden inaktive, abgeschaltete oder deaktivierte Postfächer möglicherweise weiterhin mit den vorhergehenden Schlüsseln verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="dde17-108">For example, while active mailboxes will be re-encrypted frequently, inactive, disconnected, and disabled mailboxes may still be encrypted with the previous keys.</span></span> <span data-ttu-id="dde17-109">SharePoint Online führt Sicherungen von Inhalten durch, um die Verlagerung der Speicherorte dieser sowie deren Wiederherstellung zu ermöglichen, weshalb es durchaus vorkommen kann, dass weiterhin Inhalte archiviert sind, die ältere Schlüssel verwendet.</span><span class="sxs-lookup"><span data-stu-id="dde17-109">SharePoint Online performs backup of content for restore and recovery purposes, so there may still be archived content using older keys.</span></span>

## <a name="about-rolling-the-availability-key"></a><span data-ttu-id="dde17-110">Informationen zum Rolling des Verfügbarkeitsschlüssels</span><span class="sxs-lookup"><span data-stu-id="dde17-110">About rolling the availability key</span></span>

<span data-ttu-id="dde17-111">Microsoft macht keine direkte Kontrolle über den Verfügbarkeitsschlüssel für Kunden verfügbar.</span><span class="sxs-lookup"><span data-stu-id="dde17-111">Microsoft does not expose direct control of the availability key to customers.</span></span> <span data-ttu-id="dde17-112">Sie können z. B. nur die Schlüssel rollen (drehen), die Sie in Azure Key Vault besitzen.</span><span class="sxs-lookup"><span data-stu-id="dde17-112">For example, you can only roll (rotate) the keys that you own in Azure Key Vault.</span></span> <span data-ttu-id="dde17-113">Microsoft 365 werden die Verfügbarkeitsschlüssel in einem intern definierten Zeitplan rollt.</span><span class="sxs-lookup"><span data-stu-id="dde17-113">Microsoft 365 rolls the availability keys on an internally-defined schedule.</span></span> <span data-ttu-id="dde17-114">Für diese Schlüsselrollen gibt es keine vereinbarung für kundenorientierte Servicelevels (Service Level Agreement, SLA).</span><span class="sxs-lookup"><span data-stu-id="dde17-114">There is no customer-facing, service-level agreement (SLA) for these key rolls.</span></span> <span data-ttu-id="dde17-115">Microsoft 365 dreht den Verfügbarkeitsschlüssel mithilfe Microsoft 365 Dienstcodes in einem automatisierten, nicht manuellen Prozess.</span><span class="sxs-lookup"><span data-stu-id="dde17-115">Microsoft 365 rotates the availability key using Microsoft 365 service code in an automated, non-manual process.</span></span> <span data-ttu-id="dde17-116">Microsoft-Administratoren können den Rollprozess initiieren.</span><span class="sxs-lookup"><span data-stu-id="dde17-116">Microsoft administrators may initiate the roll process.</span></span> <span data-ttu-id="dde17-117">Der Schlüssel wird mithilfe automatisierter Mechanismen ohne direkten Zugriff auf den Schlüsselspeicher rollt.</span><span class="sxs-lookup"><span data-stu-id="dde17-117">The key is rolled using automated mechanisms without direct access to the key store.</span></span> <span data-ttu-id="dde17-118">Der Zugriff auf den geheimen Informationsspeicher des Verfügbarkeitsschlüssels wird für Microsoft-Administratoren nicht bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="dde17-118">Access to the availability key secret store is not provisioned to Microsoft administrators.</span></span> <span data-ttu-id="dde17-119">Das Rollen von Verfügbarkeitsschlüsseln nutzt denselben Mechanismus, der zum anfänglichen Generieren des Schlüssels verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="dde17-119">Availability key rolling leverages the same mechanism used to initially generate the key.</span></span> <span data-ttu-id="dde17-120">Weitere Informationen zum Verfügbarkeitsschlüssel finden Sie unter [Verstehen des Verfügbarkeitsschlüssels](customer-key-availability-key-understand.md).</span><span class="sxs-lookup"><span data-stu-id="dde17-120">For more information about the availability key, see [Understand the availability key](customer-key-availability-key-understand.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="dde17-121">Exchange Online und Skype for Business Verfügbarkeitsschlüssel können von Kunden, die eine neue DEP erstellen, effektiv gerollt werden, da für jede erstellte DEP ein eindeutiger Verfügbarkeitsschlüssel generiert wird.</span><span class="sxs-lookup"><span data-stu-id="dde17-121">Exchange Online and Skype for Business availability keys can be effectively rolled by customers creating a new DEP, since a unique availability key is generated for each DEP you create.</span></span> <span data-ttu-id="dde17-122">Verfügbarkeitsschlüssel für SharePoint Online-, OneDrive for Business- und Teams-Dateien sind auf Gesamtstrukturebene vorhanden und werden für DEPs und Kunden freigegeben, was bedeutet, dass das Rolling nur nach einem intern von Microsoft definierten Zeitplan erfolgt.</span><span class="sxs-lookup"><span data-stu-id="dde17-122">Availability keys for SharePoint Online, OneDrive for Business, and Teams files exist at the forest level and are shared across DEPs and customers, which means rolling only occurs at a Microsoft internally defined schedule.</span></span> <span data-ttu-id="dde17-123">Um das Risiko zu verringern, dass der Verfügbarkeitsschlüssel nicht jedes Mal rollt, wenn eine neue DEP erstellt wird, rollen SharePoint, OneDrive und Teams den Mandantenzwingschlüssel (TIK), den Schlüssel, der von den Stammschlüsseln und dem Verfügbarkeitsschlüssel des Kunden umschlossen wird, jedes Mal, wenn eine neue DEP erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="dde17-123">To mitigate the risk of not rolling the availability key each time a new DEP is created, SharePoint, OneDrive, and Teams roll the tenant intermediate key (TIK), the key wrapped by the customer root keys and availability key, each time a new DEP is created.</span></span>

## <a name="request-a-new-version-of-each-existing-root-key-you-want-to-roll"></a><span data-ttu-id="dde17-124">Anfordern einer neuen Version jedes vorhandenen Stammschlüssels, den Sie rollen möchten</span><span class="sxs-lookup"><span data-stu-id="dde17-124">Request a new version of each existing root key you want to roll</span></span>

<span data-ttu-id="dde17-125">Wenn Sie einen Schlüssel rollen, fordern Sie eine neue Version eines vorhandenen Schlüssels an.</span><span class="sxs-lookup"><span data-stu-id="dde17-125">When you roll a key, you request a new version of an existing key.</span></span> <span data-ttu-id="dde17-126">Wenn Sie eine neue Version eines vorhandenen Schlüssels anfordern möchten, verwenden Sie dasselbe Cmdlet, [Add-AzKeyVaultKey](/powershell/module/az.keyvault/add-azkeyvaultkey), mit derselben Syntax wie zum Erstellen des Schlüssels.</span><span class="sxs-lookup"><span data-stu-id="dde17-126">To request a new version of an existing key, you use the same cmdlet, [Add-AzKeyVaultKey](/powershell/module/az.keyvault/add-azkeyvaultkey), with the same syntax that you used to create the key in the first place.</span></span> <span data-ttu-id="dde17-127">Nachdem Sie das Rolling eines Schlüssels abgeschlossen haben, der einer Datenverschlüsselungsrichtlinie (Data Encryption Policy, DEP) zugeordnet ist, führen Sie ein weiteres Cmdlet aus, um sicherzustellen, dass der Kundenschlüssel mit der Verwendung des neuen Schlüssels beginnt.</span><span class="sxs-lookup"><span data-stu-id="dde17-127">After you've finished rolling any key associated with a Data Encryption Policy (DEP), you run another cmdlet to ensure that Customer Key begins using the new key.</span></span> <span data-ttu-id="dde17-128">Gehen Sie wie in jedem Azure Key Vault (AKV) vor.</span><span class="sxs-lookup"><span data-stu-id="dde17-128">Do this step in each Azure Key Vault (AKV).</span></span>

<span data-ttu-id="dde17-129">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="dde17-129">For example:</span></span>

1. <span data-ttu-id="dde17-130">Melden Sie sich bei Ihrem Azure-Abonnement mit Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="dde17-130">Sign in to your Azure subscription with Azure PowerShell.</span></span> <span data-ttu-id="dde17-131">Anweisungen finden Sie unter [Sign in with Azure PowerShell](/powershell/azure/authenticate-azureps).</span><span class="sxs-lookup"><span data-stu-id="dde17-131">For instructions, see [Sign in with Azure PowerShell](/powershell/azure/authenticate-azureps).</span></span>

2. <span data-ttu-id="dde17-132">Führen Sie Add-AzKeyVaultKey cmdlet aus, wie im folgenden Beispiel gezeigt:</span><span class="sxs-lookup"><span data-stu-id="dde17-132">Run the Add-AzKeyVaultKey cmdlet as shown in the following example:</span></span>

   ```powershell
   Add-AzKeyVaultKey -VaultName Contoso-CK-EX-NA-VaultA1 -Name Contoso-CK-EX-NA-VaultA1-Key001 -Destination HSM -KeyOps @('wrapKey','unwrapKey') -NotBefore (Get-Date -Date "12/27/2016 12:01 AM")
   ```

   <span data-ttu-id="dde17-133">Da in diesem Beispiel ein Schlüssel namens **Contoso-CK-EX-NA-VaultA1-Key001** im **Contoso-CK-EX-NA-VaultA1-Tresor** vorhanden ist, erstellt das Cmdlet eine neue Version des Schlüssels.</span><span class="sxs-lookup"><span data-stu-id="dde17-133">In this example, since a key named **Contoso-CK-EX-NA-VaultA1-Key001** exists in the **Contoso-CK-EX-NA-VaultA1** vault, the cmdlet creates a new version of the key.</span></span> <span data-ttu-id="dde17-134">Bei diesem Vorgang werden die vorherigen Schlüsselversionen im Versionsverlauf für den Schlüssel beibehalten.</span><span class="sxs-lookup"><span data-stu-id="dde17-134">This operation preserves the previous key versions in the version history for the key.</span></span> <span data-ttu-id="dde17-135">Sie benötigen die vorherige Schlüsselversion, um die Daten zu entschlüsseln, die weiterhin verschlüsselt werden.</span><span class="sxs-lookup"><span data-stu-id="dde17-135">You need the previous key version to decrypt the data that it still encrypts.</span></span> <span data-ttu-id="dde17-136">Nachdem Sie das Rolling eines schlüssels abgeschlossen haben, der einer DEP zugeordnet ist, führen Sie ein zusätzliches Cmdlet aus, um sicherzustellen, dass der Kundenschlüssel mit der Verwendung des neuen Schlüssels beginnt.</span><span class="sxs-lookup"><span data-stu-id="dde17-136">Once you complete rolling any key associated with a DEP,  run an extra cmdlet to ensure that Customer Key begins using the new key.</span></span> <span data-ttu-id="dde17-137">In den folgenden Abschnitten werden die Cmdlets ausführlicher beschrieben.</span><span class="sxs-lookup"><span data-stu-id="dde17-137">The following sections describe the cmdlets in more detail.</span></span>
  
## <a name="update-the-keys-for-multi-workload-deps"></a><span data-ttu-id="dde17-138">Aktualisieren der Schlüssel für DEPs mit mehreren Arbeitsauslastungen</span><span class="sxs-lookup"><span data-stu-id="dde17-138">Update the keys for multi-workload DEPs</span></span>

<span data-ttu-id="dde17-139">Wenn Sie einen der Azure Key Vault-Schlüssel rollen, der einer DEP zugeordnet ist, die mit mehreren Workloads verwendet wird, müssen Sie die DEP so aktualisieren, dass sie auf den neuen Schlüssel verweisen kann.</span><span class="sxs-lookup"><span data-stu-id="dde17-139">When you roll either of the Azure Key Vault keys associated with a DEP used with multiple workloads, you must update the DEP to point to the new key.</span></span> <span data-ttu-id="dde17-140">Bei diesem Vorgang wird der Verfügbarkeitsschlüssel nicht gedreht.</span><span class="sxs-lookup"><span data-stu-id="dde17-140">This process does not rotate the availability key.</span></span>

<span data-ttu-id="dde17-141">Führen Sie die folgenden Schritte aus, um den Kundenschlüssel anweisen, den neuen Schlüssel zum Verschlüsseln mehrerer Arbeitsauslastungen zu verwenden:</span><span class="sxs-lookup"><span data-stu-id="dde17-141">To instruct Customer Key to use the new key to encrypt multiple workloads, complete these steps:</span></span>

1. <span data-ttu-id="dde17-142">Stellen Sie auf Ihrem lokalen Computer mithilfe eines Unternehmens- oder Schulkontos, das über globale Administrator- oder Complianceadministratorberechtigungen in Ihrer Organisation verfügt, eine Verbindung mit [Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) in einem Windows PowerShell herstellen.</span><span class="sxs-lookup"><span data-stu-id="dde17-142">On your local computer, using a work or school account that has global administrator or compliance admin permissions in your organization, [connect to Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) in a Windows PowerShell window.</span></span>

2. <span data-ttu-id="dde17-143">Führen Sie Set-M365DataAtRestEncryptionPolicy cmdlet aus.</span><span class="sxs-lookup"><span data-stu-id="dde17-143">Run the Set-M365DataAtRestEncryptionPolicy cmdlet.</span></span>
  
   ```powershell
   Set-M365DataAtRestEncryptionPolicy -[Identity] "PolicyName" -Refresh
   ```

<span data-ttu-id="dde17-144">Dabei *ist PolicyName* der Name oder die eindeutige ID der Richtlinie.</span><span class="sxs-lookup"><span data-stu-id="dde17-144">Where *PolicyName* is the name or unique ID of the policy.</span></span> <span data-ttu-id="dde17-145">Beispiel: Contoso_Global.</span><span class="sxs-lookup"><span data-stu-id="dde17-145">For example, Contoso_Global.</span></span>

<span data-ttu-id="dde17-146">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="dde17-146">Example:</span></span>

```powershell
Set-M365DataAtRestEncryptionPolicy -Identity "Contoso_Global" -Refresh
```

## <a name="update-the-keys-for-exchange-online-deps"></a><span data-ttu-id="dde17-147">Aktualisieren der Schlüssel für Exchange Online DEPs</span><span class="sxs-lookup"><span data-stu-id="dde17-147">Update the keys for Exchange Online DEPs</span></span>

<span data-ttu-id="dde17-148">Wenn Sie einen der Azure Key Vault-Schlüssel rollen, die einer mit Exchange Online und Skype for Business verwendeten DEP zugeordnet sind, müssen Sie die DEP aktualisieren, um auf den neuen Schlüssel zu zeigen.</span><span class="sxs-lookup"><span data-stu-id="dde17-148">When you roll either of the Azure Key Vault keys associated with a DEP used with Exchange Online and Skype for Business, you must update the DEP to point to the new key.</span></span> <span data-ttu-id="dde17-149">Dadurch wird der Verfügbarkeitsschlüssel nicht gedreht.</span><span class="sxs-lookup"><span data-stu-id="dde17-149">This does not rotate the availability key.</span></span>

<span data-ttu-id="dde17-150">Führen Sie das cmdlet Set-DataEncryptionPolicy wie folgt aus, um Kundenschlüssel anweisen, den neuen Schlüssel zum Verschlüsseln von Postfächern zu verwenden:</span><span class="sxs-lookup"><span data-stu-id="dde17-150">To instruct Customer Key to use the new key to encrypt mailboxes, run the Set-DataEncryptionPolicy cmdlet as follows:</span></span>

1. <span data-ttu-id="dde17-151">Führen Sie Set-DataEncryptionPolicy cmdlet in der Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="dde17-151">Run the Set-DataEncryptionPolicy cmdlet in Azure PowerShell:</span></span>
  
   ```powershell
   Set-DataEncryptionPolicy -Identity <DataEncryptionPolicyID> -Refresh
   ```

2. <span data-ttu-id="dde17-152">Um den Wert für die DataEncryptionPolicyID-Eigenschaft für das Postfach zu überprüfen, verwenden Sie die Schritte unter [Determine the DEP assigned to a mailbox](customer-key-manage.md#determine-the-dep-assigned-to-a-mailbox).</span><span class="sxs-lookup"><span data-stu-id="dde17-152">To check the value for the DataEncryptionPolicyID property for the mailbox, use the steps in [Determine the DEP assigned to a mailbox](customer-key-manage.md#determine-the-dep-assigned-to-a-mailbox).</span></span> <span data-ttu-id="dde17-153">Der Wert für diese Eigenschaft ändert sich, sobald der Dienst den aktualisierten Schlüssel angewendet hat.</span><span class="sxs-lookup"><span data-stu-id="dde17-153">The value for this property changes once the service applies the updated key.</span></span>
  
## <a name="update-the-keys-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="dde17-154">Aktualisieren der Schlüssel für SharePoint Online-, OneDrive for Business- und Teams Dateien</span><span class="sxs-lookup"><span data-stu-id="dde17-154">Update the keys for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="dde17-155">SharePoint Online können Sie nur einen Schlüssel gleichzeitig rollen.</span><span class="sxs-lookup"><span data-stu-id="dde17-155">SharePoint Online only allows you to roll one key at a time.</span></span> <span data-ttu-id="dde17-156">Wenn Sie beide Schlüssel in einem Schlüsseltresor rollen möchten, warten Sie, bis der erste Vorgang abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="dde17-156">If you want to roll both keys in a key vault, wait for the first operation to complete.</span></span> <span data-ttu-id="dde17-157">Microsoft empfiehlt, ihre Vorgänge zu staffeln, um dieses Problem zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="dde17-157">Microsoft recommends that you stagger your operations to avoid this issue.</span></span> <span data-ttu-id="dde17-158">Wenn Sie einen der Azure Key Vault-Schlüssel rollen, der einer mit SharePoint Online und OneDrive for Business verwendeten DEP zugeordnet ist, müssen Sie die DEP aktualisieren, um auf den neuen Schlüssel zu zeigen.</span><span class="sxs-lookup"><span data-stu-id="dde17-158">When you roll either of the Azure Key Vault keys associated with a DEP used with SharePoint Online and OneDrive for Business, you must update the DEP to point to the new key.</span></span> <span data-ttu-id="dde17-159">Dadurch wird der Verfügbarkeitsschlüssel nicht gedreht.</span><span class="sxs-lookup"><span data-stu-id="dde17-159">This does not rotate the availability key.</span></span>

1. <span data-ttu-id="dde17-160">Führen Sie Update-SPODataEncryptionPolicy cmdlet wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="dde17-160">Run the Update-SPODataEncryptionPolicy cmdlet as follows:</span></span>
  
   ```powershell
   Update-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl> -KeyVaultName <ReplacementKeyVaultName> -KeyName <ReplacementKeyName> -KeyVersion <ReplacementKeyVersion> -KeyType <Primary | Secondary>
   ```

   <span data-ttu-id="dde17-161">Während dieses Cmdlet den Schlüsselrollvorgang für SharePoint Online und OneDrive for Business startet, wird die Aktion nicht sofort abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="dde17-161">While this cmdlet starts the key roll operation for SharePoint Online and OneDrive for Business, the action doesn't complete immediately.</span></span>

2. <span data-ttu-id="dde17-162">Zum Anzeigen des Fortschritts der Generierung eines Rolling-Code für einen Schlüssel, müssen Sie das Cmdlet „Get-SPODataEncryptionPolicy“ wie folgt ausführen:</span><span class="sxs-lookup"><span data-stu-id="dde17-162">To see the progress of the key roll operation, run the Get-SPODataEncryptionPolicy cmdlet as follows:</span></span>

   ```powershell
   Get-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl>
   ```

## <a name="related-articles"></a><span data-ttu-id="dde17-163">Verwandte Artikel</span><span class="sxs-lookup"><span data-stu-id="dde17-163">Related articles</span></span>

- [<span data-ttu-id="dde17-164">Dienstverschlüsselung mit Kundenschlüssel für Office 365</span><span class="sxs-lookup"><span data-stu-id="dde17-164">Service encryption with Customer Key for Office 365</span></span>](customer-key-overview.md)

- [<span data-ttu-id="dde17-165">Einrichten des Kundenschlüssels für Office 365</span><span class="sxs-lookup"><span data-stu-id="dde17-165">Set up Customer Key for Office 365</span></span>](customer-key-set-up.md)

- [<span data-ttu-id="dde17-166">Verwalten des Kundenschlüssels für Office 365</span><span class="sxs-lookup"><span data-stu-id="dde17-166">Manage Customer Key for Office 365</span></span>](customer-key-manage.md)

- [<span data-ttu-id="dde17-167">Informationen zum Verfügbarkeitsschlüssel</span><span class="sxs-lookup"><span data-stu-id="dde17-167">Learn about the availability key</span></span>](customer-key-availability-key-understand.md)